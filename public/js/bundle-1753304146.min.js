!function r(e,t,s){function o(n,a){if(!t[n]){if(!e[n]){var l="function"==typeof require&&require;if(!a&&l)return l(n,!0);if(i)return i(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){return o(e[n][1][t]||t)},u,u.exports,r,e,t,s)}return t[n].exports}for(var i="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(e,t,s){t.exports=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],2:[function(e,t,s){function Emitter(e){if(e)return function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}(e)}s.Emitter=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function on(){this.off(e,on),t.apply(this,arguments)}return on.fn=t,this.on(e,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n=0;n<i.length;n++)if((s=i[n])===t||s.fn===t){i.splice(n,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(s){i=0;for(var n=(s=s.slice(0)).length;i<n;++i)s[i].apply(this,t)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],3:[function(e,t,s){t.exports=e("./lib/axios")},{"./lib/axios":5}],4:[function(e,t,s){"use strict";var i=e("./../utils"),n=e("./../core/settle"),a=e("./../helpers/cookies"),l=e("./../helpers/buildURL"),c=e("../core/buildFullPath"),u=e("./../helpers/parseHeaders"),h=e("./../helpers/isURLSameOrigin"),g=e("../defaults/transitional"),d=e("../core/AxiosError"),p=e("../cancel/CanceledError"),f=e("../helpers/parseProtocol");t.exports=function xhrAdapter(e){return new Promise(function dispatchXhrRequest(t,s){var m,y=e.data,v=e.headers,w=e.responseType;function done(){e.cancelToken&&e.cancelToken.unsubscribe(m),e.signal&&e.signal.removeEventListener("abort",m)}i.isFormData(y)&&i.isStandardBrowserEnv()&&delete v["Content-Type"];var b=new XMLHttpRequest;if(e.auth){var S=e.auth.username||"",E=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";v.Authorization="Basic "+btoa(S+":"+E)}var k=c(e.baseURL,e.url);function onloadend(){if(b){var i="getAllResponseHeaders"in b?u(b.getAllResponseHeaders()):null,a={data:w&&"text"!==w&&"json"!==w?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:i,config:e,request:b};n(function _resolve(e){t(e),done()},function _reject(e){s(e),done()},a),b=null}}if(b.open(e.method.toUpperCase(),l(k,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=onloadend:b.onreadystatechange=function handleLoad(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(onloadend)},b.onabort=function handleAbort(){b&&(s(new d("Request aborted",d.ECONNABORTED,e,b)),b=null)},b.onerror=function handleError(){s(new d("Network Error",d.ERR_NETWORK,e,b,b)),b=null},b.ontimeout=function handleTimeout(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",i=e.transitional||g;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),s(new d(t,i.clarifyTimeoutError?d.ETIMEDOUT:d.ECONNABORTED,e,b)),b=null},i.isStandardBrowserEnv()){var C=(e.withCredentials||h(k))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;C&&(v[e.xsrfHeaderName]=C)}"setRequestHeader"in b&&i.forEach(v,function setRequestHeader(e,t){void 0===y&&"content-type"===t.toLowerCase()?delete v[t]:b.setRequestHeader(t,e)}),i.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),w&&"json"!==w&&(b.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&b.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(m=function(e){b&&(s(!e||e&&e.type?new p:e),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(m),e.signal&&(e.signal.aborted?m():e.signal.addEventListener("abort",m))),y||(y=null);var I=f(k);I&&-1===["http","https","file"].indexOf(I)?s(new d("Unsupported protocol "+I+":",d.ERR_BAD_REQUEST,e)):b.send(y)})}},{"../cancel/CanceledError":7,"../core/AxiosError":10,"../core/buildFullPath":12,"../defaults/transitional":18,"../helpers/parseProtocol":30,"./../core/settle":15,"./../helpers/buildURL":21,"./../helpers/cookies":23,"./../helpers/isURLSameOrigin":26,"./../helpers/parseHeaders":29,"./../utils":34}],5:[function(e,t,s){"use strict";var i=e("./utils"),n=e("./helpers/bind"),a=e("./core/Axios"),l=e("./core/mergeConfig");var c=function createInstance(e){var t=new a(e),s=n(a.prototype.request,t);return i.extend(s,a.prototype,t),i.extend(s,t),s.create=function create(t){return createInstance(l(e,t))},s}(e("./defaults"));c.Axios=a,c.CanceledError=e("./cancel/CanceledError"),c.CancelToken=e("./cancel/CancelToken"),c.isCancel=e("./cancel/isCancel"),c.VERSION=e("./env/data").version,c.toFormData=e("./helpers/toFormData"),c.AxiosError=e("../lib/core/AxiosError"),c.Cancel=c.CanceledError,c.all=function all(e){return Promise.all(e)},c.spread=e("./helpers/spread"),c.isAxiosError=e("./helpers/isAxiosError"),t.exports=c,t.exports.default=c},{"../lib/core/AxiosError":10,"./cancel/CancelToken":6,"./cancel/CanceledError":7,"./cancel/isCancel":8,"./core/Axios":9,"./core/mergeConfig":14,"./defaults":17,"./env/data":19,"./helpers/bind":20,"./helpers/isAxiosError":25,"./helpers/spread":31,"./helpers/toFormData":32,"./utils":34}],6:[function(e,t,s){"use strict";var i=e("./CanceledError");function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function promiseExecutor(e){t=e});var s=this;this.promise.then(function(e){if(s._listeners){var t,i=s._listeners.length;for(t=0;t<i;t++)s._listeners[t](e);s._listeners=null}}),this.promise.then=function(e){var t,i=new Promise(function(e){s.subscribe(e),t=e}).then(e);return i.cancel=function reject(){s.unsubscribe(t)},i},e(function cancel(e){s.reason||(s.reason=new i(e),t(s.reason))})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.prototype.subscribe=function subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},CancelToken.prototype.unsubscribe=function unsubscribe(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},CancelToken.source=function source(){var e;return{token:new CancelToken(function executor(t){e=t}),cancel:e}},t.exports=CancelToken},{"./CanceledError":7}],7:[function(e,t,s){"use strict";var i=e("../core/AxiosError");function CanceledError(e){i.call(this,null==e?"canceled":e,i.ERR_CANCELED),this.name="CanceledError"}e("../utils").inherits(CanceledError,i,{__CANCEL__:!0}),t.exports=CanceledError},{"../core/AxiosError":10,"../utils":34}],8:[function(e,t,s){"use strict";t.exports=function isCancel(e){return!(!e||!e.__CANCEL__)}},{}],9:[function(e,t,s){"use strict";var i=e("./../utils"),n=e("../helpers/buildURL"),a=e("./InterceptorManager"),l=e("./dispatchRequest"),c=e("./mergeConfig"),u=e("./buildFullPath"),h=e("../helpers/validator"),g=h.validators;function Axios(e){this.defaults=e,this.interceptors={request:new a,response:new a}}Axios.prototype.request=function request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=c(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var s=t.transitional;void 0!==s&&h.assertOptions(s,{silentJSONParsing:g.transitional(g.boolean),forcedJSONParsing:g.transitional(g.boolean),clarifyTimeoutError:g.transitional(g.boolean)},!1);var i=[],n=!0;this.interceptors.request.forEach(function unshiftRequestInterceptors(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});var a,u=[];if(this.interceptors.response.forEach(function pushResponseInterceptors(e){u.push(e.fulfilled,e.rejected)}),!n){var d=[l,void 0];for(Array.prototype.unshift.apply(d,i),d=d.concat(u),a=Promise.resolve(t);d.length;)a=a.then(d.shift(),d.shift());return a}for(var p=t;i.length;){var f=i.shift(),m=i.shift();try{p=f(p)}catch(e){m(e);break}}try{a=l(p)}catch(e){return Promise.reject(e)}for(;u.length;)a=a.then(u.shift(),u.shift());return a},Axios.prototype.getUri=function getUri(e){e=c(this.defaults,e);var t=u(e.baseURL,e.url);return n(t,e.params,e.paramsSerializer)},i.forEach(["delete","get","head","options"],function forEachMethodNoData(e){Axios.prototype[e]=function(t,s){return this.request(c(s||{},{method:e,url:t,data:(s||{}).data}))}}),i.forEach(["post","put","patch"],function forEachMethodWithData(e){function generateHTTPMethod(t){return function httpMethod(s,i,n){return this.request(c(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:i}))}}Axios.prototype[e]=generateHTTPMethod(),Axios.prototype[e+"Form"]=generateHTTPMethod(!0)}),t.exports=Axios},{"../helpers/buildURL":21,"../helpers/validator":33,"./../utils":34,"./InterceptorManager":11,"./buildFullPath":12,"./dispatchRequest":13,"./mergeConfig":14}],10:[function(e,t,s){"use strict";var i=e("../utils");function AxiosError(e,t,s,i,n){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),i&&(this.request=i),n&&(this.response=n)}i.inherits(AxiosError,Error,{toJSON:function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n=AxiosError.prototype,a={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){a[e]={value:e}}),Object.defineProperties(AxiosError,a),Object.defineProperty(n,"isAxiosError",{value:!0}),AxiosError.from=function(e,t,s,a,l,c){var u=Object.create(n);return i.toFlatObject(e,u,function filter(e){return e!==Error.prototype}),AxiosError.call(u,e.message,t,s,a,l),u.name=e.name,c&&Object.assign(u,c),u},t.exports=AxiosError},{"../utils":34}],11:[function(e,t,s){"use strict";var i=e("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function forEach(e){i.forEach(this.handlers,function forEachHandler(t){null!==t&&e(t)})},t.exports=InterceptorManager},{"./../utils":34}],12:[function(e,t,s){"use strict";var i=e("../helpers/isAbsoluteURL"),n=e("../helpers/combineURLs");t.exports=function buildFullPath(e,t){return e&&!i(t)?n(e,t):t}},{"../helpers/combineURLs":22,"../helpers/isAbsoluteURL":24}],13:[function(e,t,s){"use strict";var i=e("./../utils"),n=e("./transformData"),a=e("../cancel/isCancel"),l=e("../defaults"),c=e("../cancel/CanceledError");function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new c}t.exports=function dispatchRequest(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=n.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(t){delete e.headers[t]}),(e.adapter||l.adapter)(e).then(function onAdapterResolution(t){return throwIfCancellationRequested(e),t.data=n.call(e,t.data,t.headers,e.transformResponse),t},function onAdapterRejection(t){return a(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=n.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},{"../cancel/CanceledError":7,"../cancel/isCancel":8,"../defaults":17,"./../utils":34,"./transformData":16}],14:[function(e,t,s){"use strict";var i=e("../utils");t.exports=function mergeConfig(e,t){t=t||{};var s={};function getMergedValue(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function mergeDeepProperties(s){return i.isUndefined(t[s])?i.isUndefined(e[s])?void 0:getMergedValue(void 0,e[s]):getMergedValue(e[s],t[s])}function valueFromConfig2(e){if(!i.isUndefined(t[e]))return getMergedValue(void 0,t[e])}function defaultToConfig2(s){return i.isUndefined(t[s])?i.isUndefined(e[s])?void 0:getMergedValue(void 0,e[s]):getMergedValue(void 0,t[s])}function mergeDirectKeys(s){return s in t?getMergedValue(e[s],t[s]):s in e?getMergedValue(void 0,e[s]):void 0}var n={url:valueFromConfig2,method:valueFromConfig2,data:valueFromConfig2,baseURL:defaultToConfig2,transformRequest:defaultToConfig2,transformResponse:defaultToConfig2,paramsSerializer:defaultToConfig2,timeout:defaultToConfig2,timeoutMessage:defaultToConfig2,withCredentials:defaultToConfig2,adapter:defaultToConfig2,responseType:defaultToConfig2,xsrfCookieName:defaultToConfig2,xsrfHeaderName:defaultToConfig2,onUploadProgress:defaultToConfig2,onDownloadProgress:defaultToConfig2,decompress:defaultToConfig2,maxContentLength:defaultToConfig2,maxBodyLength:defaultToConfig2,beforeRedirect:defaultToConfig2,transport:defaultToConfig2,httpAgent:defaultToConfig2,httpsAgent:defaultToConfig2,cancelToken:defaultToConfig2,socketPath:defaultToConfig2,responseEncoding:defaultToConfig2,validateStatus:mergeDirectKeys};return i.forEach(Object.keys(e).concat(Object.keys(t)),function computeConfigValue(e){var t=n[e]||mergeDeepProperties,a=t(e);i.isUndefined(a)&&t!==mergeDirectKeys||(s[e]=a)}),s}},{"../utils":34}],15:[function(e,t,s){"use strict";var i=e("./AxiosError");t.exports=function settle(e,t,s){var n=s.config.validateStatus;s.status&&n&&!n(s.status)?t(new i("Request failed with status code "+s.status,[i.ERR_BAD_REQUEST,i.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}},{"./AxiosError":10}],16:[function(e,t,s){"use strict";var i=e("./../utils"),n=e("../defaults");t.exports=function transformData(e,t,s){var a=this||n;return i.forEach(s,function transform(s){e=s.call(a,e,t)}),e}},{"../defaults":17,"./../utils":34}],17:[function(e,t,s){(function(s){(function(){"use strict";var i=e("../utils"),n=e("../helpers/normalizeHeaderName"),a=e("../core/AxiosError"),l=e("./transitional"),c=e("../helpers/toFormData"),u={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var h={transitional:l,adapter:function getDefaultAdapter(){var t;return"undefined"!=typeof XMLHttpRequest?t=e("../adapters/xhr"):void 0!==s&&"[object process]"===Object.prototype.toString.call(s)&&(t=e("../adapters/http")),t}(),transformRequest:[function transformRequest(e,t){if(n(t,"Accept"),n(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e))return e;if(i.isArrayBufferView(e))return e.buffer;if(i.isURLSearchParams(e))return setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var s,a=i.isObject(e),l=t&&t["Content-Type"];if((s=i.isFileList(e))||a&&"multipart/form-data"===l){var u=this.env&&this.env.FormData;return c(s?{"files[]":e}:e,u&&new u)}return a||"application/json"===l?(setContentTypeIfUnset(t,"application/json"),function stringifySafely(e,t,s){if(i.isString(e))try{return(t||JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function transformResponse(e){var t=this.transitional||h.transitional,s=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,l=!s&&"json"===this.responseType;if(l||n&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(l){if("SyntaxError"===e.name)throw a.from(e,a.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:e("./env/FormData")},validateStatus:function validateStatus(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function forEachMethodNoData(e){h.headers[e]={}}),i.forEach(["post","put","patch"],function forEachMethodWithData(e){h.headers[e]=i.merge(u)}),t.exports=h}).call(this)}).call(this,e("_process"))},{"../adapters/http":4,"../adapters/xhr":4,"../core/AxiosError":10,"../helpers/normalizeHeaderName":27,"../helpers/toFormData":32,"../utils":34,"./env/FormData":28,"./transitional":18,_process:60}],18:[function(e,t,s){"use strict";t.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},{}],19:[function(e,t,s){t.exports={version:"0.27.2"}},{}],20:[function(e,t,s){"use strict";t.exports=function bind(e,t){return function wrap(){for(var s=new Array(arguments.length),i=0;i<s.length;i++)s[i]=arguments[i];return e.apply(t,s)}}},{}],21:[function(e,t,s){"use strict";var i=e("./../utils");function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function buildURL(e,t,s){if(!t)return e;var n;if(s)n=s(t);else if(i.isURLSearchParams(t))n=t.toString();else{var a=[];i.forEach(t,function serialize(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function parseValue(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(encode(t)+"="+encode(e))}))}),n=a.join("&")}if(n){var l=e.indexOf("#");-1!==l&&(e=e.slice(0,l)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}},{"./../utils":34}],22:[function(e,t,s){"use strict";t.exports=function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},{}],23:[function(e,t,s){"use strict";var i=e("./../utils");t.exports=i.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(e,t,s,n,a,l){var c=[];c.push(e+"="+encodeURIComponent(t)),i.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),i.isString(n)&&c.push("path="+n),i.isString(a)&&c.push("domain="+a),!0===l&&c.push("secure"),document.cookie=c.join("; ")},read:function read(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function remove(e){this.write(e,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},{"./../utils":34}],24:[function(e,t,s){"use strict";t.exports=function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},{}],25:[function(e,t,s){"use strict";var i=e("./../utils");t.exports=function isAxiosError(e){return i.isObject(e)&&!0===e.isAxiosError}},{"./../utils":34}],26:[function(e,t,s){"use strict";var i=e("./../utils");t.exports=i.isStandardBrowserEnv()?function standardBrowserEnv(){var e,t=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function resolveURL(e){var i=e;return t&&(s.setAttribute("href",i),i=s.href),s.setAttribute("href",i),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return e=resolveURL(window.location.href),function isURLSameOrigin(t){var s=i.isString(t)?resolveURL(t):t;return s.protocol===e.protocol&&s.host===e.host}}():function isURLSameOrigin(){return!0}},{"./../utils":34}],27:[function(e,t,s){"use strict";var i=e("../utils");t.exports=function normalizeHeaderName(e,t){i.forEach(e,function processHeader(s,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[i])})}},{"../utils":34}],28:[function(e,t,s){t.exports=null},{}],29:[function(e,t,s){"use strict";var i=e("./../utils"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function parseHeaders(e){var t,s,a,l={};return e?(i.forEach(e.split("\n"),function parser(e){if(a=e.indexOf(":"),t=i.trim(e.substr(0,a)).toLowerCase(),s=i.trim(e.substr(a+1)),t){if(l[t]&&n.indexOf(t)>=0)return;l[t]="set-cookie"===t?(l[t]?l[t]:[]).concat([s]):l[t]?l[t]+", "+s:s}}),l):l}},{"./../utils":34}],30:[function(e,t,s){"use strict";t.exports=function parseProtocol(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}},{}],31:[function(e,t,s){"use strict";t.exports=function spread(e){return function wrap(t){return e.apply(null,t)}}},{}],32:[function(e,t,s){(function(s){(function(){"use strict";var i=e("../utils");t.exports=function toFormData(e,t){t=t||new FormData;var n=[];function convertValue(e){return null===e?"":i.isDate(e)?e.toISOString():i.isArrayBuffer(e)||i.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):s.from(e):e}return function build(e,s){if(i.isPlainObject(e)||i.isArray(e)){if(-1!==n.indexOf(e))throw Error("Circular reference detected in "+s);n.push(e),i.forEach(e,function each(e,n){if(!i.isUndefined(e)){var a,l=s?s+"."+n:n;if(e&&!s&&"object"==typeof e)if(i.endsWith(n,"{}"))e=JSON.stringify(e);else if(i.endsWith(n,"[]")&&(a=i.toArray(e)))return void a.forEach(function(e){!i.isUndefined(e)&&t.append(l,convertValue(e))});build(e,l)}}),n.pop()}else t.append(s,convertValue(e))}(e),t}}).call(this)}).call(this,e("buffer").Buffer)},{"../utils":34,buffer:36}],33:[function(e,t,s){"use strict";var i=e("../env/data").version,n=e("../core/AxiosError"),a={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){a[e]=function validator(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});var l={};a.transitional=function transitional(e,t,s){function formatMessage(e,t){return"[Axios v"+i+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return function(s,i,a){if(!1===e)throw new n(formatMessage(i," has been removed"+(t?" in "+t:"")),n.ERR_DEPRECATED);return t&&!l[i]&&(l[i]=!0,console.warn(formatMessage(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,i,a)}},t.exports={assertOptions:function assertOptions(e,t,s){if("object"!=typeof e)throw new n("options must be an object",n.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),a=i.length;a-- >0;){var l=i[a],c=t[l];if(c){var u=e[l],h=void 0===u||c(u,l,e);if(!0!==h)throw new n("option "+l+" must be "+h,n.ERR_BAD_OPTION_VALUE)}else if(!0!==s)throw new n("Unknown option "+l,n.ERR_BAD_OPTION)}},validators:a}},{"../core/AxiosError":10,"../env/data":19}],34:[function(e,t,s){"use strict";var i,n=e("./helpers/bind"),a=Object.prototype.toString,l=(i=Object.create(null),function(e){var t=a.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())});function kindOfTest(e){return e=e.toLowerCase(),function isKindOf(t){return l(t)===e}}function isArray(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}var c=kindOfTest("ArrayBuffer");function isObject(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("object"!==l(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var u=kindOfTest("Date"),h=kindOfTest("File"),g=kindOfTest("Blob"),d=kindOfTest("FileList");function isFunction(e){return"[object Function]"===a.call(e)}var p=kindOfTest("URLSearchParams");function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var s=0,i=e.length;s<i;s++)t.call(null,e[s],s,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}var f,m=(f="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return f&&e instanceof f});t.exports={isArray:isArray,isArrayBuffer:c,isBuffer:function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function isFormData(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||a.call(e)===t||isFunction(e.toString)&&e.toString()===t)},isArrayBufferView:function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&c(e.buffer)},isString:function isString(e){return"string"==typeof e},isNumber:function isNumber(e){return"number"==typeof e},isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:u,isFile:h,isBlob:g,isFunction:isFunction,isStream:function isStream(e){return isObject(e)&&isFunction(e.pipe)},isURLSearchParams:p,isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:forEach,merge:function merge(){var e={};function assignValue(t,s){isPlainObject(e[s])&&isPlainObject(t)?e[s]=merge(e[s],t):isPlainObject(t)?e[s]=merge({},t):isArray(t)?e[s]=t.slice():e[s]=t}for(var t=0,s=arguments.length;t<s;t++)forEach(arguments[t],assignValue);return e},extend:function extend(e,t,s){return forEach(t,function assignValue(t,i){e[i]=s&&"function"==typeof t?n(t,s):t}),e},trim:function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function inherits(e,t,s,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,s&&Object.assign(e.prototype,s)},toFlatObject:function toFlatObject(e,t,s){var i,n,a,l={};t=t||{};do{for(n=(i=Object.getOwnPropertyNames(e)).length;n-- >0;)l[a=i[n]]||(t[a]=e[a],l[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:l,kindOfTest:kindOfTest,endsWith:function endsWith(e,t,s){e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;var i=e.indexOf(t,s);return-1!==i&&i===s},toArray:function toArray(e){if(!e)return null;var t=e.length;if(isUndefined(t))return null;for(var s=new Array(t);t-- >0;)s[t]=e[t];return s},isTypedArray:m,isFileList:d}},{"./helpers/bind":20}],35:[function(e,t,s){"use strict";s.byteLength=function byteLength(e){var t=getLens(e),s=t[0],i=t[1];return 3*(s+i)/4-i},s.toByteArray=function toByteArray(e){var t,s,i=getLens(e),l=i[0],c=i[1],u=new a(function _byteLength(e,t,s){return 3*(t+s)/4-s}(0,l,c)),h=0,g=c>0?l-4:l;for(s=0;s<g;s+=4)t=n[e.charCodeAt(s)]<<18|n[e.charCodeAt(s+1)]<<12|n[e.charCodeAt(s+2)]<<6|n[e.charCodeAt(s+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;2===c&&(t=n[e.charCodeAt(s)]<<2|n[e.charCodeAt(s+1)]>>4,u[h++]=255&t);1===c&&(t=n[e.charCodeAt(s)]<<10|n[e.charCodeAt(s+1)]<<4|n[e.charCodeAt(s+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t);return u},s.fromByteArray=function fromByteArray(e){for(var t,s=e.length,n=s%3,a=[],l=16383,c=0,u=s-n;c<u;c+=l)a.push(encodeChunk(e,c,c+l>u?u:c+l));1===n?(t=e[s-1],a.push(i[t>>2]+i[t<<4&63]+"==")):2===n&&(t=(e[s-2]<<8)+e[s-1],a.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0;c<64;++c)i[c]=l[c],n[l.charCodeAt(c)]=c;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}function tripletToBase64(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function encodeChunk(e,t,s){for(var i,n=[],a=t;a<s;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(tripletToBase64(i));return n.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},{}],36:[function(e,t,s){(function(t){(function(){"use strict";var t=e("base64-js"),i=e("ieee754");s.Buffer=Buffer,s.SlowBuffer=function SlowBuffer(e){+e!=e&&(e=0);return Buffer.alloc(+e)},s.INSPECT_MAX_BYTES=50;var n=2147483647;function createBuffer(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=Buffer.prototype,t}function Buffer(e,t,s){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,s)}function from(e,t,s){if("string"==typeof e)return function fromString(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var s=0|byteLength(e,t),i=createBuffer(s),n=i.write(e,t);n!==s&&(i=i.slice(0,n));return i}(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return function fromArrayBuffer(e,t,s){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(s||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===t&&void 0===s?new Uint8Array(e):void 0===s?new Uint8Array(e,t):new Uint8Array(e,t,s);return i.__proto__=Buffer.prototype,i}(e,t,s);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return Buffer.from(i,t,s);var n=function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),s=createBuffer(t);return 0===s.length||e.copy(s,0,0,t),s}if(void 0!==e.length)return"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e);if("Buffer"===e.type&&Array.isArray(e.data))return fromArrayLike(e.data)}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),s=createBuffer(t),i=0;i<t;i+=1)s[i]=255&e[i];return s}function checked(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var s=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===s)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return base64ToBytes(e).length;default:if(n)return i?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),n=!0}}function slowToString(e,t,s){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,s);case"utf8":case"utf-8":return utf8Slice(this,t,s);case"ascii":return asciiSlice(this,t,s);case"latin1":case"binary":return latin1Slice(this,t,s);case"base64":return base64Slice(this,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,s);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function swap(e,t,s){var i=e[t];e[t]=e[s],e[s]=i}function bidirectionalIndexOf(e,t,s,i,n){if(0===e.length)return-1;if("string"==typeof s?(i=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),numberIsNaN(s=+s)&&(s=n?0:e.length-1),s<0&&(s=e.length+s),s>=e.length){if(n)return-1;s=e.length-1}else if(s<0){if(!n)return-1;s=0}if("string"==typeof t&&(t=Buffer.from(t,i)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,s,i,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,s):Uint8Array.prototype.lastIndexOf.call(e,t,s):arrayIndexOf(e,[t],s,i,n);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,s,i,n){var a,l=1,c=e.length,u=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;l=2,c/=2,u/=2,s/=2}function read(e,t){return 1===l?e[t]:e.readUInt16BE(t*l)}if(n){var h=-1;for(a=s;a<c;a++)if(read(e,a)===read(t,-1===h?0:a-h)){if(-1===h&&(h=a),a-h+1===u)return h*l}else-1!==h&&(a-=a-h),h=-1}else for(s+u>c&&(s=c-u),a=s;a>=0;a--){for(var g=!0,d=0;d<u;d++)if(read(e,a+d)!==read(t,d)){g=!1;break}if(g)return a}return-1}function hexWrite(e,t,s,i){s=Number(s)||0;var n=e.length-s;i?(i=Number(i))>n&&(i=n):i=n;var a=t.length;i>a/2&&(i=a/2);for(var l=0;l<i;++l){var c=parseInt(t.substr(2*l,2),16);if(numberIsNaN(c))return l;e[s+l]=c}return l}function utf8Write(e,t,s,i){return blitBuffer(utf8ToBytes(t,e.length-s),e,s,i)}function asciiWrite(e,t,s,i){return blitBuffer(function asciiToBytes(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}(t),e,s,i)}function latin1Write(e,t,s,i){return asciiWrite(e,t,s,i)}function base64Write(e,t,s,i){return blitBuffer(base64ToBytes(t),e,s,i)}function ucs2Write(e,t,s,i){return blitBuffer(function utf16leToBytes(e,t){for(var s,i,n,a=[],l=0;l<e.length&&!((t-=2)<0);++l)i=(s=e.charCodeAt(l))>>8,n=s%256,a.push(n),a.push(i);return a}(t,e.length-s),e,s,i)}function base64Slice(e,s,i){return 0===s&&i===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(s,i))}function utf8Slice(e,t,s){s=Math.min(e.length,s);for(var i=[],n=t;n<s;){var l,c,u,h,g=e[n],d=null,p=g>239?4:g>223?3:g>191?2:1;if(n+p<=s)switch(p){case 1:g<128&&(d=g);break;case 2:128==(192&(l=e[n+1]))&&(h=(31&g)<<6|63&l)>127&&(d=h);break;case 3:l=e[n+1],c=e[n+2],128==(192&l)&&128==(192&c)&&(h=(15&g)<<12|(63&l)<<6|63&c)>2047&&(h<55296||h>57343)&&(d=h);break;case 4:l=e[n+1],c=e[n+2],u=e[n+3],128==(192&l)&&128==(192&c)&&128==(192&u)&&(h=(15&g)<<18|(63&l)<<12|(63&c)<<6|63&u)>65535&&h<1114112&&(d=h)}null===d?(d=65533,p=1):d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|1023&d),i.push(d),n+=p}return function decodeCodePointsArray(e){var t=e.length;if(t<=a)return String.fromCharCode.apply(String,e);var s="",i=0;for(;i<t;)s+=String.fromCharCode.apply(String,e.slice(i,i+=a));return s}(i)}s.kMaxLength=n,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,s){return from(e,t,s)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(e,t,s){return function alloc(e,t,s){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof s?createBuffer(e).fill(t,s):createBuffer(e).fill(t):createBuffer(e)}(e,t,s)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function isBuffer(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function compare(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var s=e.length,i=t.length,n=0,a=Math.min(s,i);n<a;++n)if(e[n]!==t[n]){s=e[n],i=t[n];break}return s<i?-1:i<s?1:0},Buffer.isEncoding=function isEncoding(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var s;if(void 0===t)for(t=0,s=0;s<e.length;++s)t+=e[s].length;var i=Buffer.allocUnsafe(t),n=0;for(s=0;s<e.length;++s){var a=e[s];if(isInstance(a,Uint8Array)&&(a=Buffer.from(a)),!Buffer.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,n),n+=a.length}return i},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function swap32(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function swap64(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function toString(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function inspect(){var e="",t=s.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},Buffer.prototype.compare=function compare(e,t,s,i,n){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||s>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=s)return 0;if(i>=n)return-1;if(t>=s)return 1;if(this===e)return 0;for(var a=(n>>>=0)-(i>>>=0),l=(s>>>=0)-(t>>>=0),c=Math.min(a,l),u=this.slice(i,n),h=e.slice(t,s),g=0;g<c;++g)if(u[g]!==h[g]){a=u[g],l=h[g];break}return a<l?-1:l<a?1:0},Buffer.prototype.includes=function includes(e,t,s){return-1!==this.indexOf(e,t,s)},Buffer.prototype.indexOf=function indexOf(e,t,s){return bidirectionalIndexOf(this,e,t,s,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(e,t,s){return bidirectionalIndexOf(this,e,t,s,!1)},Buffer.prototype.write=function write(e,t,s,i){if(void 0===t)i="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)i=t,s=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(s)?(s>>>=0,void 0===i&&(i="utf8")):(i=s,s=void 0)}var n=this.length-t;if((void 0===s||s>n)&&(s=n),e.length>0&&(s<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return hexWrite(this,e,t,s);case"utf8":case"utf-8":return utf8Write(this,e,t,s);case"ascii":return asciiWrite(this,e,t,s);case"latin1":case"binary":return latin1Write(this,e,t,s);case"base64":return base64Write(this,e,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,s);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var a=4096;function asciiSlice(e,t,s){var i="";s=Math.min(e.length,s);for(var n=t;n<s;++n)i+=String.fromCharCode(127&e[n]);return i}function latin1Slice(e,t,s){var i="";s=Math.min(e.length,s);for(var n=t;n<s;++n)i+=String.fromCharCode(e[n]);return i}function hexSlice(e,t,s){var i=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>i)&&(s=i);for(var n="",a=t;a<s;++a)n+=toHex(e[a]);return n}function utf16leSlice(e,t,s){for(var i=e.slice(t,s),n="",a=0;a<i.length;a+=2)n+=String.fromCharCode(i[a]+256*i[a+1]);return n}function checkOffset(e,t,s){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>s)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,s,i,n,a){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw new RangeError('"value" argument is out of bounds');if(s+i>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,s,i,n,a){if(s+i>e.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function writeFloat(e,t,s,n,a){return t=+t,s>>>=0,a||checkIEEE754(e,0,s,4),i.write(e,t,s,n,23,4),s+4}function writeDouble(e,t,s,n,a){return t=+t,s>>>=0,a||checkIEEE754(e,0,s,8),i.write(e,t,s,n,52,8),s+8}Buffer.prototype.slice=function slice(e,t){var s=this.length;(e=~~e)<0?(e+=s)<0&&(e=0):e>s&&(e=s),(t=void 0===t?s:~~t)<0?(t+=s)<0&&(t=0):t>s&&(t=s),t<e&&(t=e);var i=this.subarray(e,t);return i.__proto__=Buffer.prototype,i},Buffer.prototype.readUIntLE=function readUIntLE(e,t,s){e>>>=0,t>>>=0,s||checkOffset(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i},Buffer.prototype.readUIntBE=function readUIntBE(e,t,s){e>>>=0,t>>>=0,s||checkOffset(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},Buffer.prototype.readUInt8=function readUInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function readUInt16LE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function readIntLE(e,t,s){e>>>=0,t>>>=0,s||checkOffset(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readIntBE=function readIntBE(e,t,s){e>>>=0,t>>>=0,s||checkOffset(e,t,this.length);for(var i=t,n=1,a=this[e+--i];i>0&&(n*=256);)a+=this[e+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},Buffer.prototype.readInt8=function readInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function readInt16LE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?4294901760|s:s},Buffer.prototype.readInt16BE=function readInt16BE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?4294901760|s:s},Buffer.prototype.readInt32LE=function readInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function readFloatLE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),i.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),i.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),i.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),i.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(e,t,s,i){(e=+e,t>>>=0,s>>>=0,i)||checkInt(this,e,t,s,Math.pow(2,8*s)-1,0);var n=1,a=0;for(this[t]=255&e;++a<s&&(n*=256);)this[t+a]=e/n&255;return t+s},Buffer.prototype.writeUIntBE=function writeUIntBE(e,t,s,i){(e=+e,t>>>=0,s>>>=0,i)||checkInt(this,e,t,s,Math.pow(2,8*s)-1,0);var n=s-1,a=1;for(this[t+n]=255&e;--n>=0&&(a*=256);)this[t+n]=e/a&255;return t+s},Buffer.prototype.writeUInt8=function writeUInt8(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function writeIntLE(e,t,s,i){if(e=+e,t>>>=0,!i){var n=Math.pow(2,8*s-1);checkInt(this,e,t,s,n-1,-n)}var a=0,l=1,c=0;for(this[t]=255&e;++a<s&&(l*=256);)e<0&&0===c&&0!==this[t+a-1]&&(c=1),this[t+a]=(e/l|0)-c&255;return t+s},Buffer.prototype.writeIntBE=function writeIntBE(e,t,s,i){if(e=+e,t>>>=0,!i){var n=Math.pow(2,8*s-1);checkInt(this,e,t,s,n-1,-n)}var a=s-1,l=1,c=0;for(this[t+a]=255&e;--a>=0&&(l*=256);)e<0&&0===c&&0!==this[t+a+1]&&(c=1),this[t+a]=(e/l|0)-c&255;return t+s},Buffer.prototype.writeInt8=function writeInt8(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function writeInt16LE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function writeInt16BE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function writeInt32LE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function writeInt32BE(e,t,s){return e=+e,t>>>=0,s||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function writeFloatLE(e,t,s){return writeFloat(this,e,t,!0,s)},Buffer.prototype.writeFloatBE=function writeFloatBE(e,t,s){return writeFloat(this,e,t,!1,s)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(e,t,s){return writeDouble(this,e,t,!0,s)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(e,t,s){return writeDouble(this,e,t,!1,s)},Buffer.prototype.copy=function copy(e,t,s,i){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(s||(s=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<s&&(i=s),i===s)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-s&&(i=e.length-t+s);var n=i-s;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,s,i);else if(this===e&&s<t&&t<i)for(var a=n-1;a>=0;--a)e[a+t]=this[a+s];else Uint8Array.prototype.set.call(e,this.subarray(s,i),t);return n},Buffer.prototype.fill=function fill(e,t,s,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,s=this.length):"string"==typeof s&&(i=s,s=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Buffer.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var n=e.charCodeAt(0);("utf8"===i&&n<128||"latin1"===i)&&(e=n)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<s)throw new RangeError("Out of range index");if(s<=t)return this;var a;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(a=t;a<s;++a)this[a]=e;else{var l=Buffer.isBuffer(e)?e:Buffer.from(e,i),c=l.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<s-t;++a)this[a+t]=l[a%c]}return this};var l=/[^+/0-9A-Za-z-_]/g;function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var s;t=t||1/0;for(var i=e.length,n=null,a=[],l=0;l<i;++l){if((s=e.charCodeAt(l))>55295&&s<57344){if(!n){if(s>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(l+1===i){(t-=3)>-1&&a.push(239,191,189);continue}n=s;continue}if(s<56320){(t-=3)>-1&&a.push(239,191,189),n=s;continue}s=65536+(n-55296<<10|s-56320)}else n&&(t-=3)>-1&&a.push(239,191,189);if(n=null,s<128){if((t-=1)<0)break;a.push(s)}else if(s<2048){if((t-=2)<0)break;a.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;a.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return a}function base64ToBytes(e){return t.toByteArray(function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(l,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function blitBuffer(e,t,s,i){for(var n=0;n<i&&!(n+s>=t.length||n>=e.length);++n)t[n+s]=e[n];return n}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":35,buffer:36,ieee754:58}],37:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.hasCORS=void 0;let i=!1;try{i="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}s.hasCORS=i},{}],38:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.encode=function encode(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t},s.decode=function decode(e){let t={},s=e.split("&");for(let e=0,i=s.length;e<i;e++){let i=s[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},{}],39:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.parse=function parse(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),a=e.indexOf("]");-1!=s&&-1!=a&&(e=e.substring(0,s)+e.substring(s,a).replace(/:/g,";")+e.substring(a,e.length));let l=i.exec(e||""),c={},u=14;for(;u--;)c[n[u]]=l[u]||"";-1!=s&&-1!=a&&(c.source=t,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0);return c.pathNames=function pathNames(e,t){const s=t.replace(/\/{2,9}/g,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1);"/"==t.slice(-1)&&s.splice(s.length-1,1);return s}(0,c.path),c.queryKey=function queryKey(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(s[t]=i)}),s}(0,c.query),c};const i=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]},{}],40:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.defaultBinaryType=s.globalThisShim=s.nextTick=void 0,s.createCookieJar=function createCookieJar(){},s.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),s.globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),s.defaultBinaryType="arraybuffer"},{}],41:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WebTransport=s.WebSocket=s.NodeWebSocket=s.XHR=s.NodeXHR=s.Fetch=s.nextTick=s.parse=s.installTimerFunctions=s.transports=s.TransportError=s.Transport=s.protocol=s.SocketWithUpgrade=s.SocketWithoutUpgrade=s.Socket=void 0;const i=e("./socket.js");Object.defineProperty(s,"Socket",{enumerable:!0,get:function(){return i.Socket}});var n=e("./socket.js");Object.defineProperty(s,"SocketWithoutUpgrade",{enumerable:!0,get:function(){return n.SocketWithoutUpgrade}}),Object.defineProperty(s,"SocketWithUpgrade",{enumerable:!0,get:function(){return n.SocketWithUpgrade}}),s.protocol=i.Socket.protocol;var a=e("./transport.js");Object.defineProperty(s,"Transport",{enumerable:!0,get:function(){return a.Transport}}),Object.defineProperty(s,"TransportError",{enumerable:!0,get:function(){return a.TransportError}});var l=e("./transports/index.js");Object.defineProperty(s,"transports",{enumerable:!0,get:function(){return l.transports}});var c=e("./util.js");Object.defineProperty(s,"installTimerFunctions",{enumerable:!0,get:function(){return c.installTimerFunctions}});var u=e("./contrib/parseuri.js");Object.defineProperty(s,"parse",{enumerable:!0,get:function(){return u.parse}});var h=e("./globals.node.js");Object.defineProperty(s,"nextTick",{enumerable:!0,get:function(){return h.nextTick}});var g=e("./transports/polling-fetch.js");Object.defineProperty(s,"Fetch",{enumerable:!0,get:function(){return g.Fetch}});var d=e("./transports/polling-xhr.node.js");Object.defineProperty(s,"NodeXHR",{enumerable:!0,get:function(){return d.XHR}});var p=e("./transports/polling-xhr.js");Object.defineProperty(s,"XHR",{enumerable:!0,get:function(){return p.XHR}});var f=e("./transports/websocket.node.js");Object.defineProperty(s,"NodeWebSocket",{enumerable:!0,get:function(){return f.WS}});var m=e("./transports/websocket.js");Object.defineProperty(s,"WebSocket",{enumerable:!0,get:function(){return m.WS}});var y=e("./transports/webtransport.js");Object.defineProperty(s,"WebTransport",{enumerable:!0,get:function(){return y.WT}})},{"./contrib/parseuri.js":39,"./globals.node.js":40,"./socket.js":42,"./transport.js":43,"./transports/index.js":44,"./transports/polling-fetch.js":45,"./transports/polling-xhr.js":46,"./transports/polling-xhr.node.js":46,"./transports/websocket.js":48,"./transports/websocket.node.js":48,"./transports/webtransport.js":49,"./util.js":50}],42:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Socket=s.SocketWithUpgrade=s.SocketWithoutUpgrade=void 0;const n=e("./transports/index.js"),a=e("./util.js"),l=e("./contrib/parseqs.js"),c=e("./contrib/parseuri.js"),u=e("@socket.io/component-emitter"),h=e("engine.io-parser"),g=e("./globals.node.js"),d=(0,i(e("debug")).default)("engine.io-client:socket"),p="function"==typeof addEventListener&&"function"==typeof removeEventListener,f=[];p&&addEventListener("offline",()=>{d("closing %d connection(s) because the network was lost",f.length),f.forEach(e=>e())},!1);class SocketWithoutUpgrade extends u.Emitter{constructor(e,t){if(super(),this.binaryType=g.defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const s=(0,c.parse)(e);t.hostname=s.host,t.secure="https"===s.protocol||"wss"===s.protocol,t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=(0,c.parse)(t.host).host);(0,a.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(0,l.decode)(this.opts.query)),p&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(d("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},f.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=(0,g.createCookieJar)()),this._open()}createTransport(e){d('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=h.protocol,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return d("options: %j",s),new this._transportsByName[e](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&SocketWithoutUpgrade.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){d("setting transport %s",e.name),this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){d("socket open"),this.readyState="open",SocketWithoutUpgrade.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(d('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else d('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();d("flushing %d packets in socket",e.length),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=(0,a.byteLength)(s)),t>0&&e>this._maxPayload)return d("only send %d out of %d packets",t,this.writeBuffer.length),this.writeBuffer.slice(0,t);e+=2}return d("payload size is %d (max: %d)",e,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(d("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,(0,g.nextTick)(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof s&&(i=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const n={type:e,data:t,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}close(){const close=()=>{this._onClose("forced close"),d("socket closing - telling transport to close"),this.transport.close()},cleanupAndClose=()=>{this.off("upgrade",cleanupAndClose),this.off("upgradeError",cleanupAndClose),close()},waitForUpgrade=()=>{this.once("upgrade",cleanupAndClose),this.once("upgradeError",cleanupAndClose)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()),this}_onError(e){if(d("socket error %j",e),SocketWithoutUpgrade.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return d("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(d('socket close with reason: "%s"',e),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),p&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=f.indexOf(this._offlineEventListener);-1!==e&&(d("removing listener for the 'offline' event"),f.splice(e,1))}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}s.SocketWithoutUpgrade=SocketWithoutUpgrade,SocketWithoutUpgrade.protocol=h.protocol;class SocketWithUpgrade extends SocketWithoutUpgrade{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade){d("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){d('probing transport "%s"',e);let t=this.createTransport(e),s=!1;SocketWithoutUpgrade.priorWebsocketSuccess=!1;const onTransportOpen=()=>{s||(d('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",i=>{if(!s)if("pong"===i.type&&"probe"===i.data){if(d('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;SocketWithoutUpgrade.priorWebsocketSuccess="websocket"===t.name,d('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{s||"closed"!==this.readyState&&(d("changing transport and sending upgrade packet"),cleanup(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{d('probe transport "%s" failed',e);const s=new Error("probe error");s.transport=t.name,this.emitReserved("upgradeError",s)}}))};function freezeTransport(){s||(s=!0,cleanup(),t.close(),t=null)}const onerror=s=>{const i=new Error("probe error: "+s);i.transport=t.name,freezeTransport(),d('probe transport "%s" failed because of error: %s',e,s),this.emitReserved("upgradeError",i)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(e){t&&e.name!==t.name&&(d('"%s" works - aborting "%s"',e.name,t.name),freezeTransport())}const cleanup=()=>{t.removeListener("open",onTransportOpen),t.removeListener("error",onerror),t.removeListener("close",onTransportClose),this.off("close",onclose),this.off("upgrading",onupgrade)};t.once("open",onTransportOpen),t.once("error",onerror),t.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}s.SocketWithUpgrade=SocketWithUpgrade;s.Socket=class Socket extends SocketWithUpgrade{constructor(e,t={}){const s="object"==typeof e?e:t;(!s.transports||s.transports&&"string"==typeof s.transports[0])&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(e=>n.transports[e]).filter(e=>!!e)),super(e,s)}}},{"./contrib/parseqs.js":38,"./contrib/parseuri.js":39,"./globals.node.js":40,"./transports/index.js":44,"./util.js":50,"@socket.io/component-emitter":2,debug:51,"engine.io-parser":57}],43:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Transport=s.TransportError=void 0;const n=e("engine.io-parser"),a=e("@socket.io/component-emitter"),l=e("./util.js"),c=e("./contrib/parseqs.js"),u=(0,i(e("debug")).default)("engine.io-client:transport");class TransportError extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}s.TransportError=TransportError;class Transport extends a.Emitter{constructor(e){super(),this.writable=!1,(0,l.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new TransportError(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):u("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=(0,n.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=(0,c.encode)(e);return t.length?"?"+t:""}}s.Transport=Transport},{"./contrib/parseqs.js":38,"./util.js":50,"@socket.io/component-emitter":2,debug:51,"engine.io-parser":57}],44:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.transports=void 0;const i=e("./polling-xhr.node.js"),n=e("./websocket.node.js"),a=e("./webtransport.js");s.transports={websocket:n.WS,webtransport:a.WT,polling:i.XHR}},{"./polling-xhr.node.js":46,"./websocket.node.js":48,"./webtransport.js":49}],45:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Fetch=void 0;const i=e("./polling.js");class Fetch extends i.Polling{doPoll(){this._fetch().then(e=>{if(!e.ok)return this.onError("fetch read error",e.status,e);e.text().then(e=>this.onData(e))}).catch(e=>{this.onError("fetch read error",e)})}doWrite(e,t){this._fetch(e).then(e=>{if(!e.ok)return this.onError("fetch write error",e.status,e);t()}).catch(e=>{this.onError("fetch write error",e)})}_fetch(e){var t;const s=void 0!==e,i=new Headers(this.opts.extraHeaders);return s&&i.set("content-type","text/plain;charset=UTF-8"),null===(t=this.socket._cookieJar)||void 0===t||t.appendCookies(i),fetch(this.uri(),{method:s?"POST":"GET",body:s?e:null,headers:i,credentials:this.opts.withCredentials?"include":"omit"}).then(e=>{var t;return null===(t=this.socket._cookieJar)||void 0===t||t.parseCookies(e.headers.getSetCookie()),e})}}s.Fetch=Fetch},{"./polling.js":47}],46:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.XHR=s.Request=s.BaseXHR=void 0;const n=e("./polling.js"),a=e("@socket.io/component-emitter"),l=e("../util.js"),c=e("../globals.node.js"),u=e("../contrib/has-cors.js"),h=(0,i(e("debug")).default)("engine.io-client:polling");function empty(){}class BaseXHR extends n.Polling{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){h("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}s.BaseXHR=BaseXHR;class Request extends a.Emitter{constructor(e,t,s){super(),this.createRequest=e,(0,l.installTimerFunctions)(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var e;const t=(0,l.pick)(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{h("xhr open %s: %s",this._method,this._uri),s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&s.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(e){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{s.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(s.getResponseHeader("set-cookie"))),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof s.status?s.status:0)},0))},h("xhr data %s",this._data),s.send(this._data)}catch(e){return void this.setTimeoutFn(()=>{this._onError(e)},0)}"undefined"!=typeof document&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=empty,e)try{this._xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(s.Request=Request,Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){const e="onpagehide"in c.globalThisShim?"pagehide":"unload";addEventListener(e,unloadHandler,!1)}function unloadHandler(){for(let e in Request.requests)Request.requests.hasOwnProperty(e)&&Request.requests[e].abort()}const g=function(){const e=newRequest({xdomain:!1});return e&&null!==e.responseType}();function newRequest(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||u.hasCORS))return new XMLHttpRequest}catch(e){}if(!t)try{return new(c.globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}s.XHR=class XHR extends BaseXHR{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=g&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Request(newRequest,this.uri(),e)}}},{"../contrib/has-cors.js":37,"../globals.node.js":40,"../util.js":50,"./polling.js":47,"@socket.io/component-emitter":2,debug:51}],47:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Polling=void 0;const n=e("../transport.js"),a=e("../util.js"),l=e("engine.io-parser"),c=(0,i(e("debug")).default)("engine.io-client:polling");class Polling extends n.Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const pause=()=>{c("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(c("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){c("pre-pause polling complete"),--e||pause()})),this.writable||(c("we are currently writing - waiting to pause"),e++,this.once("drain",function(){c("pre-pause writing complete"),--e||pause()}))}else pause()}_poll(){c("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){c("polling got data %s",e);(0,l.decodePayload)(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this._poll():c('ignoring poll - transport state "%s"',this.readyState))}doClose(){const close=()=>{c("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(c("transport open - closing"),close()):(c("transport not open - deferring close"),this.once("open",close))}write(e){this.writable=!1,(0,l.encodePayload)(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,a.randomString)()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}s.Polling=Polling},{"../transport.js":43,"../util.js":50,debug:51,"engine.io-parser":57}],48:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.WS=s.BaseWS=void 0;const n=e("../transport.js"),a=e("../util.js"),l=e("engine.io-parser"),c=e("../globals.node.js"),u=(0,i(e("debug")).default)("engine.io-client:websocket"),h="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class BaseWS extends n.Transport{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=h?{}:(0,a.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;(0,l.encodePacket)(s,this.supportsBinary,e=>{try{this.doWrite(s,e)}catch(e){u("websocket closed before onclose event")}i&&(0,c.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,a.randomString)()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}s.BaseWS=BaseWS;const g=c.globalThisShim.WebSocket||c.globalThisShim.MozWebSocket;s.WS=class WS extends BaseWS{createSocket(e,t,s){return h?new g(e,t,s):t?new g(e,t):new g(e)}doWrite(e,t){this.ws.send(t)}}},{"../globals.node.js":40,"../transport.js":43,"../util.js":50,debug:51,"engine.io-parser":57}],49:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.WT=void 0;const n=e("../transport.js"),a=e("../globals.node.js"),l=e("engine.io-parser"),c=(0,i(e("debug")).default)("engine.io-client:webtransport");class WT extends n.Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{c("transport closed gracefully"),this.onClose()}).catch(e=>{c("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=(0,l.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),i=(0,l.createPacketEncoderStream)();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const read=()=>{s.read().then(({done:e,value:t})=>{e?c("session is closed"):(c("received chunk: %o",t),this.onPacket(t),read())}).catch(e=>{c("an error occurred while reading: %s",e)})};read();const n={type:"open"};this.query.sid&&(n.data=`{"sid":"${this.query.sid}"}`),this._writer.write(n).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;this._writer.write(s).then(()=>{i&&(0,a.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}}s.WT=WT},{"../globals.node.js":40,"../transport.js":43,debug:51,"engine.io-parser":57}],50:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.pick=function pick(e,...t){return t.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})},s.installTimerFunctions=function installTimerFunctions(e,t){t.useNativeTimers?(e.setTimeoutFn=n.bind(i.globalThisShim),e.clearTimeoutFn=a.bind(i.globalThisShim)):(e.setTimeoutFn=i.globalThisShim.setTimeout.bind(i.globalThisShim),e.clearTimeoutFn=i.globalThisShim.clearTimeout.bind(i.globalThisShim))},s.byteLength=function byteLength(e){if("string"==typeof e)return function utf8Length(e){let t=0,s=0;for(let i=0,n=e.length;i<n;i++)t=e.charCodeAt(i),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(i++,s+=4);return s}(e);return Math.ceil((e.byteLength||e.size)*l)},s.randomString=function randomString(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)};const i=e("./globals.node.js");const n=i.globalThisShim.setTimeout,a=i.globalThisShim.clearTimeout;const l=1.33},{"./globals.node.js":40}],51:[function(e,t,s){(function(i){(function(){s.formatArgs=function formatArgs(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;e.splice(1,0,s,"color: inherit");let i=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))}),e.splice(n,0,s)},s.save=function save(e){try{e?s.storage.setItem("debug",e):s.storage.removeItem("debug")}catch(e){}},s.load=function load(){let e;try{e=s.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},s.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},s.storage=function localstorage(){try{return localStorage}catch(e){}}(),s.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),s.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],s.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(s);const{formatters:n}=t.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":52,_process:60}],52:[function(e,t,s){t.exports=function setup(t){function createDebug(e){let t,s,i,n=null;function debug(...e){if(!debug.enabled)return;const s=debug,i=Number(new Date),n=i-(t||i);s.diff=n,s.prev=t,s.curr=i,t=i,e[0]=createDebug.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if("%%"===t)return"%";a++;const n=createDebug.formatters[i];if("function"==typeof n){const i=e[a];t=n.call(s,i),e.splice(a,1),a--}return t}),createDebug.formatArgs.call(s,e);(s.log||createDebug.log).apply(s,e)}return debug.namespace=e,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(e),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==n?n:(s!==createDebug.namespaces&&(s=createDebug.namespaces,i=createDebug.enabled(e)),i),set:e=>{n=e}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(e,t){const s=createDebug(this.namespace+(void 0===t?":":t)+e);return s.log=this.log,s}function toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(e){if(e instanceof Error)return e.stack||e.message;return e},createDebug.disable=function disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(e=>"-"+e)].join(",");return createDebug.enable(""),e},createDebug.enable=function enable(e){let t;createDebug.save(e),createDebug.namespaces=e,createDebug.names=[],createDebug.skips=[];const s=("string"==typeof e?e:"").split(/[\s,]+/),i=s.length;for(t=0;t<i;t++)s[t]&&("-"===(e=s[t].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+e.slice(1)+"$")):createDebug.names.push(new RegExp("^"+e+"$")))},createDebug.enabled=function enabled(e){if("*"===e[e.length-1])return!0;let t,s;for(t=0,s=createDebug.skips.length;t<s;t++)if(createDebug.skips[t].test(e))return!1;for(t=0,s=createDebug.names.length;t<s;t++)if(createDebug.names[t].test(e))return!0;return!1},createDebug.humanize=e("ms"),createDebug.destroy=function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{createDebug[e]=t[e]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function selectColor(e){let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return createDebug.colors[Math.abs(t)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},{ms:59}],53:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ERROR_PACKET=s.PACKET_TYPES_REVERSE=s.PACKET_TYPES=void 0;const i=Object.create(null);s.PACKET_TYPES=i,i.open="0",i.close="1",i.ping="2",i.pong="3",i.message="4",i.upgrade="5",i.noop="6";const n=Object.create(null);s.PACKET_TYPES_REVERSE=n,Object.keys(i).forEach(e=>{n[i[e]]=e});s.ERROR_PACKET={type:"error",data:"parser error"}},{}],54:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.decode=s.encode=void 0;const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)n[i.charCodeAt(e)]=e;s.encode=e=>{let t,s=new Uint8Array(e),n=s.length,a="";for(t=0;t<n;t+=3)a+=i[s[t]>>2],a+=i[(3&s[t])<<4|s[t+1]>>4],a+=i[(15&s[t+1])<<2|s[t+2]>>6],a+=i[63&s[t+2]];return n%3==2?a=a.substring(0,a.length-1)+"=":n%3==1&&(a=a.substring(0,a.length-2)+"=="),a};s.decode=e=>{let t,s,i,a,l,c=.75*e.length,u=e.length,h=0;"="===e[e.length-1]&&(c--,"="===e[e.length-2]&&c--);const g=new ArrayBuffer(c),d=new Uint8Array(g);for(t=0;t<u;t+=4)s=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],a=n[e.charCodeAt(t+2)],l=n[e.charCodeAt(t+3)],d[h++]=s<<2|i>>4,d[h++]=(15&i)<<4|a>>2,d[h++]=(3&a)<<6|63&l;return g}},{}],55:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.decodePacket=void 0;const i=e("./commons.js"),n=e("./contrib/base64-arraybuffer.js"),a="function"==typeof ArrayBuffer;s.decodePacket=(e,t)=>{if("string"!=typeof e)return{type:"message",data:mapBinary(e,t)};const s=e.charAt(0);if("b"===s)return{type:"message",data:decodeBase64Packet(e.substring(1),t)};return i.PACKET_TYPES_REVERSE[s]?e.length>1?{type:i.PACKET_TYPES_REVERSE[s],data:e.substring(1)}:{type:i.PACKET_TYPES_REVERSE[s]}:i.ERROR_PACKET};const decodeBase64Packet=(e,t)=>{if(a){const s=(0,n.decode)(e);return mapBinary(s,t)}return{base64:!0,data:e}},mapBinary=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},{"./commons.js":53,"./contrib/base64-arraybuffer.js":54}],56:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.encodePacket=void 0,s.encodePacketToBinary=function encodePacketToBinary(e,t){if(n&&e.data instanceof Blob)return e.data.arrayBuffer().then(toArray).then(t);if(a&&(e.data instanceof ArrayBuffer||isView(e.data)))return t(toArray(e.data));encodePacket(e,!1,e=>{l||(l=new TextEncoder),t(l.encode(e))})};const i=e("./commons.js"),n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,isView=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,encodePacket=({type:e,data:t},s,l)=>n&&t instanceof Blob?s?l(t):encodeBlobAsBase64(t,l):a&&(t instanceof ArrayBuffer||isView(t))?s?l(t):encodeBlobAsBase64(new Blob([t]),l):l(i.PACKET_TYPES[e]+(t||""));s.encodePacket=encodePacket;const encodeBlobAsBase64=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};function toArray(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let l},{"./commons.js":53}],57:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.decodePayload=s.decodePacket=s.encodePayload=s.encodePacket=s.protocol=void 0,s.createPacketEncoderStream=function createPacketEncoderStream(){return new TransformStream({transform(e,t){(0,i.encodePacketToBinary)(e,s=>{const i=s.length;let n;if(i<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,i);else if(i<65536){n=new Uint8Array(3);const e=new DataView(n.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{n=new Uint8Array(9);const e=new DataView(n.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(n[0]|=128),t.enqueue(n),t.enqueue(s)})}})},s.createPacketDecoderStream=function createPacketDecoderStream(e,t){c||(c=new TextDecoder);const s=[];let i=0,l=-1,u=!1;return new TransformStream({transform(h,g){for(s.push(h);;){if(0===i){if(totalLength(s)<1)break;const e=concatChunks(s,1);u=!(128&~e[0]),l=127&e[0],i=l<126?3:126===l?1:2}else if(1===i){if(totalLength(s)<2)break;const e=concatChunks(s,2);l=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(totalLength(s)<8)break;const e=concatChunks(s,8),t=new DataView(e.buffer,e.byteOffset,e.length),n=t.getUint32(0);if(n>Math.pow(2,21)-1){g.enqueue(a.ERROR_PACKET);break}l=n*Math.pow(2,32)+t.getUint32(4),i=3}else{if(totalLength(s)<l)break;const e=concatChunks(s,l);g.enqueue((0,n.decodePacket)(u?e:c.decode(e),t)),i=0}if(0===l||l>e){g.enqueue(a.ERROR_PACKET);break}}}})};const i=e("./encodePacket.js");Object.defineProperty(s,"encodePacket",{enumerable:!0,get:function(){return i.encodePacket}});const n=e("./decodePacket.js");Object.defineProperty(s,"decodePacket",{enumerable:!0,get:function(){return n.decodePacket}});const a=e("./commons.js"),l=String.fromCharCode(30);s.encodePayload=(e,t)=>{const s=e.length,n=new Array(s);let a=0;e.forEach((e,c)=>{(0,i.encodePacket)(e,!1,e=>{n[c]=e,++a===s&&t(n.join(l))})})};let c;function totalLength(e){return e.reduce((e,t)=>e+t.length,0)}function concatChunks(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let i=0;for(let n=0;n<t;n++)s[n]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),s}s.decodePayload=(e,t)=>{const s=e.split(l),i=[];for(let e=0;e<s.length;e++){const a=(0,n.decodePacket)(s[e],t);if(i.push(a),"error"===a.type)break}return i},s.protocol=4},{"./commons.js":53,"./decodePacket.js":55,"./encodePacket.js":56}],58:[function(e,t,s){s.read=function(e,t,s,i,n){var a,l,c=8*n-i-1,u=(1<<c)-1,h=u>>1,g=-7,d=s?n-1:0,p=s?-1:1,f=e[t+d];for(d+=p,a=f&(1<<-g)-1,f>>=-g,g+=c;g>0;a=256*a+e[t+d],d+=p,g-=8);for(l=a&(1<<-g)-1,a>>=-g,g+=i;g>0;l=256*l+e[t+d],d+=p,g-=8);if(0===a)a=1-h;else{if(a===u)return l?NaN:1/0*(f?-1:1);l+=Math.pow(2,i),a-=h}return(f?-1:1)*l*Math.pow(2,a-i)},s.write=function(e,t,s,i,n,a){var l,c,u,h=8*a-n-1,g=(1<<h)-1,d=g>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,m=i?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,l=g):(l=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-l))<1&&(l--,u*=2),(t+=l+d>=1?p/u:p*Math.pow(2,1-d))*u>=2&&(l++,u/=2),l+d>=g?(c=0,l=g):l+d>=1?(c=(t*u-1)*Math.pow(2,n),l+=d):(c=t*Math.pow(2,d-1)*Math.pow(2,n),l=0));n>=8;e[s+f]=255&c,f+=m,c/=256,n-=8);for(l=l<<n|c,h+=n;h>0;e[s+f]=255&l,f+=m,l/=256,h-=8);e[s+f-m]|=128*y}},{}],59:[function(e,t,s){var i=1e3,n=60*i,a=60*n,l=24*a,c=7*l,u=365.25*l;function plural(e,t,s,i){var n=t>=1.5*s;return Math.round(e/s)+" "+i+(n?"s":"")}t.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function parse(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*u;case"weeks":case"week":case"w":return s*c;case"days":case"day":case"d":return s*l;case"hours":case"hour":case"hrs":case"hr":case"h":return s*a;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===s&&isFinite(e))return t.long?function fmtLong(e){var t=Math.abs(e);if(t>=l)return plural(e,t,l,"day");if(t>=a)return plural(e,t,a,"hour");if(t>=n)return plural(e,t,n,"minute");if(t>=i)return plural(e,t,i,"second");return e+" ms"}(e):function fmtShort(e){var t=Math.abs(e);if(t>=l)return Math.round(e/l)+"d";if(t>=a)return Math.round(e/a)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],60:[function(e,t,s){var i,n,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(i===setTimeout)return setTimeout(e,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){i=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var l,c=[],u=!1,h=-1;function cleanUpNextTick(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&drainQueue())}function drainQueue(){if(!u){var e=runTimeout(cleanUpNextTick);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new Item(e,t)),1!==c.length||u||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],61:[function(e,t,s){"use strict";function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Object.defineProperty(s,"__esModule",{value:!0}),s.Backoff=Backoff,Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+s:e-s}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e}},{}],62:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.WebTransport=s.WebSocket=s.NodeWebSocket=s.XHR=s.NodeXHR=s.Fetch=s.Socket=s.Manager=s.protocol=void 0,s.io=lookup,s.connect=lookup,s.default=lookup;const n=e("./url.js"),a=e("./manager.js");Object.defineProperty(s,"Manager",{enumerable:!0,get:function(){return a.Manager}});const l=e("./socket.js");Object.defineProperty(s,"Socket",{enumerable:!0,get:function(){return l.Socket}});const c=(0,i(e("debug")).default)("socket.io-client"),u={};function lookup(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const s=(0,n.url)(e,t.path||"/socket.io"),i=s.source,l=s.id,h=s.path,g=u[l]&&h in u[l].nsps;let d;return t.forceNew||t["force new connection"]||!1===t.multiplex||g?(c("ignoring socket cache for %s",i),d=new a.Manager(i,t)):(u[l]||(c("new io instance for %s",i),u[l]=new a.Manager(i,t)),d=u[l]),s.query&&!t.query&&(t.query=s.queryKey),d.socket(s.path,t)}Object.assign(lookup,{Manager:a.Manager,Socket:l.Socket,io:lookup,connect:lookup});var h=e("socket.io-parser");Object.defineProperty(s,"protocol",{enumerable:!0,get:function(){return h.protocol}});var g=e("engine.io-client");Object.defineProperty(s,"Fetch",{enumerable:!0,get:function(){return g.Fetch}}),Object.defineProperty(s,"NodeXHR",{enumerable:!0,get:function(){return g.NodeXHR}}),Object.defineProperty(s,"XHR",{enumerable:!0,get:function(){return g.XHR}}),Object.defineProperty(s,"NodeWebSocket",{enumerable:!0,get:function(){return g.NodeWebSocket}}),Object.defineProperty(s,"WebSocket",{enumerable:!0,get:function(){return g.WebSocket}}),Object.defineProperty(s,"WebTransport",{enumerable:!0,get:function(){return g.WebTransport}}),t.exports=lookup},{"./manager.js":63,"./socket.js":65,"./url.js":66,debug:67,"engine.io-client":41,"socket.io-parser":70}],63:[function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,n)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return n(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Manager=void 0;const c=e("engine.io-client"),u=e("./socket.js"),h=a(e("socket.io-parser")),g=e("./on.js"),d=e("./contrib/backo2.js"),p=e("@socket.io/component-emitter"),f=(0,l(e("debug")).default)("socket.io-client:manager");class Manager extends p.Emitter{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,(0,c.installTimerFunctions)(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=t.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new d.Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||h;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(f("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=new c.Socket(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=(0,g.on)(t,"open",function(){s.onopen(),e&&e()}),onError=t=>{f("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},n=(0,g.on)(t,"error",onError);if(!1!==this._timeout){const e=this._timeout;f("connect attempt will timeout after %d",e);const s=this.setTimeoutFn(()=>{f("connect attempt timed out after %d",e),i(),onError(new Error("timeout")),t.close()},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}return this.subs.push(i),this.subs.push(n),this}connect(e){return this.open(e)}onopen(){f("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push((0,g.on)(e,"ping",this.onping.bind(this)),(0,g.on)(e,"data",this.ondata.bind(this)),(0,g.on)(e,"error",this.onerror.bind(this)),(0,g.on)(e,"close",this.onclose.bind(this)),(0,g.on)(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){(0,c.nextTick)(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){f("error",e),this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new u.Socket(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return void f("socket %s is still active, skipping close",e)}this._close()}_packet(e){f("writing packet %j",e);const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){f("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){f("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;f("closed due to %s",e),this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();f("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(f("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(f("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(f("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}s.Manager=Manager},{"./contrib/backo2.js":61,"./on.js":64,"./socket.js":65,"@socket.io/component-emitter":2,debug:67,"engine.io-client":41,"socket.io-parser":70}],64:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.on=function on(e,t,s){return e.on(t,s),function subDestroy(){e.off(t,s)}}},{}],65:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Socket=void 0;const n=e("socket.io-parser"),a=e("./on.js"),l=e("@socket.io/component-emitter"),c=(0,i(e("debug")).default)("socket.io-client:socket"),u=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends l.Emitter{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[(0,a.on)(e,"open",this.onopen.bind(this)),(0,a.on)(e,"packet",this.onpacket.bind(this)),(0,a.on)(e,"error",this.onerror.bind(this)),(0,a.on)(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i,a;if(u.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const l={type:n.PacketType.EVENT,data:t,options:{}};if(l.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++;c("emitting packet with ack id %d",e);const s=t.pop();this._registerAckCallback(e,s),l.id=e}const h=null===(i=null===(s=this.io.engine)||void 0===s?void 0:s.transport)||void 0===i?void 0:i.writable,g=this.connected&&!(null===(a=this.io.engine)||void 0===a?void 0:a._hasPingExpired());return this.flags.volatile&&!h?c("discard packet as the transport is not currently writable"):g?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l),this.flags={},this}_registerAckCallback(e,t){var s;const i=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&(c("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(t,1));c("event with ack id %d has timed out after %d ms",e,i),t.call(this,new Error("operation has timed out"))},i),fn=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,e)};fn.withError=!0,this.acks[e]=fn}emitWithAck(e,...t){return new Promise((s,i)=>{const fn=(e,t)=>e?i(e):s(t);fn.withError=!0,t.push(fn),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...i)=>{if(s!==this._queue[0])return;return null!==e?s.tryCount>this._opts.retries&&(c("packet [%d] is discarded after %d tries",s.id,s.tryCount),this._queue.shift(),t&&t(e)):(c("packet [%d] was successfully sent",s.id),this._queue.shift(),t&&t(null,...i)),s.pending=!1,this._drainQueue()}),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(c("draining queue"),!this.connected||0===this._queue.length)return;const t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,c("sending packet [%d] (try n%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):c("packet [%d] has already been sent and is waiting for an ack",t.id)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){c("transport is open - connecting"),"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:n.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){c("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case n.PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case n.PacketType.EVENT:case n.PacketType.BINARY_EVENT:this.onevent(e);break;case n.PacketType.ACK:case n.PacketType.BINARY_ACK:this.onack(e);break;case n.PacketType.DISCONNECT:this.ondisconnect();break;case n.PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...i){s||(s=!0,c("sending ack %j",i),t.packet({type:n.PacketType.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(delete this.acks[e.id],c("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)):c("bad ack %s",e.id)}onconnect(e,t){c("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}s.Socket=Socket},{"./on.js":64,"@socket.io/component-emitter":2,debug:67,"socket.io-parser":70}],66:[function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.url=function url(e,t="",s){let i=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==s?s.protocol+"//"+e:"https://"+e),a("parse %s",e),i=(0,n.parse)(e));i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443"));i.path=i.path||"/";const l=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+l+":"+i.port+t,i.href=i.protocol+"://"+l+(s&&s.port===i.port?"":":"+i.port),i};const n=e("engine.io-client"),a=(0,i(e("debug")).default)("socket.io-client:url")},{debug:67,"engine.io-client":41}],67:[function(e,t,s){arguments[4][51][0].apply(s,arguments)},{"./common":68,_process:60,dup:51}],68:[function(e,t,s){arguments[4][52][0].apply(s,arguments)},{dup:52,ms:59}],69:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.reconstructPacket=s.deconstructPacket=void 0;const i=e("./is-binary.js");function _deconstructPacket(e,t){if(!e)return e;if((0,i.isBinary)(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let i=0;i<e.length;i++)s[i]=_deconstructPacket(e[i],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=_deconstructPacket(e[i],t));return s}return e}function _reconstructPacket(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=_reconstructPacket(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=_reconstructPacket(e[s],t));return e}s.deconstructPacket=function deconstructPacket(e){const t=[],s=e.data,i=e;return i.data=_deconstructPacket(s,t),i.attachments=t.length,{packet:i,buffers:t}},s.reconstructPacket=function reconstructPacket(e,t){return e.data=_reconstructPacket(e.data,t),delete e.attachments,e}},{"./is-binary.js":71}],70:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Decoder=s.Encoder=s.PacketType=s.protocol=void 0;const i=e("@socket.io/component-emitter"),n=e("./binary.js"),a=e("./is-binary.js"),l=(0,e("debug").default)("socket.io-parser"),c=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var u;s.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(u=s.PacketType||(s.PacketType={}));function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}s.Encoder=class Encoder{constructor(e){this.replacer=e}encode(e){return l("encoding packet %j",e),e.type!==u.EVENT&&e.type!==u.ACK||!(0,a.hasBinary)(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===u.EVENT?u.BINARY_EVENT:u.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==u.BINARY_EVENT&&e.type!==u.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),l("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=(0,n.deconstructPacket)(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}};class Decoder extends i.Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===u.BINARY_EVENT;s||t.type===u.BINARY_ACK?(t.type=s?u.EVENT:u.ACK,this.reconstructor=new BinaryReconstructor(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!(0,a.isBinary)(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===u[s.type])throw new Error("unknown packet type "+s.type);if(s.type===u.BINARY_EVENT||s.type===u.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const n=e.substring(i,t);if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(n)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(i,t)}else s.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!Decoder.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return l("decoded %s as %j",e,s),s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case u.CONNECT:return isObject(t);case u.DISCONNECT:return void 0===t;case u.CONNECT_ERROR:return"string"==typeof t||isObject(t);case u.EVENT:case u.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===c.indexOf(t[0]));case u.ACK:case u.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}s.Decoder=Decoder;class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=(0,n.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},{"./binary.js":69,"./is-binary.js":71,"@socket.io/component-emitter":2,debug:72}],71:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.hasBinary=s.isBinary=void 0;const i="function"==typeof ArrayBuffer,n=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===n.call(Blob),l="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===n.call(File);function isBinary(e){return i&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||a&&e instanceof Blob||l&&e instanceof File}s.isBinary=isBinary,s.hasBinary=function hasBinary(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(hasBinary(e[t]))return!0;return!1}if(isBinary(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&hasBinary(e[t]))return!0;return!1}},{}],72:[function(e,t,s){arguments[4][51][0].apply(s,arguments)},{"./common":73,_process:60,dup:51}],73:[function(e,t,s){arguments[4][52][0].apply(s,arguments)},{dup:52,ms:59}],74:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.createCircularProgress=function createCircularProgress(){let{value:e=0,label:t="",state:s="",id:i=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=80,a=2*Math.PI*36,l=Math.max(0,Math.min(100,e)),c=a-l/100*a,u=i||`circular-progress-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,h=document.createElement("div");return h.className="circular-progress"+(s?" "+s:""),h.id=u,h.setAttribute("role","progressbar"),h.setAttribute("aria-valuenow",l),h.setAttribute("aria-valuemin",0),h.setAttribute("aria-valuemax",100),h.setAttribute("aria-label",t?`${t} ${l}%`:`${l}%`),h.setAttribute("data-percent",l),h.setAttribute("data-state",s),h.setAttribute("data-created",(new Date).toISOString()),h.innerHTML=`\n    <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">\n      \x3c!-- Background circle --\x3e\n      <circle \n        class="circular-bg" \n        cx="40" \n        cy="40" \n        r="36" \n        fill="none"\n        stroke="#e0e0e0"\n        stroke-width="8"\n      />\n      \x3c!-- Foreground progress circle --\x3e\n      <circle \n        class="circular-fg" \n        cx="40" \n        cy="40" \n        r="36" \n        fill="none"\n        stroke="var(--brand-color, #7c3aed)"\n        stroke-width="8"\n        stroke-linecap="round"\n        stroke-dasharray="${a}"\n        stroke-dashoffset="${c}"\n        transform="rotate(-90 40 40)"\n      />\n    </svg>\n    \x3c!-- Percentage label --\x3e\n    <span class="circular-label">${Math.round(l)}%</span>\n    ${t?`<span class="circular-status">${t}</span>`:""}\n  `,console.debug("Circular Progress Created:",{id:u,percent:l,state:s,size:n,stroke:8,radius:36,circumference:a,dashOffset:c,label:t}),h}},{}],75:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ElementRegistry=void 0;const i={};function getElement(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||"string"!=typeof e)return console.error(`[ElementRegistry] Invalid selector provided: ${e}`),null;if(e.includes("<")||e.includes(">")||e.includes('"')&&!e.includes("[")&&!e.includes("]")||e.includes("'")&&!e.includes("[")&&!e.includes("]"))return console.error(`[ElementRegistry] Potentially unsafe selector detected: ${e}`),null;if(i[e])return i[e];try{const n=document.querySelector(e);if(!n&&s)console.warn(`[ElementRegistry] Missing required element: ${t} (${e})`);else if(n){if(!document.contains(n))return console.warn(`[ElementRegistry] Element found but not in DOM: ${t} (${e})`),i[e]=null,null}else console.info(`[ElementRegistry] Optional element not found: ${t} (${e})`);return i[e]=n,n}catch(s){return console.error(`[ElementRegistry] Error finding element: ${t} (${e})`,s),i[e]=null,null}}const n=s.ElementRegistry={importButton:()=>getElement("#import-btn","Import Button"),fileInput:()=>getElement("#csv-file","File Input"),dashboardTab:()=>getElement("#dashboard-tab","Dashboard Tab"),dragDropArea:()=>getElement("#drag-drop-area","Drag-and-Drop Area",!1),notificationContainer:()=>getElement("#notification-area","Notification Container"),progressContainer:()=>getElement("#import-progress-container","Import Progress Container",!1)||getElement("#delete-progress-container","Delete Progress Container",!1)||getElement("#modify-progress-container","Modify Progress Container",!1)||getElement("#export-progress-container","Export Progress Container",!1)||getElement("#progress-container","Progress Container",!1)||getElement(".progress-container","Progress Container (class)",!1),tokenStatus:()=>getElement("#token-status-indicator","Token Status"),connectionStatus:()=>getElement("#connection-status","Connection Status"),currentTokenStatus:()=>getElement("#current-token-status","Current Token Status"),homeTokenStatus:()=>getElement("#home-token-status","Home Token Status"),fileInfo:()=>getElement("#file-info","File Info"),previewContainer:()=>getElement("#dashboard-preview","Preview Container"),fileInputLabel:()=>getElement('label[for="csv-file"]',"File Input Label"),deleteFileInput:()=>getElement("#delete-csv-file","Delete File Input"),deleteFileInputLabel:()=>getElement('label[for="delete-csv-file"]',"Delete File Input Label"),modifyFileInput:()=>getElement("#modify-csv-file","Modify File Input"),modifyFileInputLabel:()=>getElement('label[for="modify-csv-file"]',"Modify File Input Label"),importPopulationSelect:()=>getElement("#import-population-select","Import Population Select"),deletePopulationSelect:()=>getElement("#delete-population-select","Delete Population Select"),modifyPopulationSelect:()=>getElement("#modify-population-select","Modify Population Select"),dashboardPopulationSelect:()=>getElement("#dashboard-population-select","Dashboard Population Select"),startImportBtn:()=>getElement("#start-import","Start Import Button"),startImportBtnBottom:()=>getElement("#bottom-start-import","Bottom Start Import Button"),settingsSaveStatus:()=>getElement("#settings-save-status","Settings Save Status"),importStatus:()=>getElement("#import-status","Import Status"),useDefaultPopulationCheckbox:()=>getElement("#use-default-population","Use Default Population Checkbox"),useCsvPopulationIdCheckbox:()=>getElement("#use-csv-population-id","Use CSV Population ID Checkbox"),getTokenBtn:()=>getElement("#get-token-quick","Get Token Button"),populationIdField:()=>getElement("#population-id","Population ID Field")};"undefined"!=typeof window&&(window.getElement=getElement,window.elementCache=i,window.ElementRegistry=n,console.log(" Element registry global exports initialized"))},{}],76:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ErrorTypes=s.ErrorSeverity=s.ErrorMetadata=s.ErrorMessages=s.ErrorCodes=void 0,s.createError=function createError(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new Error(t||l[e]||"An unknown error occurred");i.type=e,i.code=s.code||a[e]||0,i.details=s,i.timestamp=(new Date).toISOString();const n=c[e];n&&(i.severity=n.severity,i.isRecoverable=n.isRecoverable,i.userMessage=n.userMessage);return i},s.getDefaultMessage=function getDefaultMessage(e){return l[e]||"An unknown error occurred"},s.getDefaultSeverity=function getDefaultSeverity(e){const t=c[e];return t?t.severity:n.ERROR},s.isErrorType=function isErrorType(e,t){return e&&e.type===t};const i=s.ErrorTypes=Object.freeze({VALIDATION:"VALIDATION",AUTHENTICATION:"AUTHENTICATION",AUTHORIZATION:"AUTHORIZATION",NETWORK:"NETWORK",TIMEOUT:"TIMEOUT",SERVER:"SERVER",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",NOT_FOUND:"NOT_FOUND",CONFLICT:"CONFLICT",CONFIGURATION:"CONFIGURATION",INTEGRATION:"INTEGRATION",UNKNOWN:"UNKNOWN"}),n=s.ErrorSeverity=Object.freeze({FATAL:"FATAL",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",DEBUG:"DEBUG"}),a=s.ErrorCodes=Object.freeze({INVALID_CREDENTIALS:1001,SESSION_EXPIRED:1002,INVALID_TOKEN:1003,INVALID_INPUT:2001,MISSING_REQUIRED_FIELD:2002,INVALID_FORMAT:2003,PERMISSION_DENIED:3001,INSUFFICIENT_PERMISSIONS:3002,NETWORK_ERROR:4001,REQUEST_TIMEOUT:4002,INTERNAL_SERVER_ERROR:5001,SERVICE_UNAVAILABLE:5002,DUPLICATE_ENTRY:6001,RESOURCE_NOT_FOUND:6002,EXTERNAL_SERVICE_ERROR:7001,API_RATE_LIMIT_EXCEEDED:7002}),l=s.ErrorMessages=Object.freeze({[i.VALIDATION]:"Validation failed",[i.AUTHENTICATION]:"Authentication required",[i.AUTHORIZATION]:"Permission denied",[i.NETWORK]:"Network error occurred",[i.TIMEOUT]:"Request timed out",[i.SERVER]:"Internal server error",[i.SERVICE_UNAVAILABLE]:"Service unavailable",[i.NOT_FOUND]:"Resource not found",[i.CONFLICT]:"Resource conflict",[i.CONFIGURATION]:"Configuration error",[i.INTEGRATION]:"Integration error",[i.UNKNOWN]:"An unexpected error occurred"}),c=s.ErrorMetadata=Object.freeze({[i.VALIDATION]:{severity:n.WARNING,isRecoverable:!0,userMessage:"Please check your input and try again."},[i.AUTHENTICATION]:{severity:n.ERROR,isRecoverable:!0,userMessage:"Your session has expired. Please log in again."},[i.AUTHORIZATION]:{severity:n.ERROR,isRecoverable:!1,userMessage:"You do not have permission to perform this action."},[i.NETWORK]:{severity:n.WARNING,isRecoverable:!0,userMessage:"Unable to connect to the server. Please check your internet connection."},[i.SERVER]:{severity:n.ERROR,isRecoverable:!1,userMessage:"An unexpected server error occurred. Please try again later."},[i.UNKNOWN]:{severity:n.ERROR,isRecoverable:!1,userMessage:"An unexpected error occurred. Please try again."}})},{}],77:[function(e,t,s){(function(t){(function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=s.MessageFormatter=void 0;var i=e("./winston-logger.js");class MessageFormatter{constructor(){this.logger=(0,i.createWinstonLogger)({service:"pingone-message-formatter",environment:t.env.NODE_ENV||"development"}),this.formattingOptions={showTimestamps:!0,showEventMarkers:!0,showSeparators:!0,maxMessageLength:200,separatorChar:"*",separatorLength:50},this.eventTypes={import:{start:"IMPORT STARTED",end:"IMPORT COMPLETED",error:"IMPORT ERROR",color:"#3498db"},export:{start:"EXPORT STARTED",end:"EXPORT COMPLETED",error:"EXPORT ERROR",color:"#27ae60"},modify:{start:"MODIFY STARTED",end:"MODIFY COMPLETED",error:"MODIFY ERROR",color:"#f39c12"},delete:{start:"DELETE STARTED",end:"DELETE COMPLETED",error:"DELETE ERROR",color:"#e74c3c"},validation:{start:"VALIDATION STARTED",end:"VALIDATION COMPLETED",error:"VALIDATION ERROR",color:"#9b59b6"},connection:{start:"CONNECTION ESTABLISHED",end:"CONNECTION CLOSED",error:"CONNECTION ERROR",color:"#1abc9c"}}}formatMessageBlock(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const n=this.eventTypes[e]||this.eventTypes.import,a=this.formatTimestamp(new Date),l=this.createSeparator();let c="";if(this.formattingOptions.showSeparators&&(c+=l+"\n"),this.formattingOptions.showEventMarkers){c+=`${this.getEventMarker(n,t)}\n`}return this.formattingOptions.showTimestamps&&(c+=`[${a}] `),c+=s+"\n",i&&Object.keys(i).length>0&&(c+=this.formatDetails(i)),this.formattingOptions.showSeparators&&(c+=l+"\n"),this.logger.debug("Message block formatted",{eventType:e,eventStage:t,messageLength:s.length}),c}catch(e){return this.logger.error("Error formatting message block",{error:e.message}),s}}formatProgressMessage(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{const e=this.formatTimestamp(new Date),a=s>0?Math.round(t/s*100):0;let l="";return this.formattingOptions.showTimestamps&&(l+=`[${e}] `),l+=`PROGRESS: ${t}/${s} (${a}%)`,i&&(l+=` - ${i}`),n&&Object.keys(n).length>0&&(l+="\n"+this.formatProgressStats(n)),l}catch(e){return this.logger.error("Error formatting progress message",{error:e.message}),i||`Progress: ${t}/${s}`}}formatErrorMessage(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const i=this.eventTypes[e]||this.eventTypes.import,n=this.formatTimestamp(new Date),a=this.createSeparator();let l="";return this.formattingOptions.showSeparators&&(l+=a+"\n"),l+=`${i.error}\n`,this.formattingOptions.showTimestamps&&(l+=`[${n}] `),l+=`ERROR: ${t}\n`,s&&Object.keys(s).length>0&&(l+=this.formatErrorDetails(s)),this.formattingOptions.showSeparators&&(l+=a+"\n"),l}catch(e){return this.logger.error("Error formatting error message",{error:e.message}),`ERROR: ${t}`}}formatCompletionMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const s=this.eventTypes[e]||this.eventTypes.import,i=this.formatTimestamp(new Date),n=this.createSeparator();let a="";return this.formattingOptions.showSeparators&&(a+=n+"\n"),a+=`${s.end}\n`,this.formattingOptions.showTimestamps&&(a+=`[${i}] `),a+="Operation completed successfully\n",t&&Object.keys(t).length>0&&(a+=this.formatResults(t)),this.formattingOptions.showSeparators&&(a+=n+"\n"),a}catch(e){return this.logger.error("Error formatting completion message",{error:e.message}),"Operation completed successfully"}}formatSSEEvent(e){try{const{type:t,message:s,current:i,total:n,counts:a,error:l}=e,c=this.formatTimestamp(new Date);let u="";switch(this.formattingOptions.showTimestamps&&(u+=`[${c}] `),t){case"progress":u+=this.formatProgressMessage("import",i,n,s,a);break;case"completion":u+=this.formatCompletionMessage("import",e);break;case"error":u+=this.formatErrorMessage("import",s,e);break;default:u+=`SSE EVENT [${t.toUpperCase()}]: ${s||"No message"}`}return u}catch(t){return this.logger.error("Error formatting SSE event",{error:t.message}),e.message||"SSE event received"}}createSeparator(){const e=this.formattingOptions.separatorChar,t=this.formattingOptions.separatorLength;return e.repeat(t)}getEventMarker(e,t){switch(t){case"start":default:return e.start;case"end":return e.end;case"error":return e.error}}formatTimestamp(e){return e.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}formatDetails(e){try{let t="";for(const[s,i]of Object.entries(e))null!=i&&(t+=`  ${s}: ${i}\n`);return t}catch(e){return this.logger.error("Error formatting details",{error:e.message}),""}}formatProgressStats(e){try{let t="  Statistics:\n";const s={processed:"Processed",success:"Success",failed:"Failed",skipped:"Skipped",duplicates:"Duplicates"};for(const[i,n]of Object.entries(e))null!=n&&s[i]&&(t+=`    ${s[i]}: ${n}\n`);return t}catch(e){return this.logger.error("Error formatting progress stats",{error:e.message}),""}}formatErrorDetails(e){try{let t="  Error Details:\n";for(const[s,i]of Object.entries(e))null!=i&&(t+=`    ${s}: ${i}\n`);return t}catch(e){return this.logger.error("Error formatting error details",{error:e.message}),""}}formatResults(e){try{let t="  Results:\n";const s={total:"Total Records",success:"Successful",failed:"Failed",skipped:"Skipped",duplicates:"Duplicates",duration:"Duration"};for(const[i,n]of Object.entries(e))if(null!=n&&s[i]){let e=n;"duration"===i&&"number"==typeof n&&(e=this.formatDuration(n)),t+=`    ${s[i]}: ${e}\n`}return t}catch(e){return this.logger.error("Error formatting results",{error:e.message}),""}}formatDuration(e){try{const t=Math.floor(e/1e3),s=Math.floor(t/60),i=Math.floor(s/60);return i>0?`${i}h ${s%60}m ${t%60}s`:s>0?`${s}m ${t%60}s`:`${t}s`}catch(t){return this.logger.error("Error formatting duration",{error:t.message}),`${e}ms`}}updateFormattingOptions(e){try{this.formattingOptions={...this.formattingOptions,...e},this.logger.debug("Formatting options updated",{options:e})}catch(e){this.logger.error("Error updating formatting options",{error:e.message})}}getFormattingOptions(){return{...this.formattingOptions}}}s.MessageFormatter=MessageFormatter;s.default=new MessageFormatter}).call(this)}).call(this,e("_process"))},{"./winston-logger.js":81,_process:60}],78:[function(e,t,s){(function(t){(function(){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(s,"__esModule",{value:!0}),s.default=s.ProgressManager=void 0;var n=e("./winston-logger.js");e("./element-registry.js"),e("./session-manager.js"),i(e("./message-formatter.js"));const a="production"!==t.env.NODE_ENV;class ProgressManager{constructor(){this.logger=(0,n.createWinstonLogger)("pingone-progress"),this.isEnabled=!0,this.currentOperation=null,this.currentSessionId=null,this.isActive=!1,this.startTime=null,this.timingInterval=null,this.progressCallback=null,this.completeCallback=null,this.cancelCallback=null,this.duplicateHandlingMode="skip",this.socket=null,this.websocket=null,this.connectionType=null,this.connectionRetries=0,this.maxRetries=3,this.stats={processed:0,success:0,failed:0,skipped:0,total:0},this.logger.debug("ProgressManager initialized")}initialize(){try{this.setupElements(),this.setupEventListeners(),this.logger.info("Enhanced progress manager initialized successfully")}catch(e){this.logger.error("Failed to initialize progress manager",{error:e.message})}}setupElements(){try{this.progressContainer=document.getElementById("progress-container"),this.progressContainer||(this.logger.info("Main progress container not found - will use operation-specific containers"),this.isEnabled=!0),this.logger.info("Progress container found",{id:this.progressContainer.id,className:this.progressContainer.className,display:this.progressContainer.style.display,visibility:this.progressContainer.style.visibility,offsetParent:null!==this.progressContainer.offsetParent}),this.progressContainer.innerHTML='\n                <div class="progress-overlay">\n                    <div class="progress-modal">\n                        <div class="progress-header">\n                            <div class="operation-info">\n                                <h3 class="operation-title">\n                                    <i class="fas fa-cog fa-spin"></i>\n                                    <span class="title-text">Operation in Progress</span>\n                                </h3>\n                                <div class="operation-subtitle">Processing your request...</div>\n                            </div>\n                            <button class="cancel-operation" type="button" aria-label="Cancel operation">\n                                <i class="fas fa-times"></i>\n                                <span>Cancel</span>\n                            </button>\n                        </div>\n                        \n                        <div class="progress-content">\n                            <div class="progress-steps">\n                                <div class="step active" data-step="init">\n                                    <div class="step-icon">\n                                        <i class="fas fa-play"></i>\n                                    </div>\n                                    <div class="step-label">Initializing</div>\n                                </div>\n                                <div class="step" data-step="validate">\n                                    <div class="step-icon">\n                                        <i class="fas fa-check"></i>\n                                    </div>\n                                    <div class="step-label">Validating</div>\n                                </div>\n                                <div class="step" data-step="process">\n                                    <div class="step-icon">\n                                        <i class="fas fa-cogs"></i>\n                                    </div>\n                                    <div class="step-label">Processing</div>\n                                </div>\n                                <div class="step" data-step="complete">\n                                    <div class="step-icon">\n                                        <i class="fas fa-check-circle"></i>\n                                    </div>\n                                    <div class="step-label">Complete</div>\n                                </div>\n                            </div>\n                            \n                            <div class="progress-main">\n                                <div class="progress-bar-container">\n                                    <div class="progress-bar">\n                                        <div class="progress-bar-fill"></div>\n                                        <div class="progress-bar-glow"></div>\n                                    </div>\n                                    <div class="progress-percentage">0%</div>\n                                </div>\n                                \n                                <div class="progress-text">Preparing operation...</div>\n                                \n                                <div class="progress-stats">\n                                    <div class="stat-item">\n                                        <span class="stat-label">Processed:</span>\n                                        <span class="stat-value processed">0</span>\n                                    </div>\n                                    <div class="stat-item">\n                                        <span class="stat-label">Success:</span>\n                                        <span class="stat-value success">0</span>\n                                    </div>\n                                    <div class="stat-item">\n                                        <span class="stat-label">Failed:</span>\n                                        <span class="stat-value failed">0</span>\n                                    </div>\n                                    <div class="stat-item">\n                                        <span class="stat-label">Skipped:</span>\n                                        <span class="stat-value skipped">0</span>\n                                    </div>\n                                </div>\n                                \n                                <div class="progress-timing">\n                                    <div class="time-elapsed">\n                                        <i class="fas fa-clock"></i>\n                                        <span>Time: <span class="elapsed-value">00:00</span></span>\n                                    </div>\n                                    <div class="time-remaining">\n                                        <i class="fas fa-hourglass-half"></i>\n                                        <span>ETA: <span class="eta-value">Calculating...</span></span>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class="progress-details">\n                                <div class="details-header">\n                                    <h4><i class="fas fa-info-circle"></i> Operation Details</h4>\n                                </div>\n                                <div class="details-content">\n                                    <div class="detail-item">\n                                        <span class="detail-label">Operation Type:</span>\n                                        <span class="detail-value operation-type">-</span>\n                                    </div>\n                                    <div class="detail-item">\n                                        <span class="detail-label">Session ID:</span>\n                                        <span class="detail-value session-id">-</span>\n                                    </div>\n                                    <div class="detail-item">\n                                        <span class="detail-label">Population:</span>\n                                        <span class="detail-value population-info">-</span>\n                                    </div>\n                                    <div class="detail-item">\n                                        <span class="detail-label">Connection:</span>\n                                        <span class="detail-value connection-type">-</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ',this.logger.debug("Progress elements setup completed")}catch(e){this.logger.error("Error setting up progress elements",{error:e.message}),this.isEnabled=!1}}setupEventListeners(){if(this.isEnabled)try{const e=this.progressContainer.querySelector(".cancel-operation");e&&e.addEventListener("click",()=>this.cancelOperation());const t=this.progressContainer.querySelector(".close-progress-btn");t&&t.addEventListener("click",()=>this.hideProgress()),this.logger.debug("Progress event listeners setup completed")}catch(e){this.logger.error("Error setting up progress event listeners",{error:e.message})}else this.logger.warn("Progress manager not enabled - skipping event listener setup")}startOperation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isEnabled?(this.currentOperation=e,this.isActive=!0,this.startTime=Date.now(),this.resetOperationStats(),this.selectProgressContainer(e),this.progressContainer||this.createFallbackProgressContainer(e),this.progressContainer?(this.initializeProgressContainer(),this.updateOperationTitle(e),this.updateOperationDetails(t),this.showProgress(),this.startTimingUpdates(),this.logger.info("Operation started",{operationType:e,options:t})):this.logger.error("No progress container available for operation",{operationType:e})):this.logger.warn("Progress manager not enabled - cannot start operation")}selectProgressContainer(e){if(this.progressContainer&&this.progressContainer.parentNode)return;const t={import:"progress-container",delete:"progress-container-delete",modify:"progress-container-modify",export:"progress-container-export"}[e]||"progress-container";this.progressContainer=document.getElementById(t),this.progressContainer||(this.progressContainer=document.getElementById("progress-container")),this.progressContainer?this.logger.info("Selected progress container",{id:this.progressContainer.id,operationType:e}):this.logger.warn("No progress container found for operation",{operationType:e})}createFallbackProgressContainer(e){try{const t=document.createElement("div");t.id="progress-container-fallback",t.className="progress-container visible",t.style.cssText="\n                display: block !important;\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.7);\n                z-index: 10000;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n            ",document.body.appendChild(t),this.progressContainer=t,this.logger.info("Created fallback progress container",{operationType:e})}catch(e){this.logger.error("Failed to create fallback progress container",{error:e.message})}}initializeProgressContainer(){this.progressContainer&&!this.progressContainer.querySelector(".progress-overlay")&&(this.setupElements(),this.setupEventListeners())}initializeRealTimeConnection(e){e?(this.currentSessionId=e,this.connectionRetries=0,this.trySocketIOConnection(e)):this.logger.warn("No session ID provided for real-time connection")}trySocketIOConnection(e){try{if("undefined"!=typeof io)this.logger.info("Using global Socket.IO client"),this.connectWithSocketIO(io,e);else{this.logger.info("Loading Socket.IO client dynamically");const t=document.createElement("script");t.src="/socket.io/socket.io.js",t.async=!0,t.onload=()=>{this.logger.info("Socket.IO client loaded successfully"),"undefined"!=typeof io?this.connectWithSocketIO(io,e):(this.logger.warn("Socket.IO loaded but io is undefined, trying WebSocket"),this.tryWebSocketConnection(e))},t.onerror=t=>{this.logger.warn("Failed to load Socket.IO client script",{error:t.message}),this.tryWebSocketConnection(e)},document.head.appendChild(t)}}catch(t){this.logger.warn("Socket.IO connection setup failed, trying WebSocket",{error:t.message}),this.tryWebSocketConnection(e)}}reconnectSocketIO(e){this.isReconnecting||(this.isReconnecting=!0,this.logger.info("Attempting to reconnect Socket.IO",{sessionId:e}),console.log(" [PROGRESS] Attempting to reconnect Socket.IO"),this.socket&&(this.socket.close(),this.socket=null),setTimeout(()=>{this.trySocketIOConnection(e),this.isReconnecting=!1},1e3))}connectWithSocketIO(e,t){try{this.socket=e("/",{transports:["websocket","polling"],timeout:5e3,forceNew:!0}),this.socket.on("connect",()=>{this.connectionType="socketio",this.updateConnectionType("Socket.IO"),this.logger.info("Socket.IO connected",{sessionId:t,socketId:this.socket.id}),console.log(` [PROGRESS] Socket.IO connected (ID: ${this.socket.id})`),this.socket.emit("registerSession",t),this.socket.emit("join-session",{sessionId:t})}),this.socket.on("progress",e=>{console.log(" [PROGRESS] Received progress event:",e),this.handleProgressEvent(e)}),this.socket.on("completion",e=>{console.log(" [PROGRESS] Received completion event:",e),this.handleCompletionEvent(e)}),this.socket.on("complete",e=>{console.log(" [PROGRESS] Received complete event:",e),this.handleCompletionEvent(e)}),this.socket.on("error",e=>{console.log(" [PROGRESS] Received error event:",e),this.handleErrorEvent(e)}),this.socket.on("disconnect",()=>{console.log(" [PROGRESS] Socket.IO disconnected"),this.logger.warn("Socket.IO disconnected"),this.handleConnectionFailure()}),this.socket.on("connect_error",e=>{console.log(" [PROGRESS] Socket.IO connection error:",e.message),this.logger.warn("Socket.IO connection error",{error:e.message}),this.handleConnectionFailure()})}catch(e){this.logger.warn("Socket.IO connection failed, trying WebSocket",{error:e.message}),this.tryWebSocketConnection(t)}}tryWebSocketConnection(e){try{const t=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/ws`;this.websocket=new WebSocket(t),this.websocket.onopen=()=>{this.connectionType="websocket",this.updateConnectionType("WebSocket"),this.logger.info("WebSocket connected",{sessionId:e}),this.websocket.send(JSON.stringify({type:"join-session",sessionId:e}))},this.websocket.onmessage=e=>{try{const t=JSON.parse(e.data);switch(t.type){case"progress":this.handleProgressEvent(t);break;case"complete":this.handleCompletionEvent(t);break;case"error":this.handleErrorEvent(t)}}catch(e){this.logger.error("Error parsing WebSocket message",{error:e.message})}},this.websocket.onclose=e=>{this.logger.warn("WebSocket closed",{code:e.code,reason:e.reason}),this.handleConnectionFailure()},this.websocket.onerror=e=>{this.logger.error("WebSocket error",{error:e.message}),this.handleConnectionFailure()}}catch(e){this.logger.error("WebSocket connection failed",{error:e.message}),this.handleConnectionFailure()}}handleConnectionFailure(){this.connectionRetries++,this.connectionRetries<=this.maxRetries?(this.logger.info("Retrying connection",{attempt:this.connectionRetries,maxRetries:this.maxRetries}),setTimeout(()=>{this.currentSessionId&&this.initializeRealTimeConnection(this.currentSessionId)},1e3*this.connectionRetries)):(this.logger.warn("Max connection retries reached, falling back to polling"),this.updateConnectionType("Polling (Fallback)"))}closeConnections(){this.socket&&(this.socket.disconnect(),this.socket=null),this.websocket&&(this.websocket.close(1e3,"Operation completed"),this.websocket=null),this.connectionType=null,this.logger.debug("Real-time connections closed")}updateSessionId(e){if(!e)return void this.logger.warn("No session ID provided for update");this.currentSessionId=e;const t=this.progressContainer.querySelector(".detail-value.session-id");t&&(t.textContent=e),this.logger.info("Session ID updated",{sessionId:e})}handleProgressEvent(e){if(!e)return void this.logger.warn("No progress data received");const{current:t,total:s,message:i,counts:n}=e;this.updateProgress(t,s,i,n),this.logger.debug("Progress event handled",{current:t,total:s,message:i})}handleCompletionEvent(e){this.completeOperation(e),this.logger.info("Completion event handled",{data:e})}handleErrorEvent(e){const{message:t,details:s}=e;this.handleOperationError(t,s),this.logger.error("Error event handled",{message:t,details:s})}updateProgress(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this.isEnabled||!this.progressContainer)return void this.logger.warn("Progress manager not enabled or container not found");const n=this.progressContainer.querySelector(".progress-bar-fill");if(n){const s=t>0?Math.min(100,Math.round(e/t*100)):0;n.style.width=`${s}%`}const a=this.progressContainer.querySelector(".progress-percentage");if(a){const s=t>0?Math.min(100,Math.round(e/t*100)):0;a.textContent=`${s}%`}const l=this.progressContainer.querySelector(".progress-text");if(l&&s&&(l.textContent=s),t>0){const s=e/t*100;this.updateStepIndicatorBasedOnProgress(s)}i&&"object"==typeof i&&(this.stats={...this.stats,...i},this.updateStatsDisplay()),this.logger.debug("Progress updated",{current:e,total:t,message:s,details:i})}updateStatsDisplay(){this.progressContainer&&(Object.entries(this.stats).forEach(e=>{let[t,s]=e;const i=this.progressContainer.querySelector(`.stat-value.${t}`);i&&(i.textContent=s||0)}),this.logger.debug("Statistics display updated",{stats:this.stats}))}updateStepIndicatorBasedOnProgress(e){let t="init";e>=100?t="complete":e>=75?t="process":e>=25&&(t="validate"),this.updateStepIndicator(t)}updateStepIndicator(e){if(!this.progressContainer)return;const t=this.progressContainer.querySelectorAll(".step");t.forEach(e=>{e.classList.remove("active","completed")});const s=this.progressContainer.querySelector(`[data-step="${e}"]`);s&&s.classList.add("active");const i=this.getStepOrder(e);t.forEach(e=>{const t=e.getAttribute("data-step");this.getStepOrder(t)<i&&e.classList.add("completed")}),this.logger.debug("Step indicator updated",{step:e})}getStepOrder(e){return{init:0,validate:1,process:2,complete:3}[e]||0}startTimingUpdates(){this.timingInterval&&clearInterval(this.timingInterval),this.timingInterval=setInterval(()=>{this.updateTiming()},1e3),this.logger.debug("Timing updates started")}updateTiming(){if(!this.startTime||!this.progressContainer)return;const e=Date.now()-this.startTime,t=this.progressContainer.querySelector(".elapsed-value");if(t&&(t.textContent=this.formatDuration(e)),this.stats.total>0&&this.stats.processed>0){const t=this.stats.processed/this.stats.total;if(t>0){const s=e/t-e,i=this.progressContainer.querySelector(".eta-value");i&&(i.textContent=this.formatDuration(s))}}this.logger.debug("Timing updated",{elapsed:e})}completeOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isEnabled)return void this.logger.warn("Progress manager not enabled - cannot complete operation");this.timingInterval&&(clearInterval(this.timingInterval),this.timingInterval=null),this.closeConnections();const{processed:t,success:s,failed:i,skipped:n}=e;this.updateProgress(t||0,t||0,"Operation completed"),this.stats={...this.stats,...e},this.updateStatsDisplay(),this.updateStepIndicator("complete"),this.completeCallback&&"function"==typeof this.completeCallback&&this.completeCallback(e),this.isActive=!1,this.logger.info("Operation completed",{results:e})}handleOperationError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isEnabled)return void this.logger.warn("Progress manager not enabled - cannot handle error");this.timingInterval&&(clearInterval(this.timingInterval),this.timingInterval=null),this.closeConnections();const s=this.progressContainer.querySelector(".progress-text");s&&(s.textContent=`Error: ${e}`,s.classList.add("error")),this.isActive=!1,this.logger.error("Operation error",{message:e,details:t})}cancelOperation(){this.isEnabled&&this.isActive?(this.timingInterval&&(clearInterval(this.timingInterval),this.timingInterval=null),this.closeConnections(),this.cancelCallback&&"function"==typeof this.cancelCallback&&this.cancelCallback(),this.isActive=!1,this.hideProgress(),this.logger.info("Operation cancelled")):this.logger.warn("No active operation to cancel")}showProgress(){if(!this.isEnabled||!this.progressContainer)return void this.logger.warn("Progress manager not enabled or container not found");this.progressContainer.style.display="block",this.progressContainer.classList.add("visible"),this.progressContainer.setAttribute("style","display: block !important; visibility: visible !important;");const e=this.progressContainer.querySelector(".cancel-operation");e&&e.focus(),this.logger.debug("Progress display shown",{containerId:this.progressContainer.id}),console.log(` [PROGRESS] Showing progress container: ${this.progressContainer.id}`)}hideProgress(){this.progressContainer&&(this.logger.debug("Hiding progress display",{containerId:this.progressContainer.id}),console.log(` [PROGRESS] Hiding progress container: ${this.progressContainer.id}`),this.progressContainer.classList.remove("visible"),this.progressContainer.style.display="none",this.logger.debug("Progress display hidden"))}updateOperationTitle(e){if(!this.progressContainer)return;const t=this.progressContainer.querySelector(".title-text");if(t){const s={import:"Import Users",export:"Export Users",delete:"Delete Users",modify:"Modify Users"};t.textContent=s[e]||"Operation in Progress"}this.logger.debug("Operation title updated",{operationType:e})}updateOperationDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.progressContainer)return;const{populationName:t,populationId:s,totalUsers:i}=e,n=this.progressContainer.querySelector(".detail-value.operation-type");n&&(n.textContent=this.currentOperation||"Unknown");const a=this.progressContainer.querySelector(".detail-value.population-info");a&&(a.textContent=t||s||"Unknown"),i&&(this.stats.total=i,this.updateStatsDisplay()),this.logger.debug("Operation details updated",{options:e})}updateOperationStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.progressContainer)return;const s=this.progressContainer.querySelector(".operation-subtitle");s&&(s.textContent=t||e),this.logger.debug("Operation status updated",{status:e,message:t})}updateConnectionType(e){if(!this.progressContainer)return;const t=this.progressContainer.querySelector(".detail-value.connection-type");t&&(t.textContent=e),this.logger.debug("Connection type updated",{type:e})}resetOperationStats(){this.stats={processed:0,success:0,failed:0,skipped:0,total:0},this.updateStatsDisplay(),this.logger.debug("Operation statistics reset")}formatDuration(e){const t=Math.floor(e/1e3),s=Math.floor(t/60),i=Math.floor(s/60);return i>0?`${i}:${String(s%60).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`:s>0?`${s}:${String(t%60).padStart(2,"0")}`:`${t}s`}setProgressCallback(e){this.progressCallback=e,this.logger.debug("Progress callback set")}setCompleteCallback(e){this.completeCallback=e,this.logger.debug("Completion callback set")}setCancelCallback(e){this.cancelCallback=e,this.logger.debug("Cancel callback set")}debugLog(e,t){a&&this.logger.debug(`[${e}] ${t}`)}destroy(){this.timingInterval&&(clearInterval(this.timingInterval),this.timingInterval=null),this.closeConnections(),this.progressCallback=null,this.completeCallback=null,this.cancelCallback=null,this.isActive=!1,this.currentOperation=null,this.currentSessionId=null,this.logger.info("Progress manager destroyed")}}s.ProgressManager=ProgressManager;const l=new ProgressManager;s.default=l}).call(this)}).call(this,e("_process"))},{"./element-registry.js":75,"./message-formatter.js":77,"./session-manager.js":79,"./winston-logger.js":81,"@babel/runtime/helpers/interopRequireDefault":1,_process:60}],79:[function(e,t,s){(function(t){(function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.sessionManager=s.default=void 0;var i=e("./winston-logger.js");const n=s.sessionManager=new class SessionManager{constructor(){this.logger=(0,i.createWinstonLogger)({service:"pingone-import-session",environment:t.env.NODE_ENV||"development"}),this.activeSessions=new Map,this.sessionCounter=0}generateSessionId(){try{const e=Date.now(),t=Math.random().toString(36).substring(2,15),s=`session_${e}_${t}_${++this.sessionCounter}`;return this.logger.debug("Session ID generated",{sessionId:s}),s}catch(e){return this.logger.error("Error generating session ID",{error:e.message}),`session_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}}validateSessionId(e){try{if(!e||"string"!=typeof e)return this.logger.warn("Session ID validation failed: null/undefined/non-string",{sessionId:e,type:typeof e}),!1;if(""===e.trim())return this.logger.warn("Session ID validation failed: empty string"),!1;if(e.length<8)return this.logger.warn("Session ID validation failed: too short",{length:e.length}),!1;return/^[a-zA-Z0-9_-]+$/.test(e)?(this.logger.debug("Session ID validation passed",{sessionId:e}),!0):(this.logger.warn("Session ID validation failed: invalid characters",{sessionId:e}),!1)}catch(t){return this.logger.error("Error validating session ID",{error:t.message,sessionId:e}),!1}}registerSession(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(!this.validateSessionId(e))return this.logger.error("Cannot register invalid session ID",{sessionId:e,operationType:t}),!1;const i={sessionId:e,operationType:t,createdAt:Date.now(),lastActivity:Date.now(),metadata:s};return this.activeSessions.set(e,i),this.logger.info("Session registered",{sessionId:e,operationType:t,metadata:s}),!0}catch(s){return this.logger.error("Error registering session",{error:s.message,sessionId:e,operationType:t}),!1}}updateSessionActivity(e){try{const t=this.activeSessions.get(e);t?(t.lastActivity=Date.now(),this.logger.debug("Session activity updated",{sessionId:e})):this.logger.warn("Session not found for activity update",{sessionId:e})}catch(t){this.logger.error("Error updating session activity",{error:t.message,sessionId:e})}}unregisterSession(e){try{const t=this.activeSessions.get(e);t?(this.activeSessions.delete(e),this.logger.info("Session unregistered",{sessionId:e,operationType:t.operationType})):this.logger.warn("Session not found for unregistration",{sessionId:e})}catch(t){this.logger.error("Error unregistering session",{error:t.message,sessionId:e})}}getSession(e){try{return this.activeSessions.get(e)||null}catch(t){return this.logger.error("Error getting session",{error:t.message,sessionId:e}),null}}getActiveSessions(){try{return Array.from(this.activeSessions.values())}catch(e){return this.logger.error("Error getting active sessions",{error:e.message}),[]}}cleanupExpiredSessions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36e5;try{const t=Date.now(),s=[];for(const[i,n]of this.activeSessions.entries())t-n.lastActivity>e&&s.push(i);s.forEach(e=>{this.unregisterSession(e)}),s.length>0&&this.logger.info("Cleaned up expired sessions",{count:s.length})}catch(e){this.logger.error("Error cleaning up expired sessions",{error:e.message})}}getSessionStats(){try{const e=this.getActiveSessions(),t={total:e.length,byOperation:{},oldest:null,newest:null};return e.forEach(e=>{t.byOperation[e.operationType]=(t.byOperation[e.operationType]||0)+1,(!t.oldest||e.createdAt<t.oldest.createdAt)&&(t.oldest=e),(!t.newest||e.createdAt>t.newest.createdAt)&&(t.newest=e)}),t}catch(e){return this.logger.error("Error getting session stats",{error:e.message}),{total:0,byOperation:{},oldest:null,newest:null}}}};s.default=n}).call(this)}).call(this,e("_process"))},{"./winston-logger.js":81,_process:60}],80:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;class SafeDOM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:console;this.logger=e}getElementById(e){try{return document.getElementById(e)}catch(t){return this.logger.error("Error getting element by ID:",{id:e,error:t.message}),null}}querySelector(e){try{return document.querySelector(e)}catch(t){return this.logger.error("Error with querySelector:",{selector:e,error:t.message}),null}}querySelectorAll(e){try{return document.querySelectorAll(e)}catch(t){return this.logger.error("Error with querySelectorAll:",{selector:e,error:t.message}),[]}}setText(e,t){try{e&&void 0!==e.textContent&&(e.textContent=t)}catch(e){this.logger.error("Error setting text content:",{text:t,error:e.message})}}setHTML(e,t){try{e&&void 0!==e.innerHTML&&(e.innerHTML=t)}catch(e){this.logger.error("Error setting HTML content:",{html:t,error:e.message})}}show(e){try{e&&e.style&&(e.style.display="block")}catch(e){this.logger.error("Error showing element:",{error:e.message})}}hide(e){try{e&&e.style&&(e.style.display="none")}catch(e){this.logger.error("Error hiding element:",{error:e.message})}}addClass(e,t){try{e&&e.classList&&e.classList.add(t)}catch(e){this.logger.error("Error adding class:",{className:t,error:e.message})}}removeClass(e,t){try{e&&e.classList&&e.classList.remove(t)}catch(e){this.logger.error("Error removing class:",{className:t,error:e.message})}}setAttribute(e,t,s){try{e&&"function"==typeof e.setAttribute&&e.setAttribute(t,s)}catch(e){this.logger.error("Error setting attribute:",{name:t,value:s,error:e.message})}}getAttribute(e,t){try{return e&&"function"==typeof e.getAttribute?e.getAttribute(t):null}catch(e){return this.logger.error("Error getting attribute:",{name:t,error:e.message}),null}}addEventListener(e,t,s){try{e&&"function"==typeof e.addEventListener&&e.addEventListener(t,s)}catch(e){this.logger.error("Error adding event listener:",{event:t,error:e.message})}}removeEventListener(e,t,s){try{e&&"function"==typeof e.removeEventListener&&e.removeEventListener(t,s)}catch(e){this.logger.error("Error removing event listener:",{event:t,error:e.message})}}}"undefined"!=typeof window&&(window.SafeDOM=SafeDOM,window.safeDOM=new SafeDOM(window.logger||console)),void 0!==t&&t.exports&&(t.exports=SafeDOM);s.default=SafeDOM},{}],81:[function(e,t,s){(function(e){(function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.apiLogger=s.WinstonLogger=void 0,s.createComponentLogger=createComponentLogger,s.createWinstonLogger=createWinstonLogger,s.uiLogger=s.tokenLogger=s.settingsLogger=s.fileLogger=s.defaultLogger=void 0;class WinstonLogger{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.level=t.level||this.getDefaultLevel(),this.service=t.service||"pingone-import-frontend",this.environment=t.environment||e.env.NODE_ENV||"development",this.enableServerLogging=!1!==t.enableServerLogging,this.enableConsoleLogging=!1!==t.enableConsoleLogging,this.levels={error:0,warn:1,info:2,debug:3},this.transports=[],this.initializeTransports()}getDefaultLevel(){return"production"===this.environment?"info":"test"===this.environment?"warn":"debug"}initializeTransports(){this.enableConsoleLogging&&this.transports.push({name:"console",log:(e,t,s)=>this.logToConsole(e,t,s)}),this.enableServerLogging&&this.transports.push({name:"server",log:(e,t,s)=>this.logToServer(e,t,s)})}shouldLog(e){return this.levels[e]<=this.levels[this.level]}formatTimestamp(){return(new Date).toISOString()}formatLogEntry(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:this.formatTimestamp(),level:e,message:t,service:this.service,environment:this.environment,...s}}logToConsole(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.shouldLog(e))return;const i=this.formatLogEntry(e,t,s).timestamp,n=e.toUpperCase();let a=`[${i}] [${this.service}] ${n}: ${t}`;switch(Object.keys(s).length>0&&(a+=`\n${JSON.stringify(s,null,2)}`),e){case"error":console.error(a);break;case"warn":console.warn(a);break;case"info":console.info(a);break;case"debug":console.debug(a);break;default:console.log(a)}}async logToServer(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.shouldLog(e))try{const i={message:t,level:e,data:s,source:"frontend"};await fetch("/api/logs/ui",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(i){if(i.message.includes("Failed to fetch")||i.message.includes("ERR_CONNECTION_REFUSED"))return;console.warn("Server logging failed, falling back to console:",i.message),this.logToConsole(e,t,s)}}log(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.shouldLog(e)&&this.transports.forEach(i=>{try{i.log(e,t,s)}catch(e){console.error(`Error in ${i.name} transport:`,e)}})}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("info",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("warn",e,t)}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("error",e,t)}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("debug",e,t)}errorWithStack(e,t){const s={...arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},error:{message:t.message,stack:t.stack,code:t.code,name:t.name}};this.error(e,s)}child(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=new WinstonLogger({level:this.level,service:this.service,environment:this.environment,enableServerLogging:this.enableServerLogging,enableConsoleLogging:this.enableConsoleLogging});return s.formatLogEntry=function(s,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{...e.formatLogEntry(s,i,n),...t}},s}setLevel(e){this.levels.hasOwnProperty(e)?this.level=e:this.warn(`Invalid log level: ${e}`)}setServerLogging(e){this.enableServerLogging=e,this.transports=this.transports.filter(e=>"server"!==e.name),e&&this.transports.push({name:"server",log:(e,t,s)=>this.logToServer(e,t,s)})}setConsoleLogging(e){this.enableConsoleLogging=e,this.transports=this.transports.filter(e=>"console"!==e.name),e&&this.transports.push({name:"console",log:(e,t,s)=>this.logToConsole(e,t,s)})}}function createWinstonLogger(){return new WinstonLogger(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function createComponentLogger(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return createWinstonLogger({...t,service:`${t.service||"pingone-import"}-${e}`})}s.WinstonLogger=WinstonLogger;s.defaultLogger=createWinstonLogger(),s.apiLogger=createComponentLogger("api"),s.uiLogger=createComponentLogger("ui"),s.fileLogger=createComponentLogger("file"),s.settingsLogger=createComponentLogger("settings"),s.tokenLogger=createComponentLogger("token")}).call(this)}).call(this,e("_process"))},{_process:60}],82:[function(e,t,s){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault"),n=e("./utils/logger.js"),a=e("./components/ui-manager.js"),l=i(e("./utils/local-api-client.js")),c=i(e("./subsystems/settings-subsystem.js")),u=e("./utils/event-bus.js"),h=(i(e("./components/credentials-manager.js")),i(e("./components/settings-manager.js"))),g=i(e("./utils/pingone-client.js")),d=e("./subsystems/connection-manager-subsystem.js"),p=e("./subsystems/auth-management-subsystem.js"),f=e("./subsystems/advanced-realtime-subsystem.js"),m=e("./subsystems/view-management-subsystem.js"),y=e("./subsystems/operation-manager-subsystem.js"),v=e("./subsystems/population-subsystem.js"),w=e("./subsystems/history-subsystem.js"),b=e("./subsystems/import-subsystem.js"),S=e("./subsystems/navigation-subsystem.js"),E=e("./subsystems/realtime-communication-subsystem.js");class App{constructor(){this.version="loading...",this.logger=new n.Logger("pingone-import-app","dezh8e30"),this.eventBus=new u.EventBus(this.logger.child({component:"event-bus"})),this.uiManager=new a.UIManager(this.logger.child({component:"ui-manager"})),this.localClient=new l.default("/api/v1",this.logger.child({component:"local-api-client"})),this.subsystems={},window.app=this}async init(){this.logger.info("Initializing application..."),this.uiManager.showStartupWaitScreen("Initializing application...");try{await this.loadVersion(),await this.initializeCoreComponents(),await this.initializeSubsystems(),this.logger.info("Application initialized successfully."),this.uiManager.hideStartupWaitScreen()}catch(e){this.logger.error("Application initialization failed:",{error:e.message,stack:e.stack}),this.uiManager.showError("Application failed to start. Please check the console for details.")}}async loadVersion(){try{this.uiManager.updateStartupMessage("Loading version information...");const e=await fetch("/api/version");if(!e.ok)throw new Error(`Failed to load version: ${e.status}`);{const t=await e.json();this.version=t.version,this.logger.info("Version loaded from server:",{version:this.version}),this.updateVersionDisplay()}}catch(e){this.logger.warn("Failed to load version from server, using fallback:",{error:e.message}),this.version="6.5.1.3",this.updateVersionDisplay()}}updateVersionDisplay(){try{const e=document.getElementById("version-display");e&&(e.textContent=`v${this.version}`),document.title=`PingOne User Import v${this.version}`,this.logger.debug("Version display updated:",{version:this.version})}catch(e){this.logger.error("Failed to update version display:",{error:e.message})}}async initializeCoreComponents(){this.logger.debug("Initializing core components"),this.uiManager.setupUI(),this.settingsManager=new h.default(this.logger.child({component:"settings-manager"})),await this.settingsManager.init(),this.logger.debug("Settings manager initialized"),this.settingsSubsystem=new c.default(this.logger.child({subsystem:"settings"}),this.uiManager,this.localClient,this.settingsManager,this.eventBus),await this.settingsSubsystem.init(),this.logger.debug("Settings subsystem initialized as a core component"),this.pingoneClient=new g.default(this.localClient,this.logger.child({component:"pingone-client"})),this.logger.debug("PingOne client created successfully"),this.realtimeComm=new E.RealtimeCommunicationSubsystem(this.logger.child({subsystem:"realtime-comm"}),this.uiManager),this.logger.debug("Realtime communication subsystem initialized as a core component"),this.logger.debug("Core components initialized")}async initializeSubsystems(){this.logger.info("Initializing subsystems..."),this.uiManager.updateStartupMessage("Initializing subsystems...");const e=[{name:"navigationSubsystem",constructor:S.NavigationSubsystem,deps:[this.logger.child({subsystem:"navigation"}),this.uiManager,this.settingsManager,this]},{name:"connectionManager",constructor:d.ConnectionManagerSubsystem,deps:[this.logger.child({subsystem:"connection"}),this.eventBus,this.uiManager,this.localClient]},{name:"realtimeManager",constructor:f.AdvancedRealtimeSubsystem,deps:[this.logger.child({subsystem:"realtime"}),this.eventBus,this.realtimeComm,this.subsystems.settingsSubsystem,this.subsystems.operationManager]},{name:"authManager",constructor:p.AuthManagementSubsystem,deps:[this.logger.child({subsystem:"auth"}),this.pingoneClient,this.eventBus,this.uiManager,this.localClient]},{name:"viewManager",constructor:m.ViewManagementSubsystem,deps:[this.logger.child({subsystem:"view"}),this.uiManager,this.eventBus]},{name:"operationManager",constructor:y.OperationManagerSubsystem,deps:[this.logger.child({subsystem:"operation"}),this.eventBus,this.uiManager]},{name:"populationSubsystem",constructor:v.PopulationSubsystem,deps:[this.logger.child({subsystem:"population"}),this.localClient,this.eventBus]},{name:"historySubsystem",constructor:w.HistorySubsystem,deps:[this.logger.child({subsystem:"history"}),this.localClient,this.uiManager,this.eventBus]},{name:"importSubsystem",constructor:b.ImportSubsystem,deps:[this.logger.child({subsystem:"import"}),this.uiManager,this.localClient,this.eventBus,()=>this.subsystems.authManager]}];for(const t of e)try{this.logger.debug(`Initializing ${t.name} subsystem...`);const e=t.deps.map(e=>"function"==typeof e?e():e);this.subsystems[t.name]=new t.constructor(...e),"function"==typeof this.subsystems[t.name].init&&await this.subsystems[t.name].init()}catch(e){throw this.logger.error(`Failed to initialize subsystem: ${t.name}`,{error:e.message,stack:e.stack}),new Error(`Subsystem initialization failed for ${t.name}`)}this.logger.info("All subsystems initialized successfully.")}setupEventListeners(){this.logger.debug("Setting up global event listeners"),window.addEventListener("error",e=>{this.logger.error("Unhandled global error:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error?e.error.stack:"N/A"})}),window.addEventListener("unhandledrejection",e=>{this.logger.warn("Unhandled promise rejection:",{reason:e.reason?e.reason.stack:"N/A"})}),this.logger.debug("Global event listeners set up")}}document.addEventListener("DOMContentLoaded",()=>{const e=new App;e.init().catch(t=>{console.error("FATAL: Application failed to initialize.",t),e.uiManager&&e.uiManager.showError("A fatal error occurred during startup. The application cannot continue.")})})},{"./components/credentials-manager.js":83,"./components/settings-manager.js":84,"./components/ui-manager.js":85,"./subsystems/advanced-realtime-subsystem.js":86,"./subsystems/auth-management-subsystem.js":87,"./subsystems/connection-manager-subsystem.js":88,"./subsystems/history-subsystem.js":89,"./subsystems/import-subsystem.js":90,"./subsystems/navigation-subsystem.js":91,"./subsystems/operation-manager-subsystem.js":92,"./subsystems/population-subsystem.js":93,"./subsystems/realtime-communication-subsystem.js":94,"./subsystems/settings-subsystem.js":95,"./subsystems/view-management-subsystem.js":96,"./utils/event-bus.js":99,"./utils/local-api-client.js":101,"./utils/logger.js":102,"./utils/pingone-client.js":104,"@babel/runtime/helpers/interopRequireDefault":1}],83:[function(e,t,s){"use strict";window.CredentialsManager=class CredentialsManager{constructor(){this.storageKey="pingone-credentials",this.defaultCredentials=this.getDefaultCredentials(),this.credentials=null,this.init()}init(){this.loadCredentials(),(window.logger?.info||console.log)("Credentials Manager initialized")}getDefaultCredentials(){return{environmentId:"",apiClientId:"",apiSecret:"",region:"NorthAmerica",populationId:""}}loadCredentials(){try{const e=localStorage.getItem(this.storageKey);e?(this.credentials=JSON.parse(e),(window.logger?.debug||console.log)("Credentials loaded from localStorage")):(this.credentials=this.getDefaultCredentials(),(window.logger?.debug||console.log)("No stored credentials found, using defaults"))}catch(e){(window.logger?.warn||console.warn)("Failed to load credentials from localStorage:",e),this.credentials=this.getDefaultCredentials()}}saveCredentials(e){try{this.credentials={...this.credentials,...e},localStorage.setItem(this.storageKey,JSON.stringify(this.credentials)),(window.logger?.debug||console.log)("Credentials saved to localStorage")}catch(e){(window.logger?.error||console.error)("Failed to save credentials to localStorage:",e)}}getCredentials(){return{...this.credentials}}updateCredentials(e){this.credentials={...this.credentials,...e},this.saveCredentials(this.credentials)}clearCredentials(){try{localStorage.removeItem(this.storageKey),this.credentials=this.getDefaultCredentials(),(window.logger?.debug||console.log)("Credentials cleared")}catch(e){(window.logger?.error||console.error)("Failed to clear credentials:",e)}}hasCompleteCredentials(){return!!(this.credentials.environmentId&&this.credentials.apiClientId&&this.credentials.apiSecret)}getValidCredentials(){return this.hasCompleteCredentials()?this.getCredentials():null}validateCredentials(e){const t=[];return e.environmentId?this.isValidUUID(e.environmentId)||t.push("Environment ID must be a valid UUID"):t.push("Environment ID is required"),e.apiClientId||t.push("API Client ID is required"),e.apiSecret||t.push("API Secret is required"),e.region||t.push("Region is required"),{isValid:0===t.length,errors:t}}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}exportCredentials(){return JSON.stringify(this.credentials,null,2)}importCredentials(e){try{const t=JSON.parse(e),s=this.validateCredentials(t);return s.isValid?(this.saveCredentials(t),{success:!0,message:"Credentials imported successfully"}):{success:!1,errors:s.errors}}catch(e){return{success:!1,errors:["Invalid JSON format"]}}}}},{}],84:[function(e,t,s){(function(t){(function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=e("../utils/winston-logger.js"),n=e("../utils/crypto-utils.js");s.default=class SettingsManager{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.settings=this.getDefaultSettings(),this.storageKey="pingone-import-settings",this.encryptionKey=null,this.initializeLogger(e),this.encryptionInitialized=!1}async init(){try{await this.initializeEncryption(),this.encryptionInitialized=!0,this.logger.info("Settings manager initialized successfully")}catch(e){throw this.logger.error("Failed to initialize settings manager",{error:e.message}),e}}initializeLogger(e){e&&"function"==typeof e.child?this.logger=e.child({component:"settings-manager"}):this.logger=(0,i.createWinstonLogger)({service:"pingone-import-settings",environment:t.env.NODE_ENV||"development"})}createDefaultLogger(){var e=this;return{log:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";return e.logger.log(s,`[Settings] ${t}`)},info:e=>this.logger.info(`[Settings] ${e}`),warn:e=>this.logger.warn(`[Settings] ${e}`),error:e=>this.logger.error(`[Settings] ${e}`),debug:e=>this.logger.debug(`[Settings] ${e}`)}}static getRegionInfo(e){if(!e)return{code:"NA",tld:"com",label:"North America (excluding Canada)"};const t={NA:{code:"NA",tld:"com",label:"North America (excluding Canada)"},CA:{code:"CA",tld:"ca",label:"Canada"},EU:{code:"EU",tld:"eu",label:"European Union"},AU:{code:"AU",tld:"com.au",label:"Australia"},SG:{code:"SG",tld:"sg",label:"Singapore"},AP:{code:"AP",tld:"asia",label:"Asia-Pacific"}};return t[e]||t.NA}getDefaultSettings(){return{environmentId:"",region:"NA",apiClientId:"",populationId:"",rateLimit:50,connectionStatus:"disconnected",connectionMessage:"Not connected",lastConnectionTest:null,autoSave:!0,lastUsedDirectory:"",theme:"light",pageSize:50,showNotifications:!0}}async loadSettings(){try{const e=localStorage.getItem(this.storageKey);if(!e)return this.logger.info("No stored settings found, using defaults"),this.settings;try{const t=JSON.parse(e);return this.settings={...this.getDefaultSettings(),...t},this.logger.info("Settings loaded successfully (unencrypted)",{hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId,region:this.settings.region}),this.settings}catch(t){if(!this.encryptionInitialized)return this.logger.warn("Encryption not initialized and JSON parsing failed, using defaults"),this.settings;try{const t=await n.CryptoUtils.decrypt(e,this.encryptionKey),s=JSON.parse(t);return this.settings={...this.getDefaultSettings(),...s},this.logger.info("Settings loaded successfully (encrypted)",{hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId,region:this.settings.region}),this.settings}catch(e){return this.logger.error("Failed to decrypt settings",{error:e.message}),this.settings}}}catch(e){return this.logger.error("Failed to load settings",{error:e.message}),this.settings}}async saveSettings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{e&&(this.settings={...this.settings,...e});const t=JSON.stringify(this.settings);if(!this.encryptionInitialized)return this.logger.warn("Encryption not initialized, saving settings without encryption"),localStorage.setItem(this.storageKey,t),void this.logger.info("Settings saved successfully (unencrypted)",{hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId,region:this.settings.region});try{const e=await n.CryptoUtils.encrypt(t,this.encryptionKey);localStorage.setItem(this.storageKey,e),this.logger.info("Settings saved successfully (encrypted)",{hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId,region:this.settings.region})}catch(e){this.logger.warn("Encryption failed, saving settings without encryption",{error:e.message}),localStorage.setItem(this.storageKey,t),this.logger.info("Settings saved successfully (unencrypted fallback)",{hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId,region:this.settings.region})}}catch(e){throw this.logger.error("Failed to save settings",{error:e.message}),e}}getSetting(e){if(!e)throw new Error("Setting key is required");return this.settings[e]}async setSetting(e,t){if(!e)throw new Error("Setting key is required");try{this.settings[e]=t,await this.saveSettings(),this.logger.debug("Setting updated",{key:e,value:"string"==typeof t?t:"[object]"})}catch(t){throw this.logger.error("Failed to update setting",{key:e,error:t.message}),t}}getAllSettings(){return{...this.settings}}getSettings(){return this.getAllSettings()}async updateSettings(e){if(!e||"object"!=typeof e)throw new Error("New settings object is required");try{this.settings={...this.settings,...e},await this.saveSettings(),this.logger.info("Multiple settings updated",{updatedKeys:Object.keys(e),hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId})}catch(e){throw this.logger.error("Failed to update settings",{error:e.message}),e}}async resetSettings(){try{this.settings=this.getDefaultSettings(),await this.saveSettings(),this.logger.info("Settings reset to defaults")}catch(e){throw this.logger.error("Failed to reset settings",{error:e.message}),e}}async clearSettings(){try{localStorage.removeItem(this.storageKey),this.settings=this.getDefaultSettings(),this.logger.info("Settings cleared")}catch(e){throw this.logger.error("Failed to clear settings",{error:e.message}),e}}async initializeEncryption(){try{let e=await this.getDeviceId();"string"!=typeof e&&(e=String(e||"")),e||(e="fallback-device-id"),this.encryptionKey=await n.CryptoUtils.generateKey(e),this.logger.debug("Encryption initialized successfully")}catch(e){this.logger.error("Failed to initialize encryption",{error:e.message}),this.encryptionKey=await n.CryptoUtils.generateKey("fallback-encryption-key"),this.logger.warn("Using fallback encryption key")}}async getDeviceId(){try{if(this.isLocalStorageAvailable()){const e=localStorage.getItem("pingone-device-id");if(e&&"string"==typeof e)return e}const e={userAgent:navigator.userAgent,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory,maxTouchPoints:navigator.maxTouchPoints},t=(new TextEncoder).encode(JSON.stringify(e)),s=await crypto.subtle.digest("SHA-256",t),i=Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("");return"string"==typeof i&&i?i:"fallback-device-id"}catch(e){return this.logger.error("Failed to generate device ID:",e),"fallback-"+Math.random().toString(36).substring(2,15)}}isLocalStorageAvailable(){try{const e="test";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return this.logger.warn("localStorage not available",{error:e.message}),!1}}async exportSettings(){try{const e={settings:this.settings,exportDate:(new Date).toISOString(),version:"1.0"};return this.logger.info("Settings exported",{exportDate:e.exportDate}),e}catch(e){throw this.logger.error("Failed to export settings",{error:e.message}),e}}async importSettings(e){if(!e)throw new Error("Import data is required");if(!e.settings)throw new Error("Invalid import data: missing settings");try{this.settings={...this.getDefaultSettings(),...e.settings},await this.saveSettings(),this.logger.info("Settings imported successfully",{importDate:e.exportDate,hasEnvironmentId:!!this.settings.environmentId,hasApiClientId:!!this.settings.apiClientId})}catch(e){throw this.logger.error("Failed to import settings",{error:e.message}),e}}debugLocalStorage(){try{const e=localStorage.getItem(this.storageKey);if(!e)return this.logger.info("No data found in localStorage",{key:this.storageKey}),null;this.logger.info("localStorage contents found",{key:this.storageKey,length:e.length,preview:e.substring(0,100)+(e.length>100?"...":"")});try{const t=JSON.parse(e);return this.logger.info("Data is valid JSON",{keys:Object.keys(t),hasEnvironmentId:!!t.environmentId,hasApiClientId:!!t.apiClientId}),t}catch(e){return this.logger.info("Data is not valid JSON, likely encrypted",{error:e.message}),"encrypted"}}catch(e){return this.logger.error("Failed to debug localStorage",{error:e.message}),null}}}}).call(this)}).call(this,e("_process"))},{"../utils/crypto-utils.js":98,"../utils/winston-logger.js":105,_process:60}],85:[function(e,t,s){(function(t){(function(){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(s,"__esModule",{value:!0}),s.UIManager=void 0;e("../../../public/js/modules/circular-progress.js");var n=e("../../../public/js/modules/element-registry.js"),a=(i(e("../../../public/js/modules/progress-manager.js")),e("../../../public/js/modules/error/error-types.js"),e("../../../public/js/modules/utils/safe-dom.js"));const l="development"===t.env.NODE_ENV;s.UIManager=class UIManager{constructor(){let{errorManager:e,logger:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=t?t.child({component:"UIManager"}):console,this.errorManager=e||{handleError:(e,t)=>{(window.logger?.error||console.error)("Unhandled error (no error manager):",e,t)}},this.notificationContainer=null,this.progressContainer=null,this.tokenStatusElement=null,this.connectionStatusElement=null,this.initialize()}initialize(){try{this.setupElements(),this.logger.info("UI Manager initialized successfully")}catch(e){this.errorManager.handleError(e,{component:"UIManager",operation:"initialize",severity:"error",context:{message:"Failed to initialize UI Manager",error:e.message}})}}setupUI(){try{this.logger.debug("Setting up UI components..."),this.setupElements(),this.setupEventListeners(),this.initializeStatusIndicators(),this.initializeProgressTracking(),this.logger.info("UI setup completed successfully")}catch(e){this.logger.error("Error during UI setup:",e),this.errorManager.handleError(e,{component:"UIManager",operation:"setupUI",severity:"error",context:{message:"Failed to setup UI components",error:e.message}})}}setupEventListeners(){try{window.addEventListener("error",e=>{this.handleGlobalError(e.error,{type:"global_error",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.handleGlobalError(e.reason,{type:"unhandled_promise_rejection"})}),this.logger.debug("Event listeners setup completed")}catch(e){this.logger.error("Error setting up event listeners:",e)}}initializeStatusIndicators(){try{this.tokenStatusElement&&this.updateTokenStatus("checking","Checking token status..."),this.connectionStatusElement&&this.updateConnectionStatus("connecting","Connecting..."),this.logger.debug("Status indicators initialized")}catch(e){this.logger.error("Error initializing status indicators:",e)}}initializeProgressTracking(){try{this.progressContainer&&this.hideProgress(),this.logger.debug("Progress tracking initialized")}catch(e){this.logger.error("Error initializing progress tracking:",e)}}handleGlobalError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.logger.error("Global error caught:",{error:e.message,context:t}),this.errorManager&&"function"==typeof this.errorManager.handleError&&this.errorManager.handleError(e,{component:"UIManager",operation:"global_error_handler",severity:"error",context:t})}catch(e){console.error("Error in global error handler:",e)}}async init(){return this.initialize(),Promise.resolve()}setupElements(){try{this.notificationContainer=n.ElementRegistry.notificationContainer?n.ElementRegistry.notificationContainer():null,this.progressContainer=n.ElementRegistry.progressContainer?n.ElementRegistry.progressContainer():null,this.tokenStatusElement=n.ElementRegistry.tokenStatus?n.ElementRegistry.tokenStatus():null,this.connectionStatusElement=n.ElementRegistry.connectionStatus?n.ElementRegistry.connectionStatus():null,this.navItems=document.querySelectorAll("[data-view]"),this.notificationContainer||this.logger.warn("Notification container not found"),this.progressContainer||this.logger.warn("Progress container not found"),this.logger.debug("UI elements setup completed",{hasNotificationContainer:!!this.notificationContainer,hasProgressContainer:!!this.progressContainer,hasTokenStatusElement:!!this.tokenStatusElement,hasConnectionStatusElement:!!this.connectionStatusElement,navItemsCount:this.navItems?this.navItems.length:0})}catch(e){this.logger.error("Error setting up UI elements",{error:e.message})}}showStatusBar(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{duration:n=5e3,autoDismiss:l=!0,errorId:c,context:u={}}=i;try{const i={info:"info",success:"info",warning:"warn",error:"error"}[s]||"log",h={messageType:s,...c&&{errorId:c},...u};if(this.logger[i](`Status: ${e}`,h),!this.statusBarElement)return void this.logger.debug("Status bar element not available in current view",h);this.statusBarTimer&&(clearTimeout(this.statusBarTimer),this.statusBarTimer=null);const g=window.safeDOM||new a.SafeDOM(this.logger),d=window.errorHandler||new ErrorHandler(this.logger),p=window.UI_CONFIG||{CLASSES:{ERROR:"error",SUCCESS:"success"}};g.setHTML(this.statusBarElement,"");const f=document.createElement("span");g.addClass(f,"status-message");let m=e;if(s===p.CLASSES.ERROR&&c&&(m+=` (Error ID: ${c})`,"development"===t.env.NODE_ENV&&Object.keys(u).length>0&&(m+=`\n${JSON.stringify(u,null,2)}`)),g.setText(f,m),this.statusBarElement.appendChild(f),s===p.CLASSES.ERROR||"warning"===s){const e=document.createElement("button");g.addClass(e,"status-dismiss"),g.setHTML(e,"&times;"),e.setAttribute("aria-label","Dismiss message"),e.onclick=d.wrapEventHandler(()=>this.clearStatusBar(),"Status bar dismiss button click"),this.statusBarElement.appendChild(e)}this.statusBarElement.className=`status-bar status-bar-${s} visible`;l&&("success"===s||"info"===s)&&(this.statusBarTimer=setTimeout(()=>{this.clearStatusBar()},n))}catch(t){this.errorManager.handleError(t,{component:"UIManager",operation:"showStatusBar",severity:"warning",context:{originalMessage:e,type:s,options:i,errorMessage:t.message}}),(window.logger?.error||console.error)("Failed to show status bar:",t),(window.logger?.debug||console.log)("Original message:",e);try{this.statusBarElement&&(this.statusBarElement.textContent=`Error: ${e.substring(0,100)}`,this.statusBarElement.className="status-bar status-bar-error visible")}catch(e){(window.logger?.error||console.error)("Completely failed to show status bar:",e)}}}clearStatusBar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(this.statusBarTimer&&(clearTimeout(this.statusBarTimer),this.statusBarTimer=null),!this.statusBarElement)return void this.logger.debug("Status bar element not found during clear");const{force:t=!1}=e,s=window.safeDOM||new a.SafeDOM(this.logger),i=window.UI_CONFIG||{TIMEOUTS:{ANIMATION:300}};t?(s.setHTML(this.statusBarElement,""),this.statusBarElement.className="status-bar",this.logger.debug("Status bar cleared immediately")):(s.removeClass(this.statusBarElement,"visible"),setTimeout(()=>{this.statusBarElement&&(s.setHTML(this.statusBarElement,""),this.statusBarElement.className="status-bar")},i.TIMEOUTS?.ANIMATION||300),this.logger.debug("Status bar cleared with animation"))}catch(t){this.errorManager.handleError(t,{component:"UIManager",operation:"clearStatusBar",severity:"warning",context:{options:e,errorMessage:t.message}});try{this.statusBarElement&&(this.statusBarElement.innerHTML="",this.statusBarElement.className="status-bar")}catch(e){(window.logger?.error||console.error)("Failed to clear status bar:",e)}}}showSuccess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.showStatusBar(e,"success"),this.logger.info("Success message shown",{message:e,...t})}showWarning(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.showStatusBar(e,"warning"),this.logger.warn("Warning message shown",{message:e,...t})}showInfo(e){this.showStatusBar(e,"info")}showError(e){let t,s,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e instanceof Error)s=e,t=e.message,i="object"==typeof n&&null!==n?n:{};else if("string"==typeof e&&n instanceof Error)s=n,t=`${e}: ${n.message}`,i={};else if("string"==typeof e&&"string"==typeof n)t=`${e}: ${n}`,s=new Error(t),s.name=e,i={};else{if("string"!=typeof e){const t=new Error("Invalid parameters passed to showError");return void this.errorManager.handleError(t,{component:"UIManager",operation:"showError",severity:"error",context:{error:e,details:n,options:a}})}t=e,s=new Error(t),i="object"==typeof n&&null!==n?n:{}}const l={...i,...a.context};!1!==a.reportToServer&&this.errorManager.handleError(s,{component:a.component||"UIManager",operation:a.operation||"showError",severity:"error",context:l}),this.showStatusBar(t,"error",{autoDismiss:!1,errorId:a.errorId,context:l,...a}),this.logger.error("Error message shown",{error:t,name:s.name,stack:s.stack,...l})}catch(e){(window.logger?.error||console.error)("Error in showError:",e);try{const t="An error occurred";this.showStatusBar(t,"error",{autoDismiss:!1,context:{originalError:e instanceof Error?e.message:String(e),timestamp:(new Date).toISOString()}})}catch(e){(window.logger?.error||console.error)("Completely failed to show error:",e)}}hideLoading(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.clearStatusBar(),e&&this.showSuccess(e),this.logger.debug("Loading indicator hidden")}updateProgress(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if((window.logger?.debug||console.log)(" [UI MANAGER DEBUG] updateProgress() called with:",{current:e,total:t,message:s}),!this.progressContainer)return(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Progress container not found in updateProgress"),void this.logger.warn("Progress container not found");(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress container found, calculating percentage...");const i=t>0?Math.round(e/t*100):0;(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Calculated percentage:",i);const n=window.safeDOM||new a.SafeDOM(this.logger),l=window.UI_CONFIG||{SELECTORS:{PROGRESS_BAR_FILL:".progress-bar-fill",PROGRESS_PERCENTAGE:".progress-percentage",PROGRESS_TEXT:".progress-text"}},c=n.select(l.SELECTORS.PROGRESS_BAR_FILL,this.progressContainer);(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress bar element:",c),c?(c.style.width=`${i}%`,(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress bar updated to:",`${i}%`)):(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Progress bar element not found");const u=n.select(l.SELECTORS.PROGRESS_PERCENTAGE,this.progressContainer);(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Percentage element:",u),u?(n.setText(u,`${i}%`),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Percentage text updated to:",`${i}%`)):(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Percentage element not found");const h=n.select(l.SELECTORS.PROGRESS_TEXT,this.progressContainer);(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress text element:",h),h&&s?(n.setText(h,s),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress text updated to:",s)):(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Progress text element not found or no message"),this.logger.debug("Progress updated",{current:e,total:t,percentage:i,message:s}),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] updateProgress() completed")}updateTokenStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.tokenStatusElement?(this.tokenStatusElement.className=`token-status ${e}`,this.tokenStatusElement.textContent=t||e,this.logger.debug("Token status updated",{status:e,message:t})):this.logger.warn("Token status element not found")}updateConnectionStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.connectionStatusElement?(this.connectionStatusElement.className=`connection-status ${e}`,this.connectionStatusElement.textContent=t||e,this.logger.debug("Connection status updated",{status:e,message:t})):this.logger.warn("Connection status element not found")}showCurrentTokenStatus(e){if(!e)return void this.logger.warn("No token info provided");const{isValid:t,expiresAt:s,timeRemaining:i}=e;if(!t)return void this.updateTokenStatus("expired","");const n=i?` (${i})`:"";this.updateTokenStatus("valid",`Token valid${n}`),this.logger.info("Current token status displayed",{isValid:t,expiresAt:s,timeRemaining:i})}updateUniversalTokenStatus(e){const t=document.getElementById("token-status-indicator");if(!t)return void this.logger.warn("Token status indicator not found");if(!e)return void(t.style.display="none");const{isValid:s,expiresAt:i,timeRemaining:n}=e,a=t.querySelector(".token-status-content");if(a){const e=a.querySelector(".token-status-icon"),t=a.querySelector(".token-status-text"),i=a.querySelector(".token-status-time");s?(e.textContent="",t.textContent="Token valid",i.textContent=n||""):(e.textContent="",t.textContent="",t.style.visibility="hidden",i.textContent="")}t.style.display="block",this.logger.debug("Token status indicator updated",{isValid:s,timeRemaining:n})}updateHomeTokenStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=document.getElementById("home-token-status");if(!s)return void(window.logger?.error||console.log)(" home-token-status element not found!");(window.logger?.debug||console.log)(" Found home-token-status element:",s);let i=!1,n="btn-danger",a="Get New Token";try{if(i=this.checkForStashedToken(),!i&&window.app&&window.app.pingOneClient){const e=window.app.pingOneClient.getCurrentTokenTimeRemaining();e&&e.token&&!e.isExpired&&(i=!0)}i&&(n="btn-success",a="Token Valid")}catch(e){(window.logger?.error||console.log)("Error checking token status:",e)}const l=document.querySelector(".sidebar");if(l&&s.parentNode!==l&&(l.appendChild(s),(window.logger?.debug||console.log)(" Moved home-token-status to bottom of sidebar")),!document.getElementById("debug-home-token-status-label")){const e=document.createElement("div");e.id="debug-home-token-status-label",e.style.cssText="\n                position: absolute !important;\n                top: -30px !important;\n                left: 0 !important;\n                background: #ff0000 !important;\n                color: #ffffff !important;\n                padding: 4px 8px !important;\n                font-size: 12px !important;\n                font-weight: bold !important;\n                border: 2px solid #000 !important;\n                z-index: 9999 !important;\n                white-space: nowrap !important;\n                pointer-events: none !important;\n            ",e.textContent="DEBUG: home-token-status CONTAINER",s.style.cssText="\n                position: relative !important;\n                background: #ffffcc !important;\n                border: 1px solid #dee2e6 !important;\n                border-radius: 6px !important;\n                padding: 2px !important;\n                width: fit-content !important;\n                height: auto !important;\n                display: block !important;\n                overflow: visible !important;\n                margin-top: auto !important;\n            ",s.appendChild(e),(window.logger?.debug||console.log)(" Added debug label to home-token-status container")}if(e)s.innerHTML="";else{s.innerHTML=`\n                <div id="token-status-indicator" class="token-status-indicator valid" role="status" aria-live="polite" style="display: block !important; padding: 0 !important; margin: 0 !important; background: none !important; border: none !important;">\n                    <button id="get-token-btn" class="btn ${n}" style="font-size: 14px !important; padding: 8px 16px !important; margin: 0 !important; font-weight: 500 !important; border-radius: 6px !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; transition: all 0.2s ease !important;">\n                        <i class="fas fa-key"></i> ${a}\n                    </button>\n                </div>\n            `;const e=document.getElementById("get-token-btn");e&&e.addEventListener("click",()=>{window.tokenStatusIndicator&&"function"==typeof window.tokenStatusIndicator.getNewToken?window.tokenStatusIndicator.getNewToken():"function"==typeof this.getNewToken&&this.getNewToken()})}s.style.display="block",this.logger.debug("Home token status updated",{isLoading:e,message:t,hasValidToken:i,buttonClass:n})}checkForStashedToken(){try{if("undefined"==typeof localStorage)return!1;const e=localStorage.getItem("pingone_worker_token"),t=localStorage.getItem("pingone_token_expiry");if(!e||!t)return!1;const s=parseInt(t,10),i=Date.now();return!(isNaN(s)||i>=s-3e5)}catch(e){return(window.logger?.error||console.error)("Error checking for stashed token:",e),!1}}updateSettingsSaveStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const s=document.querySelector(".settings-save-status");if(!s)return void this.logger.warn("Settings save status element not found");s.className=`settings-save-status ${t} show`;const i=this.getStatusIcon(t);s.innerHTML=`\n            <span>${e}</span>\n            <i class="fas ${i}"></i>\n        `,"success"===t&&setTimeout(()=>{s.classList.remove("show")},3e3),this.logger.info("Settings save status updated",{message:e,type:t})}showSettingsActionStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const s=document.getElementById("settings-action-status");if(!s)return void this.logger.warn("Settings action status element not found");s.innerHTML="",s.className=`settings-action-status ${t}`;const i=document.createElement("div");i.className="status-content";const n=document.createElement("span");n.textContent=e,i.appendChild(n);const a=document.createElement("i");a.className=`fas ${this.getStatusIcon(t)}`,i.appendChild(a),s.appendChild(i),s.style.display="block",this.logger.info("Settings action status shown",{message:e,type:t,autoDismiss:!1})}getStatusIcon(e){const t={success:"fa-check-circle",error:"fa-times-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return t[e]||t.info}hideSettingsActionStatus(){const e=document.getElementById("settings-action-status");e&&(e.style.display="none",this.logger.debug("Settings action status hidden"))}showImportStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=document.getElementById("import-status");if(!i)return void this.logger.warn("Import status element not found");i.style.display="block",i.className=`import-status ${e}`;const n=i.querySelector(".status-text");n&&(n.textContent=t||e),this.logger.info("Import status shown",{status:e,message:t,details:s})}clearNotifications(){this.notificationContainer&&(this.notificationContainer.innerHTML="",this.logger.debug("All notifications cleared")),this.clearStatusBar()}hideProgress(){if(this.progressContainer){(window.safeDOM||new a.SafeDOM(this.logger)).hide(this.progressContainer),this.logger.debug("Progress display hidden")}}showProgress(){(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] showProgress() called"),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] this.progressContainer:",this.progressContainer);let e=this.progressContainer;if(e||((window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress container not found in UI manager, trying direct access..."),e=document.getElementById("progress-container")),e||((window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress container not found by ID, trying ElementRegistry..."),void 0!==n.ElementRegistry&&n.ElementRegistry.progressContainer&&(e=n.ElementRegistry.progressContainer())),e||((window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress container not found by ElementRegistry, trying class selector..."),e=document.querySelector(".progress-container")),!e)return(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Progress container not found by any method"),(window.logger?.error||console.error)(' [UI MANAGER DEBUG] Available containers with "progress" in ID:',Array.from(document.querySelectorAll('[id*="progress"]')).map(e=>e.id)),void(window.logger?.error||console.error)(' [UI MANAGER DEBUG] Available containers with "progress" in class:',Array.from(document.querySelectorAll('[class*="progress"]')).map(e=>({id:e.id,className:e.className})));(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Progress container found, showing..."),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Current display style:",e.style.display),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Current visibility:",null!==e.offsetParent?"visible":"hidden"),e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.classList.remove("hidden","d-none"),e.classList.add("visible"),e.offsetHeight,(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Display style after setting to block:",e.style.display),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Container visibility:",null!==e.offsetParent?"visible":"hidden"),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Container dimensions:",{offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight}),null!==e.offsetParent&&e.scrollIntoView({behavior:"smooth",block:"center"}),this.progressContainer=e,this.logger.debug("Progress display shown"),setTimeout(()=>{const t=null!==e.offsetParent,s=e.getBoundingClientRect();(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Final verification:",{isVisible:t,dimensions:{width:s.width,height:s.height},display:e.style.display,computedDisplay:window.getComputedStyle(e).display})},100)}setButtonLoading(e,t){const s=document.getElementById(e);s?(t?(s.disabled=!0,s.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',s.classList.add("loading")):(s.disabled=!1,s.innerHTML=s.getAttribute("data-original-text")||"Submit",s.classList.remove("loading")),this.logger.debug("Button loading state updated",{buttonId:e,isLoading:t})):"get-token-quick"===e?this.logger.debug(`Button with ID '${e}' not found (may be hidden)`):this.logger.warn(`Button with ID '${e}' not found`)}updatePopulationFields(e){if(!e||!Array.isArray(e))return void this.logger.warn("Invalid populations data provided");const t=document.querySelectorAll('select[id*="population"]');t.forEach(t=>{const s=t.value;t.innerHTML="";const i=document.createElement("option");i.value="",i.textContent="Select a population...",t.appendChild(i),e.forEach(e=>{const s=document.createElement("option");s.value=e.id,s.textContent=e.name,t.appendChild(s)}),s&&t.querySelector(`option[value="${s}"]`)&&(t.value=s)}),this.logger.info("Population fields updated",{populationCount:e.length,selectCount:t.length})}showNotification(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this.notificationContainer)return void this.logger.warn("Notification container not found");this.notificationContainer.innerHTML="";const n=document.createElement("div");n.className="status-content";const a=document.createElement("i");a.className=`fas ${this.getStatusIcon(s)}`,n.appendChild(a);const l=document.createElement("span");l.textContent=e&&t?`${e}: ${t}`:e||t,n.appendChild(l),this.notificationContainer.appendChild(n);const c=!1!==i.autoDismiss&&"error"!==s&&"success"!==s;if(c){const e=i.duration||5e3;setTimeout(()=>{this.notificationContainer&&this.notificationContainer.contains(n)&&(this.notificationContainer.innerHTML="")},e)}this.logger.info("Status header updated",{title:e,message:t,type:s,autoDismiss:c})}updateImportProgress(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(this.updateProgress(e,t,s),i&&"object"==typeof i&&Object.entries(i).forEach(e=>{let[t,s]=e;const i=document.querySelector(`.stat-value.${t}`);i&&(i.textContent=s||0)}),n||a){const e=document.querySelector(".detail-value.population-info");e&&(e.textContent=n||a||"Unknown")}this.logger.debug("Import progress updated",{current:e,total:t,message:s,counts:i,populationName:n,populationId:a})}startImportOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] startImportOperation() called with options:",e);const{operationType:t,totalUsers:s,populationName:i,populationId:n}=e;(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] About to call showProgress()..."),this.showProgress(),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] showProgress() completed"),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] About to call updateProgress()..."),this.updateProgress(0,s||0,"Starting import operation..."),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] updateProgress() completed");const a=document.querySelector(".detail-value.operation-type");(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Operation type element:",a),a?(a.textContent=t||"Import",(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] Operation type updated to:",t||"Import")):(window.logger?.error||console.error)(" [UI MANAGER DEBUG] Operation type element not found"),this.logger.info("Import operation started",{operationType:t,totalUsers:s,populationName:i,populationId:n}),(window.logger?.debug||console.log)(" [UI MANAGER DEBUG] startImportOperation() completed")}updateImportOperationWithSessionId(e){if(!e)return void this.logger.warn("No session ID provided for import operation");const t=document.querySelector(".detail-value.session-id");t&&(t.textContent=e),this.logger.info("Import operation session ID updated",{sessionId:e})}startExportOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{totalUsers:t,populationName:s}=e;this.showProgress(),this.updateProgress(0,t||0,"Starting export operation...");const i=document.querySelector(".detail-value.operation-type");i&&(i.textContent="Export"),this.logger.info("Export operation started",{totalUsers:t,populationName:s})}startDeleteOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{totalUsers:t,populationName:s}=e;this.showProgress(),this.updateProgress(0,t||0,"Starting delete operation...");const i=document.querySelector(".detail-value.operation-type");i&&(i.textContent="Delete"),this.logger.info("Delete operation started",{totalUsers:t,populationName:s})}startModifyOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{totalUsers:t,populationName:s}=e;this.showProgress(),this.updateProgress(0,t||0,"Starting modify operation...");const i=document.querySelector(".detail-value.operation-type");i&&(i.textContent="Modify"),this.logger.info("Modify operation started",{totalUsers:t,populationName:s})}completeOperation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{processed:t,success:s,failed:i,skipped:n}=e;this.updateProgress(t||0,t||0,"Operation completed");const a=`Operation completed: ${s||0} successful, ${i||0} failed, ${n||0} skipped`;this.showSuccess(a),setTimeout(()=>{this.hideProgress()},2e3),this.logger.info("Operation completed",{processed:t,success:s,failed:i,skipped:n})}handleDuplicateUsers(e,t){if(!e||0===e.length)return void this.logger.warn("No duplicates provided for handling");const s=`Found ${e.length} duplicate users. How would you like to proceed?`;this.showWarning(s),this.logger.info("Duplicate users found",{count:e.length}),t&&"function"==typeof t&&t("skip")}debugLog(e,t){l&&this.logger.debug(`[${e}] ${t}`)}showStatusMessage(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const i=s?`${t}: ${s}`:t;this.showNotification("Status Update",i,e)}showExportStatus(){this.showProgress(),this.updateProgress(0,100,"Preparing export..."),this.logger.info("Export status shown")}showStartupWaitScreen(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Initializing application...";try{let t=document.getElementById("startup-wait-screen");if(t){const s=t.querySelector(".startup-message");s&&(s.textContent=e)}else t=document.createElement("div"),t.id="startup-wait-screen",t.className="startup-wait-screen",t.innerHTML=`\n                    <div class="startup-content">\n                        <div class="startup-spinner"></div>\n                        <div class="startup-message">${e}</div>\n                    </div>\n                `,document.body.appendChild(t);t.style.display="flex",this.logger.debug("Startup wait screen shown",{message:e})}catch(e){this.logger.error("Error showing startup wait screen:",e)}}hideStartupWaitScreen(){try{const e=document.getElementById("startup-wait-screen");e&&(e.style.display="none",this.logger.debug("Startup wait screen hidden"))}catch(e){this.logger.error("Error hiding startup wait screen:",e)}}updateStartupMessage(e){try{const t=document.getElementById("startup-wait-screen");if(t){const s=t.querySelector(".startup-message");s?(s.textContent=e,this.logger.debug("Startup message updated",{message:e})):this.logger.warn("Startup message element not found")}else this.showStartupWaitScreen(e)}catch(e){this.logger.error("Error updating startup message:",e)}}updateExportProgress(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.updateProgress(e,t,s),i&&"object"==typeof i&&Object.entries(i).forEach(e=>{let[t,s]=e;const i=document.querySelector(`.stat-value.${t}`);i&&(i.textContent=s||0)}),this.logger.debug("Export progress updated",{current:e,total:t,message:s,counts:i})}showDeleteStatus(e,t,s){this.showProgress(),this.updateProgress(0,e||0,"Preparing delete operation...");const i=document.querySelector(".detail-value.operation-type");i&&(i.textContent="Delete"),this.logger.info("Delete status shown",{totalUsers:e,populationName:t,populationId:s})}updateDeleteProgress(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this.updateProgress(e,t,s),i&&"object"==typeof i&&Object.entries(i).forEach(e=>{let[t,s]=e;const i=document.querySelector(`.stat-value.${t}`);i&&(i.textContent=s||0)}),this.logger.debug("Delete progress updated",{current:e,total:t,message:s,counts:i,populationName:n,populationId:a})}showModifyStatus(e){this.showProgress(),this.updateProgress(0,e||0,"Preparing modify operation...");const t=document.querySelector(".detail-value.operation-type");t&&(t.textContent="Modify"),this.logger.info("Modify status shown",{totalUsers:e})}updateModifyProgress(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.updateProgress(e,t,s),i&&"object"==typeof i&&Object.entries(i).forEach(e=>{let[t,s]=e;const i=document.querySelector(`.stat-value.${t}`);i&&(i.textContent=s||0)}),this.logger.debug("Modify progress updated",{current:e,total:t,message:s,counts:i})}}}).call(this)}).call(this,e("_process"))},{"../../../public/js/modules/circular-progress.js":74,"../../../public/js/modules/element-registry.js":75,"../../../public/js/modules/error/error-types.js":76,"../../../public/js/modules/progress-manager.js":78,"../../../public/js/modules/utils/safe-dom.js":80,"@babel/runtime/helpers/interopRequireDefault":1,_process:60}],86:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AdvancedRealtimeSubsystem=void 0;s.AdvancedRealtimeSubsystem=class AdvancedRealtimeSubsystem{constructor(e,t,s,i,n){this.logger=e,this.eventBus=t,this.realtimeCommunication=s,this.sessionSubsystem=i,this.progressSubsystem=n,this.activeUsers=new Map,this.collaborationRooms=new Map,this.sharedOperations=new Map,this.liveProgressStreams=new Map,this.notificationQueues=new Map,this.analyticsStreams=new Map,this.config={maxUsersPerRoom:10,progressUpdateInterval:1e3,presenceUpdateInterval:5e3,notificationRetention:100,analyticsBufferSize:1e3},this.logger.info("Advanced Real-time Features Subsystem initialized")}async init(){try{this.setupEventBusListeners(),await this.initializePresenceSystem(),await this.initializeLiveProgressSharing(),await this.initializeNotificationSystem(),await this.initializeCollaborativeOperations(),await this.initializeLiveAnalytics(),this.logger.info("Advanced Real-time Features Subsystem initialized successfully"),this.eventBus.emit("subsystem:ready",{subsystem:"advanced-realtime"})}catch(e){throw this.logger.error("Failed to initialize Advanced Real-time Features Subsystem",e),this.eventBus.emit("subsystem:error",{subsystem:"advanced-realtime",error:e}),e}}setupEventBusListeners(){this.logger.debug("Setting up EventBus listeners for advanced real-time features"),this.eventBus.on("session:user-joined",e=>this.handleUserJoined(e)),this.eventBus.on("session:user-left",e=>this.handleUserLeft(e)),this.eventBus.on("session:activity-update",e=>this.handleActivityUpdate(e)),this.eventBus.on("operation:started",e=>this.handleOperationStarted(e)),this.eventBus.on("operation:progress",e=>this.handleOperationProgress(e)),this.eventBus.on("operation:completed",e=>this.handleOperationCompleted(e)),this.eventBus.on("operation:failed",e=>this.handleOperationFailed(e)),this.eventBus.on("progress:updated",e=>this.handleProgressUpdate(e)),this.eventBus.on("progress:milestone",e=>this.handleProgressMilestone(e)),this.eventBus.on("analytics:metric-update",e=>this.handleAnalyticsUpdate(e)),this.eventBus.on("analytics:performance-data",e=>this.handlePerformanceData(e)),this.logger.debug("EventBus listeners set up for advanced real-time features")}async initializePresenceSystem(){this.logger.debug("Initializing multi-user presence system"),this.presenceInterval=setInterval(()=>{this.broadcastPresence()},this.config.presenceUpdateInterval),this.realtimeCommunication.on("user-presence",e=>{this.handlePresenceUpdate(e)}),this.realtimeCommunication.on("user-connected",e=>{this.handleUserConnected(e)}),this.realtimeCommunication.on("user-disconnected",e=>{this.handleUserDisconnected(e)}),this.logger.debug("Multi-user presence system initialized")}async initializeLiveProgressSharing(){this.logger.debug("Initializing live progress sharing"),this.progressInterval=setInterval(()=>{this.streamProgressUpdates()},this.config.progressUpdateInterval),this.realtimeCommunication.on("progress-update",e=>{this.handleSharedProgressUpdate(e)}),this.realtimeCommunication.on("progress-sync-request",e=>{this.handleProgressSyncRequest(e)}),this.logger.debug("Live progress sharing initialized")}broadcastPresence(){try{if(!this.currentRoom||!this.currentUser)return;const e={roomId:this.currentRoom,userId:this.currentUser.id||"anonymous",userName:this.currentUser.name||"Anonymous User",status:"active",lastActivity:(new Date).toISOString(),timestamp:(new Date).toISOString()};this.realtimeCommunication.emit("user-presence",e),this.activeUsers.set(e.userId,{...e,joinedAt:this.activeUsers.get(e.userId)?.joinedAt||new Date}),this.eventBus.emit("realtime:presence-broadcasted",e),this.logger.debug("Presence broadcasted",{roomId:this.currentRoom,userId:e.userId})}catch(e){this.logger.error("Failed to broadcast presence",e)}}streamProgressUpdates(){try{if(!this.currentRoom||!this.progressSubsystem)return;const e=this.progressSubsystem.getCurrentProgress();if(e&&e.isActive){const t={roomId:this.currentRoom,userId:this.currentUser?.id||"anonymous",userName:this.currentUser?.name||"Anonymous User",progress:{operationType:e.operationType,percentage:e.percentage,currentStep:e.currentStep,totalSteps:e.totalSteps,message:e.message,timestamp:(new Date).toISOString()}};this.realtimeCommunication.emit("progress-update",t),this.sharedProgress.set(t.userId,t.progress),this.eventBus.emit("realtime:progress-streamed",t),this.logger.debug("Progress update streamed",{roomId:this.currentRoom,userId:t.userId,percentage:e.percentage})}}catch(e){this.logger.error("Failed to stream progress updates",e)}}async initializeNotificationSystem(){this.logger.debug("Initializing real-time notification system"),this.realtimeCommunication.on("notification",e=>{this.handleIncomingNotification(e)}),this.eventBus.on("notification:send",e=>{this.broadcastNotification(e)}),this.logger.debug("Real-time notification system initialized")}async initializeCollaborativeOperations(){this.logger.debug("Initializing collaborative operation management"),this.realtimeCommunication.on("operation-request",e=>{this.handleOperationRequest(e)}),this.realtimeCommunication.on("operation-lock",e=>{this.handleOperationLock(e)}),this.realtimeCommunication.on("operation-unlock",e=>{this.handleOperationUnlock(e)}),this.logger.debug("Collaborative operation management initialized")}async initializeLiveAnalytics(){this.logger.debug("Initializing live analytics streaming"),this.analyticsInterval=setInterval(()=>{this.streamAnalyticsData()},5e3),this.realtimeCommunication.on("analytics-update",e=>{this.handleAnalyticsStreamUpdate(e)}),this.logger.debug("Live analytics streaming initialized")}streamAnalyticsData(){try{if(!this.currentRoom||!this.analyticsDashboard)return;const e=this.analyticsDashboard.getAnalyticsDashboardData("5m");if(e){const t={roomId:this.currentRoom,userId:this.currentUser?.id||"anonymous",analytics:{systemMetrics:e.systemMetrics,operationSummary:e.operationSummary,recentActivity:e.recentActivity?.slice(0,5),timestamp:(new Date).toISOString()}};this.realtimeCommunication.emit("analytics-update",t),this.eventBus.emit("realtime:analytics-streamed",t),this.logger.debug("Analytics data streamed",{roomId:this.currentRoom,userId:t.userId,metricsCount:Object.keys(t.analytics.systemMetrics||{}).length})}}catch(e){this.logger.error("Failed to stream analytics data",e)}}async joinCollaborationRoom(e,t){this.logger.info("Joining collaboration room",{roomId:e,userId:t.id});try{if(this.collaborationRooms.has(e)){if(this.collaborationRooms.get(e).users.size>=this.config.maxUsersPerRoom)throw new Error("Collaboration room is at capacity")}else this.collaborationRooms.set(e,{id:e,users:new Map,operations:new Map,createdAt:new Date,lastActivity:new Date});const s=this.collaborationRooms.get(e);return s.users.set(t.id,{...t,joinedAt:new Date,lastSeen:new Date,isActive:!0}),this.broadcastToRoom(e,"user-joined",{roomId:e,user:t,totalUsers:s.users.size}),this.sendToUser(t.id,"room-state",{roomId:e,users:Array.from(s.users.values()),operations:Array.from(s.operations.values())}),this.eventBus.emit("collaboration:user-joined",{roomId:e,user:t}),{success:!0,roomId:e,userCount:s.users.size,users:Array.from(s.users.values())}}catch(t){throw this.logger.error("Failed to join collaboration room",{roomId:e,error:t.message}),t}}async leaveCollaborationRoom(e,t){this.logger.info("Leaving collaboration room",{roomId:e,userId:t});try{if(!this.collaborationRooms.has(e))return{success:!0,message:"Room does not exist"};const s=this.collaborationRooms.get(e),i=s.users.get(t);return i&&(s.users.delete(t),this.broadcastToRoom(e,"user-left",{roomId:e,userId:t,user:i,totalUsers:s.users.size}),0===s.users.size&&(this.collaborationRooms.delete(e),this.logger.debug("Removed empty collaboration room",{roomId:e})),this.eventBus.emit("collaboration:user-left",{roomId:e,userId:t,user:i})),{success:!0,roomId:e,userCount:s.users.size}}catch(s){throw this.logger.error("Failed to leave collaboration room",{roomId:e,userId:t,error:s.message}),s}}async startLiveProgressSharing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logger.info("Starting live progress sharing",{operationId:e});try{const s={operationId:e,startTime:new Date,lastUpdate:new Date,subscribers:new Set,config:{updateInterval:t.updateInterval||this.config.progressUpdateInterval,includeMetrics:t.includeMetrics||!0,includeErrors:t.includeErrors||!0,maxHistory:t.maxHistory||100},history:[],currentProgress:{percentage:0,stage:"initializing",message:"Starting operation...",metrics:{}}};return this.liveProgressStreams.set(e,s),this.broadcastProgressEvent("progress-sharing-started",{operationId:e,config:s.config}),this.eventBus.emit("progress-sharing:started",{operationId:e,config:s.config}),{success:!0,operationId:e,streamId:e}}catch(t){throw this.logger.error("Failed to start live progress sharing",{operationId:e,error:t.message}),t}}async subscribeLiveProgress(e,t){if(this.logger.debug("Subscribing to live progress",{operationId:e,subscriberId:t}),!this.liveProgressStreams.has(e))throw new Error(`Progress stream not found for operation: ${e}`);const s=this.liveProgressStreams.get(e);return s.subscribers.add(t),this.sendProgressUpdate(t,{operationId:e,progress:s.currentProgress,history:s.history.slice(-10)}),this.logger.debug("Subscribed to live progress",{operationId:e,subscriberId:t,totalSubscribers:s.subscribers.size}),{success:!0,operationId:e,subscriberId:t}}async sendRealtimeNotification(e){this.logger.debug("Sending real-time notification",{type:e.type,recipients:e.recipients?.length});try{const t={id:this.generateId(),timestamp:new Date,...e};return e.recipients&&e.recipients.forEach(e=>{this.notificationQueues.has(e)||this.notificationQueues.set(e,[]);const s=this.notificationQueues.get(e);s.push(t),s.length>this.config.notificationRetention&&s.shift()}),this.broadcastNotification(t),this.eventBus.emit("notification:sent",t),{success:!0,notificationId:t.id}}catch(e){throw this.logger.error("Failed to send real-time notification",{error:e.message}),e}}async getLiveAnalyticsDashboard(){this.logger.debug("Getting live analytics dashboard data");try{return{timestamp:new Date,activeUsers:this.activeUsers.size,collaborationRooms:this.collaborationRooms.size,liveProgressStreams:this.liveProgressStreams.size,totalNotifications:Array.from(this.notificationQueues.values()).reduce((e,t)=>e+t.length,0),connectionStatus:this.realtimeCommunication.getConnectionStatus(),systemMetrics:await this.getSystemMetrics(),operationMetrics:await this.getOperationMetrics(),userActivity:await this.getUserActivityMetrics()}}catch(e){throw this.logger.error("Failed to get live analytics dashboard data",{error:e.message}),e}}handleUserJoined(e){this.logger.debug("Handling user joined event",e),this.activeUsers.set(e.userId,{...e,joinedAt:new Date,lastActivity:new Date}),this.broadcastPresenceUpdate()}handleUserLeft(e){this.logger.debug("Handling user left event",e),this.activeUsers.delete(e.userId),this.broadcastPresenceUpdate()}handleOperationStarted(e){this.logger.debug("Handling operation started event",e),e.shareProgress&&this.startLiveProgressSharing(e.operationId,e.progressConfig)}handleOperationProgress(e){this.logger.debug("Handling operation progress event",e),this.liveProgressStreams.has(e.operationId)&&this.updateLiveProgress(e.operationId,e.progress)}handleProgressUpdate(e){this.logger.debug("Handling progress update event",e),this.streamProgressUpdate(e)}broadcastToRoom(e,t,s){if(this.collaborationRooms.has(e)){this.collaborationRooms.get(e).users.forEach((e,i)=>{this.sendToUser(i,t,s)})}}sendToUser(e,t,s){this.realtimeCommunication.isConnected&&this.realtimeCommunication.socket?.emit("user-message",{targetUserId:e,event:t,data:s})}broadcastPresenceUpdate(){const e={activeUsers:Array.from(this.activeUsers.values()),timestamp:new Date};this.realtimeCommunication.socket?.emit("presence-update",e),this.eventBus.emit("presence:updated",e)}streamProgressUpdate(e){this.realtimeCommunication.socket?.emit("progress-stream",e),this.eventBus.emit("progress-stream:update",e)}broadcastNotification(e){this.realtimeCommunication.socket?.emit("notification-broadcast",e)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async getSystemMetrics(){return{memoryUsage:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:null,connectionLatency:await this.measureConnectionLatency(),timestamp:new Date}}async getOperationMetrics(){return{activeOperations:this.liveProgressStreams.size,completedOperations:0,failedOperations:0,averageOperationTime:0,timestamp:new Date}}async getUserActivityMetrics(){return{activeUsers:this.activeUsers.size,totalSessions:this.sessionSubsystem?await this.sessionSubsystem.getActiveSessionCount():0,averageSessionDuration:0,timestamp:new Date}}async measureConnectionLatency(){if(!this.realtimeCommunication.isConnected)return null;const e=performance.now();return new Promise(t=>{this.realtimeCommunication.socket?.emit("ping",e,s=>{const i=performance.now()-e;t(i)}),setTimeout(()=>t(null),5e3)})}async disconnect(){this.logger.info("Disconnecting Advanced Real-time Features Subsystem"),this.presenceInterval&&clearInterval(this.presenceInterval),this.progressInterval&&clearInterval(this.progressInterval),this.analyticsInterval&&clearInterval(this.analyticsInterval),this.activeUsers.clear(),this.collaborationRooms.clear(),this.sharedOperations.clear(),this.liveProgressStreams.clear(),this.notificationQueues.clear(),this.analyticsStreams.clear(),this.logger.info("Advanced Real-time Features Subsystem disconnected")}getStatus(){return{isInitialized:!0,activeUsers:this.activeUsers.size,collaborationRooms:this.collaborationRooms.size,liveProgressStreams:this.liveProgressStreams.size,connectionStatus:this.realtimeCommunication.getConnectionStatus(),timestamp:new Date}}}},{}],87:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AuthManagementSubsystem=void 0;s.AuthManagementSubsystem=class AuthManagementSubsystem{constructor(e,t,s,i){this.logger=e,this.uiManager=t,this.localClient=s,this.settingsSubsystem=i,this.isAuthenticated=!1,this.tokenStatus=null,this.tokenExpiry=null,this.refreshTimer=null,this.logger.info("Authentication Management Subsystem initialized")}async init(){try{this.setupEventListeners(),await this.checkInitialTokenStatus(),this.setupTokenRefreshTimer(),this.logger.info("Authentication Management Subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize Authentication Management Subsystem",e),e}}setupEventListeners(){const e=document.getElementById("get-token-btn");e&&e.addEventListener("click",async e=>{e.preventDefault(),await this.getToken()});const t=document.getElementById("test-connection-btn");t&&t.addEventListener("click",async e=>{e.preventDefault(),await this.testConnection()});const s=document.getElementById("global-refresh-token");s&&s.addEventListener("click",async e=>{e.preventDefault(),await this.refreshToken()});const i=document.getElementById("settings-form");i&&i.addEventListener("submit",async e=>{e.preventDefault(),await this.handleSettingsSubmit(e)})}async getToken(){try{this.logger.info("Getting new authentication token"),this.showTokenProgress("Getting token..."),await this.settingsSubsystem.loadCurrentSettings();const e=this.settingsSubsystem.currentSettings;if(!this.validateSettings(e))throw new Error("Invalid settings - please check your configuration");const t=await this.localClient.post("/api/v1/auth/token",{clientId:e.clientId,clientSecret:e.clientSecret,environmentId:e.environmentId,region:e.region});if(!t.success)throw new Error(t.error||"Failed to get token");this.tokenStatus=t.token,this.tokenExpiry=t.expiry,this.isAuthenticated=!0,this.updateTokenStatusUI(!0,"Token obtained successfully"),this.uiManager.showSuccess("Authentication successful"),this.setupTokenRefreshTimer(),this.logger.info("Token obtained successfully")}catch(e){this.logger.error("Failed to get token",e),this.updateTokenStatusUI(!1,e.message),this.uiManager.showError("Authentication Failed",e.message)}finally{this.hideTokenProgress()}}async testConnection(){try{this.logger.info("Testing connection"),this.showConnectionProgress("Testing connection..."),await this.settingsSubsystem.loadCurrentSettings();const e=this.settingsSubsystem.currentSettings;if(!this.validateSettings(e))throw new Error("Invalid settings - please check your configuration");const t=await this.localClient.post("/api/pingone/test-connection",{environmentId:e.environmentId,clientId:e.clientId,clientSecret:e.clientSecret,region:e.region});if(!t.success)throw new Error(t.error||"Connection test failed");this.updateConnectionStatusUI(!0,"Connection successful"),this.uiManager.showSuccess("Connection test successful"),this.logger.info("Connection test successful")}catch(e){this.logger.error("Connection test failed",e),this.updateConnectionStatusUI(!1,e.message),this.uiManager.showError("Connection Test Failed",e.message)}finally{this.hideConnectionProgress()}}async refreshToken(){try{this.logger.info("Refreshing authentication token"),this.showTokenProgress("Refreshing token...");const e=await this.localClient.post("/api/v1/auth/refresh");if(!e.success)throw new Error(e.error||"Failed to refresh token");this.tokenStatus=e.token,this.tokenExpiry=e.expiry,this.isAuthenticated=!0,this.updateTokenStatusUI(!0,"Token refreshed successfully"),this.uiManager.showSuccess("Token refreshed successfully"),this.setupTokenRefreshTimer(),this.logger.info("Token refreshed successfully")}catch(e){this.logger.error("Failed to refresh token",e),this.updateTokenStatusUI(!1,e.message),this.uiManager.showError("Token Refresh Failed",e.message),this.clearAuthenticationState()}finally{this.hideTokenProgress()}}async handleSettingsSubmit(e){try{const t=new FormData(e.target),s=Object.fromEntries(t.entries());if(this.logger.info("Saving settings"),!this.validateSettings(s))throw new Error("Invalid settings - please check all required fields");await this.settingsManager.saveSettings(s),this.clearAuthenticationState(),this.uiManager.updateSettingsSaveStatus("Settings saved successfully","success"),this.logger.info("Settings saved successfully")}catch(e){this.logger.error("Failed to save settings",e),this.uiManager.updateSettingsSaveStatus(`Settings Save Failed: ${e.message}`,"error")}}async checkInitialTokenStatus(){try{this.logger.debug(" [STARTUP] Checking initial token status...");const e=await this.localClient.get("/api/v1/auth/status");if(e.success&&e.isValid)this.tokenStatus=e.status,this.tokenExpiry=e.expiresIn,this.isAuthenticated=!0,this.updateTokenStatusUI(!0,`Token is ${e.status}`),this.logger.info(" [STARTUP] Valid token found, authentication ready");else if(e.success&&e.hasToken){this.logger.warn(" [STARTUP] Token expired, attempting automatic refresh..."),this.tokenStatus=e.status,this.tokenExpiry=e.expiresIn;await this.attemptAutomaticTokenRefresh()?this.logger.info(" [STARTUP] Token automatically refreshed, authentication ready"):(this.logger.warn(" [STARTUP] Automatic token refresh failed, user intervention required"),this.isAuthenticated=!1,this.updateTokenStatusUI(!1,"Token expired - refresh required"))}else{this.logger.warn(" [STARTUP] No token found, attempting automatic acquisition...");await this.attemptAutomaticTokenRefresh()?this.logger.info(" [STARTUP] Token automatically acquired, authentication ready"):(this.logger.warn(" [STARTUP] No token available and automatic acquisition failed"),this.isAuthenticated=!1,this.updateTokenStatusUI(!1,e.status||"No valid token"))}}catch(e){this.logger.error(" [STARTUP] Failed to check token status",e),this.isAuthenticated=!1,this.updateTokenStatusUI(!1,"Token status unknown")}}async attemptAutomaticTokenRefresh(){try{this.logger.debug(" [STARTUP] Attempting automatic token acquisition..."),await this.settingsSubsystem.loadCurrentSettings();const e=this.settingsSubsystem.currentSettings;if(!this.validateSettings(e))return this.logger.debug(" [STARTUP] No valid credentials available for automatic token acquisition"),!1;this.logger.debug(" [STARTUP] Valid credentials found, attempting token acquisition...");const t=await this.localClient.post("/api/v1/auth/token",{clientId:e.clientId,clientSecret:e.clientSecret,environmentId:e.environmentId,region:e.region});return t.success&&t.token?(this.tokenStatus=t.token,this.tokenExpiry=t.expiry,this.isAuthenticated=!0,this.updateTokenStatusUI(!0,"Token obtained automatically"),this.setupTokenRefreshTimer(),this.logger.info(" [STARTUP] Automatic token acquisition successful"),!0):(this.logger.warn(" [STARTUP] Token acquisition failed:",t.error||"Unknown error"),!1)}catch(e){return this.logger.error(" [STARTUP] Error during automatic token acquisition:",e),!1}}setupTokenRefreshTimer(){if(this.refreshTimer&&clearTimeout(this.refreshTimer),!this.tokenExpiry)return;const e=new Date(this.tokenExpiry).getTime()-3e5,t=Date.now();if(e>t){const s=e-t;this.refreshTimer=setTimeout(()=>{this.refreshToken()},s),this.logger.info("Token refresh timer set",{refreshIn:Math.round(s/1e3/60),unit:"minutes"})}}validateSettings(e){const t=["clientId","clientSecret","environmentId","region"];for(const s of t)if(!e[s]||""===e[s].trim())return this.logger.error("Missing required setting",{field:s}),!1;return!0}clearAuthenticationState(){this.isAuthenticated=!1,this.tokenStatus=null,this.tokenExpiry=null,this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),this.updateTokenStatusUI(!1,"Authentication cleared")}updateTokenStatusUI(e,t){const s=document.getElementById("global-token-status");s&&(s.className="token-status "+(e?"valid":"invalid"),s.textContent=t);const i=document.getElementById("token-status-indicator");i&&(i.className="token-indicator "+(e?"valid":"invalid"));const n=document.getElementById("get-token-btn");n&&(n.style.display=e?"none":"inline-block");const a=document.getElementById("global-refresh-token");a&&(a.style.display=e?"inline-block":"none")}updateConnectionStatusUI(e,t){const s=document.getElementById("connection-status");s&&(s.className="connection-status "+(e?"connected":"disconnected"),s.textContent=t)}showTokenProgress(e){const t=document.getElementById("get-token-btn");t&&(t.disabled=!0,t.textContent=e)}hideTokenProgress(){const e=document.getElementById("get-token-btn");e&&(e.disabled=!1,e.textContent="Get Token")}showConnectionProgress(e){const t=document.getElementById("test-connection-btn");t&&(t.disabled=!0,t.textContent=e)}hideConnectionProgress(){const e=document.getElementById("test-connection-btn");e&&(e.disabled=!1,e.textContent="Test Connection")}getAuthenticationStatus(){return{isAuthenticated:this.isAuthenticated,tokenStatus:this.tokenStatus,tokenExpiry:this.tokenExpiry,timeUntilExpiry:this.tokenExpiry?Math.max(0,new Date(this.tokenExpiry).getTime()-Date.now()):0}}isTokenValid(){if(!this.isAuthenticated||!this.tokenExpiry)return!1;const e=Date.now();return new Date(this.tokenExpiry).getTime()>e}}},{}],88:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ConnectionManagerSubsystem=void 0;var i=e("../utils/browser-logging-service.js");s.ConnectionManagerSubsystem=class ConnectionManagerSubsystem{constructor(e,t,s,n){this.logger=e||(0,i.createLogger)({serviceName:"connection-manager-subsystem",environment:"development"}),this.uiManager=t,this.settingsManager=s,this.apiClient=n,this.connectionStatus="disconnected",this.lastConnectionTest=null,this.tokenInfo={token:null,expiresAt:null,isValid:!1},this.healthCheckInterval=null,this.tokenRefreshInterval=null,this.connectionRetryCount=0,this.maxRetryAttempts=3,this.eventListeners=new Map,this.logger.info("Connection Manager subsystem initialized")}async init(){try{this.logger.info("Initializing connection manager subsystem..."),await this.loadExistingToken(),this.startConnectionMonitoring(),this.setupTokenRefresh(),this.logger.info("Connection Manager subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize connection manager subsystem",{error:e.message}),e}}async testConnection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{this.logger.info("Testing PingOne connection..."),this.uiManager&&this.uiManager.updateConnectionStatus("testing","Testing connection...");const t=e||await this.getCredentials();if(!t)throw new Error("No credentials available for connection test");this.validateCredentials(t);const s=await this.acquireToken(t);if(s.success)return this.connectionStatus="connected",this.lastConnectionTest={timestamp:Date.now(),success:!0,credentials:{clientId:t.clientId,environmentId:t.environmentId,region:t.region}},this.uiManager&&this.uiManager.updateConnectionStatus("success","Connection successful"),this.logger.info("Connection test successful"),this.emit("connectionSuccess",this.lastConnectionTest),{success:!0,message:"Connection successful",token:s.token,expiresIn:s.expiresIn};throw new Error(s.error||"Failed to acquire token")}catch(e){return this.logger.error("Connection test failed",{error:e.message}),this.connectionStatus="disconnected",this.lastConnectionTest={timestamp:Date.now(),success:!1,error:e.message},this.uiManager&&this.uiManager.updateConnectionStatus("error",`Connection failed: ${e.message}`),this.emit("connectionFailure",{error:e.message}),{success:!1,error:e.message}}}async acquireToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{this.logger.info("Acquiring PingOne token...");const t=e||await this.getCredentials();if(!t)throw new Error("No credentials available for token acquisition");this.validateCredentials(t);const s=await this.apiClient.post("/api/auth/token",{clientId:t.clientId,clientSecret:t.clientSecret,environmentId:t.environmentId,region:t.region});if(s.success&&s.token)return this.tokenInfo={token:s.token,expiresAt:Date.now()+1e3*s.expiresIn,isValid:!0,acquiredAt:Date.now()},this.connectionStatus="connected",this.uiManager&&this.uiManager.updateTokenStatus(!0,"Token acquired successfully"),this.logger.info("Token acquired successfully",{expiresIn:s.expiresIn}),this.emit("tokenAcquired",{token:s.token,expiresIn:s.expiresIn}),{success:!0,token:s.token,expiresIn:s.expiresIn};throw new Error(s.error||"Failed to acquire token")}catch(e){return this.logger.error("Token acquisition failed",{error:e.message}),this.tokenInfo={token:null,expiresAt:null,isValid:!1},this.connectionStatus="disconnected",this.uiManager&&this.uiManager.updateTokenStatus(!1,`Token acquisition failed: ${e.message}`),this.emit("tokenAcquisitionFailure",{error:e.message}),{success:!1,error:e.message}}}async validateToken(){try{if(!this.tokenInfo.token)return this.logger.debug("No token to validate"),!1;if(this.tokenInfo.expiresAt&&Date.now()>=this.tokenInfo.expiresAt)return this.logger.info("Token has expired"),this.tokenInfo.isValid=!1,!1;const e=(await this.apiClient.get("/api/auth/validate",{headers:{Authorization:`Bearer ${this.tokenInfo.token}`}})).success;return this.tokenInfo.isValid=e,e?(this.logger.debug("Token validation successful"),this.connectionStatus="connected"):(this.logger.info("Token validation failed"),this.connectionStatus="disconnected"),e}catch(e){return this.logger.error("Token validation error",{error:e.message}),this.tokenInfo.isValid=!1,this.connectionStatus="disconnected",!1}}async refreshToken(){try{this.logger.info("Refreshing token...");const e=await this.getCredentials();if(!e)throw new Error("No credentials available for token refresh");const t=await this.acquireToken(e);return t.success&&(this.logger.info("Token refreshed successfully"),this.emit("tokenRefreshed",{token:t.token,expiresIn:t.expiresIn})),t}catch(e){return this.logger.error("Token refresh failed",{error:e.message}),this.emit("tokenRefreshFailure",{error:e.message}),{success:!1,error:e.message}}}async getCredentials(){try{if(window.credentialsManager){const e=window.credentialsManager.getCredentials();if(e&&this.isValidCredentialSet(e))return e}if(this.settingsManager){await this.settingsManager.loadCurrentSettings();const e=this.settingsManager.currentSettings;if(e&&this.isValidCredentialSet(e))return{clientId:e.clientId,clientSecret:e.clientSecret,environmentId:e.environmentId,region:e.region}}return null}catch(e){return this.logger.error("Failed to get credentials",{error:e.message}),null}}validateCredentials(e){const t=["clientId","clientSecret","environmentId"].filter(t=>!e[t]);if(t.length>0)throw new Error(`Missing required credentials: ${t.join(", ")}`);if(!/^[a-f0-9-]{36}$/.test(e.clientId))throw new Error("Invalid client ID format");if(!/^[a-f0-9-]{36}$/.test(e.environmentId))throw new Error("Invalid environment ID format");if(e.clientSecret.length<10)throw new Error("Client secret appears to be invalid")}isValidCredentialSet(e){try{return this.validateCredentials(e),!0}catch(e){return!1}}async loadExistingToken(){try{if(window.globalTokenManager&&"function"==typeof window.globalTokenManager.getCachedToken){const e=window.globalTokenManager.getCachedToken();if(e){this.tokenInfo={token:e.token,expiresAt:e.expiresAt,isValid:e.isValid,acquiredAt:e.acquiredAt};await this.validateToken()?(this.connectionStatus="connected",this.logger.info("Existing token loaded and validated")):this.logger.info("Existing token loaded but invalid")}}}catch(e){this.logger.error("Failed to load existing token",{error:e.message})}}startConnectionMonitoring(){this.healthCheckInterval=setInterval(async()=>{if("connected"===this.connectionStatus){await this.validateToken()||(this.logger.info("Connection lost during health check"),this.emit("connectionLost"))}},3e5),this.logger.debug("Connection monitoring started")}setupTokenRefresh(){this.tokenRefreshInterval=setInterval(async()=>{if(this.tokenInfo.token&&this.tokenInfo.expiresAt){const e=this.tokenInfo.expiresAt-Date.now();e<=3e5&&e>0&&(this.logger.info("Token expiring soon, attempting refresh..."),await this.refreshToken())}},6e4),this.logger.debug("Automatic token refresh setup")}getConnectionStatus(){return this.connectionStatus}getTokenInfo(){return{hasToken:!!this.tokenInfo.token,isValid:this.tokenInfo.isValid,expiresAt:this.tokenInfo.expiresAt,timeUntilExpiry:this.tokenInfo.expiresAt?this.tokenInfo.expiresAt-Date.now():null}}getLastConnectionTest(){return this.lastConnectionTest}isConnected(){return"connected"===this.connectionStatus&&this.tokenInfo.isValid}hasValidToken(){return this.tokenInfo.isValid&&this.tokenInfo.token&&this.tokenInfo.expiresAt&&Date.now()<this.tokenInfo.expiresAt}disconnect(){this.logger.info("Disconnecting..."),this.tokenInfo={token:null,expiresAt:null,isValid:!1},this.connectionStatus="disconnected",this.uiManager&&(this.uiManager.updateConnectionStatus("disconnected","Disconnected"),this.uiManager.updateTokenStatus(!1,"No token")),this.emit("disconnected"),this.logger.info("Disconnected successfully")}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(this.eventListeners.has(e)){const s=this.eventListeners.get(e),i=s.indexOf(t);i>-1&&s.splice(i,1)}}emit(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(s=>{try{s(t)}catch(t){this.logger.error("Event listener error",{event:e,error:t.message})}})}getConnectionStats(){return{status:this.connectionStatus,hasToken:!!this.tokenInfo.token,tokenValid:this.tokenInfo.isValid,tokenExpiresAt:this.tokenInfo.expiresAt,lastConnectionTest:this.lastConnectionTest,retryCount:this.connectionRetryCount}}cleanup(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.tokenRefreshInterval&&(clearInterval(this.tokenRefreshInterval),this.tokenRefreshInterval=null),this.eventListeners.clear(),this.disconnect(),this.logger.info("Connection Manager subsystem cleaned up")}}},{"../utils/browser-logging-service.js":97}],89:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=class HistorySubsystem{constructor(e,t,s,i){if(!(e&&t&&s&&i))throw new Error("HistorySubsystem: logger, localClient, uiManager, and eventBus are required.");this.logger=e.child({subsystem:"HistorySubsystem"}),this.localClient=t,this.uiManager=s,this.eventBus=i,this.history=[],this.logger.info("HistorySubsystem initialized.")}async init(){this.logger.info("Initializing..."),this.eventBus.on("operation-completed",()=>this.fetchHistory(!0)),await this.fetchHistory(),this.logger.info("Successfully initialized.")}async fetchHistory(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.history.length>0&&!e)return this.history;this.logger.info("Fetching operation history...");try{const e=await this.localClient.get("/history");return this.history=e.history||[],this.logger.info(`Successfully fetched ${this.history.length} history records.`),this.renderHistory(),this.history}catch(e){return this.logger.error("Failed to fetch history:",e),this.uiManager.showError("Could not load operation history."),[]}}renderHistory(){this.logger.debug("Rendering history view...");const e=document.getElementById("history-view");e?(e.innerHTML=`<pre>${JSON.stringify(this.history,null,2)}</pre>`,this.logger.debug("History view rendered.")):this.logger.warn("History view element not found.")}}},{}],90:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ImportSubsystem=void 0;s.ImportSubsystem=class ImportSubsystem{constructor(e,t,s,i,n,a){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.logger=e,this.uiManager=t,this.localClient=s,this.settingsManager=i,this.eventBus=n,this.populationService=a,this.authManagementSubsystem=l,this.isImporting=!1,this.socket=null,this.selectedPopulationId=null,this.selectedPopulationName=null,this.fallbackPolling=null,this.selectedFile=null,this.messageFormatter=window.messageFormatter||{formatMessage:(e,t)=>`[${e.toUpperCase()}] ${t}`},this.logger.info("Import Subsystem initialized"),this.setupCrossSubsystemEvents()}async init(){(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: init() method called");try{(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: Setting up event listeners"),this.setupEventListeners(),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: About to refresh population dropdown"),this.refreshPopulationDropdown(),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: Setting initial button state"),this.validateAndUpdateButtonState(),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: Init completed successfully"),(this.logger?.info||window.logger?.info||console.log)("Import Subsystem initialized successfully")}catch(e){throw(this.logger?.error||window.logger?.error||console.error)(" [DEBUG] ImportSubsystem: Init failed with error:",e),(this.logger?.error||window.logger?.error||console.error)("Failed to initialize Import Subsystem",e),e}}setupEventListeners(){const e=window.safeDOM||new SafeDOM(this.logger),t=window.errorHandler||new ErrorHandler(this.logger),s=window.UI_CONFIG||{SELECTORS:{START_IMPORT_BTN:"start-import",CSV_FILE_INPUT:"csv-file",IMPORT_POPULATION_SELECT:"import-population-select"}},i=e.selectById(s.SELECTORS.START_IMPORT_BTN);i&&e.addEventListener(i,"click",t.wrapAsyncEventHandler(async e=>{e.preventDefault(),await this.startImport()},"Import button click handler"));const n=e.selectById(s.SELECTORS.CSV_FILE_INPUT);n&&e.addEventListener(n,"change",t.wrapAsyncEventHandler(async e=>{const t=e.target.files[0];t&&(this.selectedFile=t,await this.handleFileSelect(t),this.validateAndUpdateButtonState())},"CSV file input change handler"));const a=e.selectById(s.SELECTORS.IMPORT_POPULATION_SELECT);a&&e.addEventListener(a,"change",t.wrapEventHandler(e=>{this.handlePopulationChange(e.target.value,e.target.selectedOptions[0]?.text),this.validateAndUpdateButtonState()},"Population dropdown change handler")),this.setupDragAndDropListeners()}setupDragAndDropListeners(){const e=document.getElementById("import-drop-zone"),t=document.getElementById("csv-file");e?(["dragenter","dragover","dragleave","drop"].forEach(t=>{e.addEventListener(t,e=>{e.preventDefault(),e.stopPropagation()},!1)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,()=>{e.classList.add("drag-over")},!1)}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,()=>{e.classList.remove("drag-over")},!1)}),e.addEventListener("drop",async e=>{const s=e.dataTransfer.files;if(s.length>0){const e=s[0];if(this.selectedFile=e,t){const s=new DataTransfer;s.items.add(e),t.files=s.files}await this.handleFileSelect(e),this.validateAndUpdateButtonState()}},!1),e.addEventListener("click",()=>{t&&t.click()}),this.logger.info("Drag and drop listeners set up successfully")):this.logger.warn("Import drop zone not found in DOM")}async startImport(){if(this.logger.info(" [DEBUG] ImportSubsystem: Start import button clicked"),this.isImporting)return this.logger.warn(" [DEBUG] ImportSubsystem: Import already in progress"),void this.uiManager.showNotification("An import is already in progress. Please wait for it to complete.",{type:"warning",duration:5e3,title:"Import In Progress"});try{if(this.isImporting=!0,this.logger.info(" [DEBUG] ImportSubsystem: Starting import process"),this.logger.debug(" [DEBUG] ImportSubsystem: Validating prerequisites..."),!await this.validateImportPrerequisites())return void this.logger.warn(" [DEBUG] ImportSubsystem: Prerequisites validation failed, aborting import");this.logger.info(" [DEBUG] ImportSubsystem: Prerequisites validated, proceeding with import"),this.getPopulationSelection(),this.logger.debug(" [DEBUG] ImportSubsystem: Showing progress UI"),this.uiManager.showProgress();const e=this.generateSessionId();this.logger.debug(" [DEBUG] ImportSubsystem: Establishing real-time connection with session:",e),await this.establishRealTimeConnection(e),this.logger.debug(" [DEBUG] ImportSubsystem: Executing import with session:",e),await this.executeImport(e)}catch(e){this.logger.error(" [DEBUG] ImportSubsystem: Import process failed",e),this.uiManager.showError("Import Failed",e.message||"An unexpected error occurred during the import process.")}finally{this.isImporting=!1,this.logger.debug(" [DEBUG] ImportSubsystem: Import process completed, resetting isImporting flag")}}async validateImportPrerequisites(){this.logger.debug(" [DEBUG] ImportSubsystem: Validating import prerequisites");if(!await this.checkTokenStatus())return this.logger.warn(" [DEBUG] ImportSubsystem: Token validation failed"),this.showAuthenticationModal("Import"),!1;if(!this.selectedFile)return this.logger.warn(" [DEBUG] ImportSubsystem: No file selected (selectedFile is null)"),this.uiManager.showError("No File Selected","Please select a CSV file to import."),!1;const e=document.getElementById("import-population-select");return e&&e.value&&""!==e.value?(this.logger.info(" [DEBUG] ImportSubsystem: All prerequisites validated successfully",{hasFile:!!this.selectedFile,fileName:this.selectedFile?.name,hasPopulation:!!e?.value,populationId:e?.value}),!0):(this.logger.warn(" [DEBUG] ImportSubsystem: No population selected"),this.uiManager.showError("No Population Selected","Please select a population for the import."),!1)}getPopulationSelection(){const e=document.getElementById("import-population-select");if(this.selectedPopulationId=e?.value||"",e){const t=e.options[e.selectedIndex];this.selectedPopulationName=t?.text||""}this.logger.info("Population selection",{id:this.selectedPopulationId,name:this.selectedPopulationName})}handleProgressUpdate(e){if(!e||void 0===e.current||void 0===e.total)return void this.logger.error("Invalid progress data",e);const t=Math.round(e.current/e.total*100);this.uiManager.updateProgress(t,e.message||`Processing ${e.current} of ${e.total} users...`),this.logger.info("Progress update",{current:e.current,total:e.total,percentage:t})}handleImportCompletion(e){this.logger.info("Import completed",e),this.cleanupConnections()}handleImportError(e){this.logger.error("Import error",e),this.cleanupConnections()}async executeImport(e){const t=document.getElementById("csv-file").files[0],s=new FormData;s.append("file",t),s.append("populationId",this.selectedPopulationId),s.append("sessionId",e);try{const e=await this.localClient.post("/api/import",s);if(!e.success)throw new Error(e.error||"Import failed");this.logger.info("Import request sent successfully")}catch(e){throw this.logger.error("Import request failed",e),e}}generateSessionId(){return`import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async checkTokenStatus(){try{if((this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: checkTokenStatus called"),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: this.authManagementSubsystem =",this.authManagementSubsystem),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: typeof this.authManagementSubsystem =",typeof this.authManagementSubsystem),!this.authManagementSubsystem)return this.logger.warn("AuthManagementSubsystem not available for token check"),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: AuthManagementSubsystem is null/undefined"),!1;(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: AuthManagementSubsystem is available, calling isTokenValid()");const e=this.authManagementSubsystem.isTokenValid();(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: isValid =",e);const t=this.authManagementSubsystem.getAuthenticationStatus();return(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: authStatus =",t),e}catch(e){return this.logger.error("Error checking token status:",e),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] ImportSubsystem: Error in checkTokenStatus:",e),!1}}showAuthenticationModal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Import";try{this.createAuthenticationModal(e)}catch(t){this.logger.error("Error showing authentication modal:",t),this.uiManager.showError("Authentication Required",`You must have a valid token to start an ${e.toLowerCase()}. Please go to Settings to configure your credentials.`)}}createAuthenticationModal(e){const t=window.safeDOM||new SafeDOM(this.logger),s=window.errorHandler||new ErrorHandler(this.logger),i=window.UI_CONFIG||{SELECTORS:{TOKEN_ALERT_OVERLAY:".token-alert-overlay",SETTINGS_NAV_ITEM:'[data-view="settings"]'},CLASSES:{TOKEN_ALERT_OVERLAY:"token-alert-overlay"}},n=t.select(i.SELECTORS.TOKEN_ALERT_OVERLAY);n&&n.remove();const a=document.createElement("div");t.addClass(a,i.CLASSES.TOKEN_ALERT_OVERLAY),a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.setAttribute("aria-labelledby","token-alert-title"),a.setAttribute("aria-describedby","token-alert-content"),a.innerHTML=`\n            <div class="token-alert-modal" tabindex="-1">\n                <div class="token-alert-header">\n                    <h2 id="token-alert-title">\n                        <span class="warning-icon" aria-hidden="true"></span>\n                        <span>Authentication Required</span>\n                    </h2>\n                    <button type="button" class="token-alert-close" id="token-alert-close" aria-label="Close">\n                        <span aria-hidden="true">&times;</span>\n                    </button>\n                </div>\n                <div class="token-alert-body">\n                    <div id="token-alert-content" class="token-alert-content">\n                        <div class="token-alert-icon">\n                            <span aria-hidden="true"></span>\n                        </div>\n                        <h3>No Valid Token Available</h3>\n                        <p class="token-alert-message">\n                            <strong>Authentication is required to continue.</strong>\n                            You need valid credentials to perform the "${e}" operation.\n                        </p>\n                        <div class="token-status-info">\n                            <p><strong>Current Status:</strong> No token available</p>\n                        </div>\n                        <div class="token-alert-actions">\n                            <button type="button" class="btn btn-primary btn-lg" id="token-alert-settings-btn">\n                                <span class="btn-icon"></span>\n                                Go to Settings\n                            </button>\n                            <p class="token-alert-help">\n                                Add your PingOne credentials in the Settings page to generate a new token.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(a);const l=t.select("#token-alert-settings-btn",a),c=t.select("#token-alert-close",a);l&&t.addEventListener(l,"click",s.wrapEventHandler(()=>{if(a.remove(),window.app&&window.app.showView)window.app.showView("settings");else{const e=t.select(i.SELECTORS.SETTINGS_NAV_ITEM);e?e.click():window.location.href="/"}},"Authentication modal settings button click")),c.addEventListener("click",()=>{a.remove()}),a.addEventListener("keydown",e=>{"Escape"===e.key&&a.remove()}),a.style.display="flex",setTimeout(()=>{a.classList.add("show")},10)}async handleFileSelect(e){try{if(this.logger.info("File selected for import",{name:e.name,size:e.size,type:e.type}),!this.validateFile(e))return;this.displayFileInfo(e)}catch(e){this.logger.error("File selection failed",e),this.uiManager.showError("File Selection Error",e.message)}}validateAndUpdateButtonState(){const e=window.safeDOM||new SafeDOM(this.logger),t=window.errorHandler||new ErrorHandler(this.logger),s=window.UI_CONFIG||{SELECTORS:{START_IMPORT_BTN:"start-import",IMPORT_POPULATION_SELECT:"import-population-select"},CLASSES:{BTN_DISABLED:"btn-disabled",BTN_PRIMARY:"btn-primary"}};t.wrapSync(()=>{const t=e.selectById(s.SELECTORS.START_IMPORT_BTN);if(!t)return void this.logger.warn("Import button not found for state validation");const i=!!this.selectedFile,n=e.selectById(s.SELECTORS.IMPORT_POPULATION_SELECT),a=n&&n.value&&""!==n.value,l=i&&a;t.disabled=!l,this.logger.debug("Import button state updated",{hasFile:i,hasPopulation:a,shouldEnable:l,buttonDisabled:t.disabled}),l?(e.removeClass(t,s.CLASSES.BTN_DISABLED),e.addClass(t,s.CLASSES.BTN_PRIMARY)):(e.addClass(t,s.CLASSES.BTN_DISABLED),e.removeClass(t,s.CLASSES.BTN_PRIMARY))},"Import button state validation")()}validateFile(e){return e.name.toLowerCase().endsWith(".csv")?!(e.size>10485760)||(this.uiManager.showError("File Too Large","File size must be less than 10MB"),!1):(this.uiManager.showError("Invalid File Type","Please select a CSV file"),!1)}async displayFileInfo(e){try{this.logger.info("Displaying comprehensive file information",{fileName:e.name});let t=null,s=null;try{const i=await this.readFileAsText(e);s=this.parseCSVContent(i),t=s?s.length:0,this.logger.debug("CSV parsing completed",{recordCount:t,hasData:!!s})}catch(e){this.logger.warn("Failed to parse CSV for record count",{error:e.message}),t="Unable to determine"}this.updateFileInfoDisplay(e,t,s)}catch(t){this.logger.error("Failed to display file information",{error:t.message});const s=window.safeDOM||new SafeDOM(this.logger),i=window.UI_CONFIG||{SELECTORS:{FILE_INFO:"file-info"},CLASSES:{FILE_INFO_ERROR:"file-info-error"},STYLES:{ERROR_BACKGROUND:"#f8d7da",ERROR_BORDER:"1px solid #f5c6cb",ERROR_COLOR:"#721c24"}},n=s.selectById(i.SELECTORS.FILE_INFO);if(n){const a=`\n                    <div class="${i.CLASSES.FILE_INFO_ERROR}" style="background: ${i.STYLES.ERROR_BACKGROUND}; border: ${i.STYLES.ERROR_BORDER}; border-radius: 4px; padding: 12px; color: ${i.STYLES.ERROR_COLOR};">\n                        <strong> File Information Error</strong><br>\n                        Selected: ${e.name}<br>\n                        Size: ${(e.size/1024).toFixed(2)} KB<br>\n                        <em>Unable to display detailed information: ${t.message}</em>\n                    </div>\n                `;s.setHTML(n,a)}}}readFileAsText(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=e=>t(e.target.result),i.onerror=()=>s(new Error("Failed to read file")),i.readAsText(e)})}parseCSVContent(e){if(!e||"string"!=typeof e)return[];try{const t=e.split("\n").filter(e=>e.trim().length>0);return t.length<=1?[]:t.slice(1).map(e=>{const t=[];let s="",i=!1;for(let n=0;n<e.length;n++){const a=e[n];'"'===a?i=!i:","!==a||i?s+=a:(t.push(s.trim()),s="")}return t.push(s.trim()),t}).filter(e=>e.some(e=>e.length>0))}catch(e){return this.logger.error("CSV parsing error",{error:e.message}),[]}}updateFileInfoDisplay(e,t,s){const i=document.getElementById("file-info");if(!i)return void this.logger.warn("File info element not found in DOM");const n=this.formatFileSize(e.size),a=new Date(e.lastModified).toLocaleString(),l=e.type||this.getFileExtension(e.name),c=this.getFileExtension(e.name),u="csv"===c||"txt"===c||"text/csv"===l||"text/plain"===l;let h="";u&&null!==t&&(h="number"==typeof t?t>0?`\n                        <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                            <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> Records</strong>\n                            <span style="color: #0073C8; font-size: 0.8rem; font-weight: bold;">${t}</span>\n                        </div>\n                    `:'\n                        <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                            <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> Records</strong>\n                            <span style="color: #dc3545; font-size: 0.8rem; font-weight: bold;">No user records found</span>\n                        </div>\n                    ':`\n                    <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                        <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> Records</strong>\n                        <span style="color: #ffc107; font-size: 0.8rem; font-weight: bold;">${t}</span>\n                    </div>\n                `);const g=`\n            <div class="file-info-details" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; margin: 8px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.08);">\n                \n                \x3c!-- File Name Section --\x3e\n                <div class="file-name-section" style="text-align: center; margin-bottom: 12px; padding: 8px; background: #e6f4ff; border-radius: 4px; color: #1a237e; font-weight: bold; font-size: 1.1rem;">\n                    <div style="font-size: 1.3rem; font-weight: 600; margin-bottom: 3px; color: #1a237e; word-break: break-word; overflow-wrap: break-word;">\n                        <i class="fas fa-file-csv" style="margin-right: 6px; font-size: 1.2rem; color: #1976d2;"></i>\n                        ${e.name}\n                    </div>\n                    <div style="font-size: 0.85rem; opacity: 0.9; font-weight: 500; color: #1976d2;">\n                        File Selected Successfully\n                    </div>\n                </div>\n                \n                \x3c!-- File Information Grid --\x3e\n                <div class="file-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; font-size: 0.8em; margin-bottom: 10px;">\n                    <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                        <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> File Size</strong>\n                        <span style="color: #6c757d; font-size: 0.8rem;">${n}</span>\n                    </div>\n                    \n                    <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                        <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> Modified</strong>\n                        <span style="color: #6c757d; font-size: 0.8rem;">${a}</span>\n                    </div>\n                    \n                    <div class="file-info-item" style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #e9ecef;">\n                        <strong style="color: #495057; display: block; margin-bottom: 3px; font-size: 0.85rem;"> Type</strong>\n                        <span style="color: #6c757d; font-size: 0.8rem;">${l||"CSV"}</span>\n                    </div>\n                    \n                    ${h}\n                </div>\n                \n                \x3c!-- File Status --\x3e\n                <div class="file-info-status" style="margin-top: 8px; padding: 8px; border-radius: 4px; background: ${u?"#d4edda":"#f8d7da"}; border: 1px solid ${u?"#c3e6cb":"#f5c6cb"}; display: flex; align-items: center; gap: 6px;">\n                    <i class="fas ${u?"fa-check-circle":"fa-exclamation-triangle"}" style="color: ${u?"#155724":"#721c24"};"></i>\n                    <span style="color: ${u?"#155724":"#721c24"}; font-size: 0.85rem; font-weight: 500;">\n                        ${u?"Valid CSV file format":"Warning: File type may not be compatible"}\n                    </span>\n                </div>\n                \n                ${s&&s.length>0?`\n                <div class="file-info-preview" style="margin-top: 8px; padding: 8px; border-radius: 4px; background: #fff3cd; border: 1px solid #ffeaa7;">\n                    <strong style="color: #856404; font-size: 0.85rem;"> Ready for Import</strong>\n                    <div style="color: #856404; font-size: 0.8rem; margin-top: 2px;">\n                        File contains ${t} user record${1===t?"":"s"} ready for processing\n                    </div>\n                </div>\n                `:""}\n            </div>\n        `;i.innerHTML=g,this.logger.info("File information display updated successfully",{recordCount:t,isValidType:u})}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}getFileExtension(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()}async establishRealTimeConnection(e){try{return this.logger.debug(" [DEBUG] ImportSubsystem: Establishing real-time connection for session:",e),"undefined"!=typeof io&&this.subsystems?.realtimeManager?(this.logger.debug(" [DEBUG] ImportSubsystem: Socket.IO available, setting up real-time connection"),this.socket=this.subsystems.realtimeManager.getConnection(),this.socket?(this.socket.on(`import-progress-${e}`,e=>{this.handleProgressUpdate(e)}),this.socket.on(`import-complete-${e}`,e=>{this.handleImportCompletion(e)}),this.socket.on(`import-error-${e}`,e=>{this.handleImportError(e)}),this.logger.info(" [DEBUG] ImportSubsystem: Real-time connection established successfully")):(this.logger.warn(" [DEBUG] ImportSubsystem: Socket.IO connection not available, using fallback polling"),this.setupFallbackPolling(e))):(this.logger.warn(" [DEBUG] ImportSubsystem: Socket.IO not available, using fallback polling"),this.setupFallbackPolling(e)),Promise.resolve()}catch(t){return this.logger.error(" [DEBUG] ImportSubsystem: Failed to establish real-time connection:",t),this.setupFallbackPolling(e),Promise.resolve()}}cleanupConnections(){this.socket&&(this.socket.disconnect(),this.socket=null),this.fallbackPolling&&(clearInterval(this.fallbackPolling),this.fallbackPolling=null),this.isImporting=!1}setupFallbackPolling(e){this.fallbackPolling=setInterval(async()=>{try{const t=await this.localClient.get(`/api/import/status/${e}`);t.data&&this.handleProgressUpdate(t.data)}catch(e){this.logger.error("Fallback polling failed",e)}},2e3)}setupCrossSubsystemEvents(){this.eventBus?(this.eventBus.on("tokenExpired",e=>{this.logger.warn("Token expired during import operation"),this.isImporting&&(this.cleanupConnections(),this.uiManager.showError("Session Expired","Your authentication token expired during the import. Please re-authenticate and try again."))}),this.eventBus.on("tokenError",e=>{this.logger.error("Token error detected",e),this.isImporting&&(this.cleanupConnections(),this.uiManager.showError("Authentication Error",`Authentication failed: ${e.error}`))}),this.eventBus.on("tokenRefreshed",e=>{this.logger.info("Token refreshed successfully")}),this.eventBus.on("populationsChanged",e=>{this.logger.info("Populations changed, refreshing import dropdown",{count:e.count}),this.refreshPopulationDropdown()}),this.logger.debug("Cross-subsystem event listeners set up for ImportSubsystem")):this.logger.warn("EventBus not available for cross-subsystem events")}handlePopulationChange(e,t){this.logger.info(" [DEBUG] ImportSubsystem: Population changed",{populationId:e,populationName:t});const s=document.querySelector(".population-name-text");s&&(e&&t?(s.innerHTML=`<span class="population-label">Population:</span> <span class="population-value">${t}</span>`,this.logger.debug("Updated population name display",{populationName:t})):s.innerHTML='<span class="population-label">Population:</span> <span class="population-placeholder">Select a population</span>');const i=document.querySelector(".api-url-text");if(i)if(e){const t=`/api/populations/${e}/users`;i.textContent=t,this.logger.debug("Updated API URL display",{apiUrl:t})}else i.textContent="Select a population to see the API URL";this.selectedPopulationId=e,this.selectedPopulationName=t,this.eventBus&&this.eventBus.emit("importPopulationChanged",{populationId:e,populationName:t})}refreshPopulationDropdown(){this.logger.info(" [DEBUG] ImportSubsystem: refreshPopulationDropdown called"),this.populationService?(this.logger.info(" [DEBUG] ImportSubsystem: PopulationService available, calling populateDropdown"),this.populationService.populateDropdown("import-population-select",{includeEmpty:!0,emptyText:"Select a population"}).then(()=>{this.logger.info(" [DEBUG] ImportSubsystem: Import population dropdown refreshed successfully")}).catch(e=>{this.logger.error(" [DEBUG] ImportSubsystem: Failed to refresh import population dropdown",e),this.uiManager.showError("Population Refresh Failed","Failed to refresh population dropdown.")})):this.logger.error(" [DEBUG] ImportSubsystem: PopulationService not available for dropdown refresh",{populationServiceType:typeof this.populationService,populationServiceExists:!!this.populationService})}}},{}],91:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NavigationSubsystem=void 0;var i=e("../utils/browser-logging-service.js");s.NavigationSubsystem=class NavigationSubsystem{constructor(e,t,s,n){this.logger=e||(0,i.createLogger)({serviceName:"navigation-subsystem",environment:"development"}),this.uiManager=t,this.settingsManager=s,this.app=n,this.currentView="home",this.previousView=null,this.navigationHistory=[],this.viewInitializers=new Map,this.viewCleanupHandlers=new Map,this.navItems=null,this.viewContainers=null,this.logger.info("Navigation subsystem initialized")}async init(){try{this.logger.info("Initializing navigation subsystem..."),this.navItems=document.querySelectorAll("[data-view]"),this.viewContainers=document.querySelectorAll('.view-container, [id$="-view"]'),this.logger.info("Navigation elements found",{navItems:this.navItems.length,viewContainers:this.viewContainers.length}),this.setupNavigationListeners(),this.registerDefaultViewInitializers(),await this.showView(this.currentView),this.logger.info("Navigation subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize navigation subsystem",{error:e.message}),e}}setupNavigationListeners(){this.navItems.forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const s=e.getAttribute("data-view");this.logger.debug("Navigation item clicked",{view:s}),s&&s!==this.currentView&&await this.navigateToView(s)})}),window.addEventListener("popstate",e=>{e.state&&e.state.view&&this.showView(e.state.view,!1)}),this.logger.debug("Navigation listeners set up")}async navigateToView(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(this.logger.info("Navigating to view",{from:this.currentView,to:e}),!this.isValidView(e))return this.logger.warn("Invalid view requested",{view:e}),!1;if(!0!==t.force&&!await this.canNavigateFrom(this.currentView))return this.logger.info("Navigation blocked by current view",{currentView:this.currentView}),!1;const s=await this.showView(e,!1!==t.pushToHistory);return s&&this.logger.info("Navigation completed successfully",{view:e}),s}catch(t){return this.logger.error("Navigation failed",{view:e,error:t.message}),!1}}async showView(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(this.logger.debug("Showing view",{view:e,pushToHistory:t}),this.previousView=this.currentView,this.previousView&&this.viewCleanupHandlers.has(this.previousView))try{await this.viewCleanupHandlers.get(this.previousView)(),this.logger.debug("View cleanup completed",{view:this.previousView})}catch(e){this.logger.warn("View cleanup failed",{view:this.previousView,error:e.message})}this.hideAllViews();const s=document.getElementById(`${e}-view`);if(!s)return this.logger.warn("View element not found",{view:e}),!1;if(s.style.display="block",s.classList.add("active"),this.updateNavigationState(e),this.viewInitializers.has(e))try{await this.viewInitializers.get(e)(),this.logger.debug("View initializer completed",{view:e})}catch(t){this.logger.warn("View initializer failed",{view:e,error:t.message})}if(t&&window.history){const t=new URL(window.location);t.searchParams.set("view",e),window.history.pushState({view:e},"",t)}return this.currentView=e,this.navigationHistory.push({view:e,timestamp:Date.now(),from:this.previousView}),this.navigationHistory.length>50&&(this.navigationHistory=this.navigationHistory.slice(-50)),this.logger.info("View shown successfully",{view:e}),!0}catch(t){return this.logger.error("Failed to show view",{view:e,error:t.message}),!1}}hideAllViews(){this.viewContainers.forEach(e=>{e.style.display="none",e.classList.remove("active")}),this.logger.debug("All views hidden")}updateNavigationState(e){this.navItems.forEach(t=>{t.classList.remove("active"),t.getAttribute("data-view")===e&&t.classList.add("active")}),this.updatePageTitle(e),this.logger.debug("Navigation state updated",{view:e})}updatePageTitle(e){const t=`PingOne User Import v${this.app.version}`,s={import:"Import Users",export:"Export Users",modify:"Modify Users","delete-csv":"Delete Users",settings:"Settings",logs:"Logs",history:"History"}[e];document.title=s?`${s} - ${t}`:t}registerViewInitializer(e,t){this.viewInitializers.set(e,t),this.logger.debug("View initializer registered",{view:e})}registerViewCleanup(e,t){this.viewCleanupHandlers.set(e,t),this.logger.debug("View cleanup handler registered",{view:e})}registerDefaultViewInitializers(){this.registerViewInitializer("import",async()=>{"function"==typeof window.app?.loadPopulations&&await window.app.loadPopulations("import-population-select")}),this.registerViewInitializer("export",async()=>{window.exportManager&&"function"==typeof window.exportManager.loadPopulations&&await window.exportManager.loadPopulations()}),this.registerViewInitializer("delete-csv",async()=>{window.deleteManager&&"function"==typeof window.deleteManager.loadPopulations&&await window.deleteManager.loadPopulations()}),this.registerViewInitializer("modify",async()=>{"function"==typeof window.app?.loadPopulations&&await window.app.loadPopulations("modify-population-select")}),this.registerViewInitializer("logs",async()=>{window.logManager&&"function"==typeof window.logManager.loadLogs&&window.logManager.loadLogs()}),this.registerViewInitializer("history",async()=>{window.logManager&&"function"==typeof window.logManager.loadLogs&&window.logManager.loadLogs()}),this.logger.debug("Default view initializers registered")}isValidView(e){return["home","import","export","modify","delete-csv","settings","logs","history","analytics"].includes(e)}async canNavigateFrom(e){if("import"===e&&window.app?.isImportRunning){return confirm("Import is currently running. Are you sure you want to leave this page?")}if("export"===e&&window.exportManager?.isExportRunning){return confirm("Export is currently running. Are you sure you want to leave this page?")}if("delete-csv"===e&&window.deleteManager?.isDeleteRunning){return confirm("Delete operation is currently running. Are you sure you want to leave this page?")}if("settings"===e&&this.settingsManager?.hasUnsavedChanges?.()){return confirm("You have unsaved settings. Are you sure you want to leave without saving?")}return!0}getCurrentView(){return this.currentView}getPreviousView(){return this.previousView}getNavigationHistory(){return[...this.navigationHistory]}async goBack(){if(this.previousView)await this.navigateToView(this.previousView);else if(this.navigationHistory.length>1){const e=this.navigationHistory[this.navigationHistory.length-2];await this.navigateToView(e.view)}}async refreshCurrentView(){await this.showView(this.currentView,!1)}getViewStats(){const e={};return this.navigationHistory.forEach(t=>{e[t.view]||(e[t.view]={count:0,lastVisited:null}),e[t.view].count++,e[t.view].lastVisited=t.timestamp}),e}cleanup(){this.navItems.forEach(e=>{e.removeEventListener("click",this.handleNavClick)}),window.removeEventListener("popstate",this.handlePopState),this.viewInitializers.clear(),this.viewCleanupHandlers.clear(),this.navigationHistory=[],this.logger.info("Navigation subsystem cleaned up")}}},{"../utils/browser-logging-service.js":97}],92:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.OperationManagerSubsystem=void 0;var i=e("../utils/browser-logging-service.js");s.OperationManagerSubsystem=class OperationManagerSubsystem{constructor(e,t,s,n){this.logger=e||(0,i.createLogger)({serviceName:"operation-manager-subsystem",environment:"development"}),this.uiManager=t,this.settingsManager=s,this.apiClient=n,this.currentOperation=null,this.operationQueue=[],this.operationHistory=[],this.isOperationRunning=!1,this.operationTypes={IMPORT:"import",EXPORT:"export",DELETE:"delete",MODIFY:"modify"},this.validators=new Map,this.preChecks=new Map,this.postChecks=new Map,this.logger.info("Operation Manager subsystem initialized")}async init(){try{this.logger.info("Initializing operation manager subsystem..."),this.registerDefaultValidators(),this.registerDefaultPreChecks(),this.registerDefaultPostChecks(),this.logger.info("Operation Manager subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize operation manager subsystem",{error:e.message}),e}}async startOperation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(this.logger.info("Starting operation",{type:e,options:t}),this.isOperationRunning)throw new Error("Another operation is already running");if(!Object.values(this.operationTypes).includes(e))throw new Error(`Invalid operation type: ${e}`);const s={id:this.generateOperationId(),type:e,options:t,status:"initializing",startTime:Date.now(),endTime:null,progress:{current:0,total:0,percentage:0,message:"Initializing..."},result:null,error:null};this.currentOperation=s,this.isOperationRunning=!0,await this.runPreChecks(s),await this.validateOperation(s);const i=await this.executeOperation(s);return await this.runPostChecks(s),s.status="completed",s.endTime=Date.now(),s.result=i,this.logger.info("Operation completed successfully",{type:e,duration:s.endTime-s.startTime}),i}catch(t){throw this.logger.error("Operation failed",{type:e,error:t.message}),this.currentOperation&&(this.currentOperation.status="failed",this.currentOperation.endTime=Date.now(),this.currentOperation.error=t.message),t}finally{this.finalizeOperation()}}async executeOperation(e){const{type:t,options:s}=e;switch(this.logger.debug("Executing operation",{type:t}),t){case this.operationTypes.IMPORT:return await this.executeImport(e);case this.operationTypes.EXPORT:return await this.executeExport(e);case this.operationTypes.DELETE:return await this.executeDelete(e);case this.operationTypes.MODIFY:return await this.executeModify(e);default:throw new Error(`Unknown operation type: ${t}`)}}async executeImport(e){const{options:t}=e;this.logger.info("Executing import operation",{options:t}),this.updateOperationProgress(e,0,100,"Starting import...");const s={file:t.file,populationId:t.populationId,populationName:t.populationName,skipDuplicates:t.skipDuplicates||!1,updateExisting:t.updateExisting||!1},i=await this.apiClient.post("/api/import",s);if(!i.success)throw new Error(i.error||"Import failed");return await this.trackOperationProgress(e,i.sessionId),{success:!0,sessionId:i.sessionId,message:"Import completed successfully"}}async executeExport(e){const{options:t}=e;this.logger.info("Executing export operation",{options:t}),this.updateOperationProgress(e,0,100,"Starting export...");const s={populationId:t.populationId,populationName:t.populationName,includeDisabled:t.includeDisabled||!1,format:t.format||"csv"},i=await this.apiClient.post("/api/export",s);if(!i.success)throw new Error(i.error||"Export failed");return await this.trackOperationProgress(e,i.sessionId),{success:!0,sessionId:i.sessionId,downloadUrl:i.downloadUrl,message:"Export completed successfully"}}async executeDelete(e){const{options:t}=e;this.logger.info("Executing delete operation",{options:t}),this.updateOperationProgress(e,0,100,"Starting delete...");const s={file:t.file,populationId:t.populationId,populationName:t.populationName,confirmDelete:!0},i=await this.apiClient.post("/api/delete",s);if(!i.success)throw new Error(i.error||"Delete failed");return await this.trackOperationProgress(e,i.sessionId),{success:!0,sessionId:i.sessionId,message:"Delete completed successfully"}}async executeModify(e){const{options:t}=e;this.logger.info("Executing modify operation",{options:t}),this.updateOperationProgress(e,0,100,"Starting modify...");const s={file:t.file,populationId:t.populationId,populationName:t.populationName,updateFields:t.updateFields||[]},i=await this.apiClient.post("/api/modify",s);if(!i.success)throw new Error(i.error||"Modify failed");return await this.trackOperationProgress(e,i.sessionId),{success:!0,sessionId:i.sessionId,message:"Modify completed successfully"}}async trackOperationProgress(e,t){return new Promise((s,i)=>{"undefined"!=typeof EventSource?this.trackProgressViaSSE(e,t,s,i):this.trackProgressViaPolling(e,t,s,i)})}trackProgressViaSSE(e,t,s,i){const n=new EventSource(`/api/progress/${t}`);n.onmessage=t=>{try{const a=JSON.parse(t.data);this.handleProgressUpdate(e,a),"completed"===a.status?(n.close(),s(a)):"failed"===a.status&&(n.close(),i(new Error(a.error||"Operation failed")))}catch(e){this.logger.error("Error parsing SSE data",{error:e.message})}},n.onerror=a=>{this.logger.error("SSE connection error",{error:a}),n.close(),this.trackProgressViaPolling(e,t,s,i)}}async trackProgressViaPolling(e,t,s,i){const poll=async()=>{try{const n=await this.apiClient.get(`/api/progress/${t}`);n.success?(this.handleProgressUpdate(e,n.data),"completed"===n.data.status?s(n.data):"failed"===n.data.status?i(new Error(n.data.error||"Operation failed")):setTimeout(poll,1e3)):i(new Error(n.error||"Failed to get progress"))}catch(e){i(e)}};poll()}handleProgressUpdate(e,t){e.progress={current:t.current||0,total:t.total||0,percentage:t.percentage||0,message:t.message||"Processing..."},this.uiManager&&this.uiManager.updateProgress(e.progress.current,e.progress.total,e.progress.message),this.logger.debug("Progress updated",{type:e.type,progress:e.progress})}updateOperationProgress(e,t,s,i){const n=s>0?Math.round(t/s*100):0;e.progress={current:t,total:s,percentage:n,message:i},this.uiManager&&this.uiManager.updateProgress(t,s,i),this.logger.debug("Operation progress updated",{type:e.type,progress:e.progress})}async runPreChecks(e){const t=this.preChecks.get(e.type);t&&(this.logger.debug("Running pre-checks",{type:e.type}),await t(e))}async validateOperation(e){const t=this.validators.get(e.type);t&&(this.logger.debug("Validating operation",{type:e.type}),await t(e))}async runPostChecks(e){const t=this.postChecks.get(e.type);t&&(this.logger.debug("Running post-checks",{type:e.type}),await t(e))}finalizeOperation(){this.currentOperation&&(this.operationHistory.push({...this.currentOperation}),this.operationHistory.length>100&&(this.operationHistory=this.operationHistory.slice(-100)),this.currentOperation=null),this.isOperationRunning=!1,this.logger.debug("Operation finalized")}registerDefaultValidators(){this.validators.set(this.operationTypes.IMPORT,async e=>{const{options:t}=e;if(!t.file)throw new Error("No file selected for import");if(!t.populationId)throw new Error("No population selected for import")}),this.validators.set(this.operationTypes.EXPORT,async e=>{const{options:t}=e;if(!t.populationId)throw new Error("No population selected for export")}),this.validators.set(this.operationTypes.DELETE,async e=>{const{options:t}=e;if(!t.file)throw new Error("No file selected for delete");if(!t.populationId)throw new Error("No population selected for delete")}),this.validators.set(this.operationTypes.MODIFY,async e=>{const{options:t}=e;if(!t.file)throw new Error("No file selected for modify");if(!t.populationId)throw new Error("No population selected for modify")})}registerDefaultPreChecks(){const commonPreCheck=async e=>{if(window.app&&"function"==typeof window.app.checkTokenAndRedirect){if(!await window.app.checkTokenAndRedirect(e.type))throw new Error("Invalid or expired token")}};Object.values(this.operationTypes).forEach(e=>{this.preChecks.set(e,commonPreCheck)})}registerDefaultPostChecks(){const commonPostCheck=async e=>{this.logger.info("Operation completed",{type:e.type,duration:e.endTime-e.startTime,status:e.status})};Object.values(this.operationTypes).forEach(e=>{this.postChecks.set(e,commonPostCheck)})}generateOperationId(){return`op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async cancelOperation(){if(this.currentOperation&&this.isOperationRunning){this.logger.info("Cancelling operation",{type:this.currentOperation.type});try{this.currentOperation.sessionId&&await this.apiClient.post(`/api/cancel/${this.currentOperation.sessionId}`),this.currentOperation.status="cancelled",this.currentOperation.endTime=Date.now(),this.logger.info("Operation cancelled successfully")}catch(e){this.logger.error("Failed to cancel operation",{error:e.message})}finally{this.finalizeOperation()}}}getCurrentOperation(){return this.currentOperation?{...this.currentOperation}:null}getOperationHistory(){return[...this.operationHistory]}isRunning(){return this.isOperationRunning}getOperationStats(){const e={total:this.operationHistory.length,byType:{},byStatus:{},averageDuration:0};let t=0;return this.operationHistory.forEach(s=>{e.byType[s.type]||(e.byType[s.type]=0),e.byType[s.type]++,e.byStatus[s.status]||(e.byStatus[s.status]=0),e.byStatus[s.status]++,s.endTime&&s.startTime&&(t+=s.endTime-s.startTime)}),this.operationHistory.length>0&&(e.averageDuration=Math.round(t/this.operationHistory.length)),e}}},{"../utils/browser-logging-service.js":97}],93:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=class PopulationSubsystem{constructor(e,t,s){if(!e||!t||!s)throw new Error("PopulationSubsystem: logger, localClient, and eventBus are required.");this.logger=e.child({subsystem:"PopulationSubsystem"}),this.localClient=t,this.eventBus=s,this.populations=[],this.isInitialized=!1,this.logger.info("PopulationSubsystem initialized.")}async init(){this.logger.info("Initializing..."),this.eventBus.on("credentials-updated",()=>this.fetchPopulations(!0)),await this.fetchPopulations(),this.isInitialized=!0,this.logger.info("Successfully initialized.")}async fetchPopulations(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.populations.length>0&&!e)return this.logger.debug("Returning cached populations."),this.populations;this.logger.info("Fetching populations from the server...");try{const e=await this.localClient.get("/pingone/populations");return this.populations=e.populations||[],this.logger.info(`Successfully fetched ${this.populations.length} populations.`),this.eventBus.emit("populations-updated",this.populations),this.populations}catch(e){return this.logger.error("Failed to fetch populations:",e),this.populations=[],this.eventBus.emit("populations-updated:error",e),[]}}getPopulations(){return this.populations}getPopulationById(e){return this.populations.find(t=>t.id===e)}}},{}],94:[function(e,t,s){"use strict";function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var s=new WeakMap,i=new WeakMap;return(_interopRequireWildcard=function(e,t){if(!t&&e&&e.__esModule)return e;var n,a,l={__proto__:null,default:e};if(null===e||"object"!=typeof e&&"function"!=typeof e)return l;if(n=t?i:s){if(n.has(e))return n.get(e);n.set(e,l)}for(const t in e)"default"!==t&&{}.hasOwnProperty.call(e,t)&&((a=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,t))&&(a.get||a.set)?n(l,t,a):l[t]=e[t]);return l})(e,t)}Object.defineProperty(s,"__esModule",{value:!0}),s.RealtimeCommunicationSubsystem=void 0;s.RealtimeCommunicationSubsystem=class RealtimeCommunicationSubsystem{constructor(e,t){this.logger=e,this.uiManager=t,this.socket=null,this.eventSource=null,this.fallbackPolling=null,this.connectionType=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.eventHandlers=new Map,this.logger.info("Real-time Communication Subsystem initialized")}async init(){try{this.setupConnectionMonitoring(),this.logger.info("Real-time Communication Subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize Real-time Communication Subsystem",e),e}}async establishConnection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{preferredTransport:s="socketio",enableFallback:i=!0,timeout:n=1e4}=t;this.logger.info("Establishing real-time connection",{sessionId:e,preferredTransport:s,enableFallback:i});try{"socketio"===s?await this.connectSocketIO(e,n):"sse"===s?await this.connectSSE(e,n):"websocket"===s&&await this.connectWebSocket(e,n)}catch(t){if(this.logger.warn("Primary transport failed",{error:t.message}),!i)throw t;await this.tryFallbackConnections(e)}}async connectSocketIO(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise(async(i,n)=>{try{const{io:a}=await Promise.resolve().then(()=>_interopRequireWildcard(e("socket.io-client")));this.socket=a({transports:["polling"],reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,timeout:s,forceNew:!0,autoConnect:!0});const l=setTimeout(()=>{n(new Error("Socket.IO connection timeout"))},s);this.socket.on("connect",()=>{clearTimeout(l),this.connectionType="socketio",this.isConnected=!0,this.reconnectAttempts=0,this.setupSocketIOHandlers(),this.socket.emit("registerSession",t),this.logger.info("Socket.IO connected successfully"),this.uiManager.showSuccess("Real-time connection established (Socket.IO)"),i()}),this.socket.on("connect_error",e=>{clearTimeout(l),this.logger.error("Socket.IO connection error",e),n(e)}),this.setupSocketIOHandlers()}catch(e){this.logger.error("Failed to initialize Socket.IO",e),n(e)}})}async connectSSE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((s,i)=>{try{const n=`/api/progress/stream/${e}`;this.eventSource=new EventSource(n);const a=setTimeout(()=>{i(new Error("SSE connection timeout"))},t);this.eventSource.onopen=()=>{clearTimeout(a),this.connectionType="sse",this.isConnected=!0,this.reconnectAttempts=0,this.logger.info("SSE connected successfully"),this.uiManager.showSuccess("Real-time connection established (SSE)"),s()},this.eventSource.onerror=e=>{clearTimeout(a),this.logger.error("SSE connection error",e),i(e)},this.setupSSEHandlers()}catch(e){this.logger.error("Failed to initialize SSE",e),i(e)}})}async connectWebSocket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((s,i)=>{try{const n=`ws://${window.location.host}/ws/${e}`;this.websocket=new WebSocket(n);const a=setTimeout(()=>{i(new Error("WebSocket connection timeout"))},t);this.websocket.onopen=()=>{clearTimeout(a),this.connectionType="websocket",this.isConnected=!0,this.reconnectAttempts=0,this.logger.info("WebSocket connected successfully"),this.uiManager.showSuccess("Real-time connection established (WebSocket)"),s()},this.websocket.onerror=e=>{clearTimeout(a),this.logger.error("WebSocket connection error",e),i(e)},this.setupWebSocketHandlers()}catch(e){this.logger.error("Failed to initialize WebSocket",e),i(e)}})}async tryFallbackConnections(e){const t=["sse","websocket","polling"];for(const s of t)if(s!==this.connectionType)try{return this.logger.info(`Trying fallback transport: ${s}`),void("sse"===s?await this.connectSSE(e):"websocket"===s?await this.connectWebSocket(e):"polling"===s&&await this.setupFallbackPolling(e))}catch(e){this.logger.warn(`Fallback transport ${s} failed`,e)}throw new Error("All connection methods failed")}setupSocketIOHandlers(){this.socket.on("progress",e=>{this.handleProgressEvent(e)}),this.socket.on("completion",e=>{this.handleCompletionEvent(e)}),this.socket.on("error",e=>{this.handleErrorEvent(e)}),this.socket.on("disconnect",e=>{this.handleDisconnection(e)}),this.socket.on("reconnect",()=>{this.handleReconnection()})}setupSSEHandlers(){this.eventSource.addEventListener("progress",e=>{const t=JSON.parse(e.data);this.handleProgressEvent(t)}),this.eventSource.addEventListener("completion",e=>{const t=JSON.parse(e.data);this.handleCompletionEvent(t)}),this.eventSource.addEventListener("error",e=>{const t=JSON.parse(e.data);this.handleErrorEvent(t)})}setupWebSocketHandlers(){this.websocket.onmessage=e=>{try{const t=JSON.parse(e.data);switch(t.type){case"progress":this.handleProgressEvent(t.data);break;case"completion":this.handleCompletionEvent(t.data);break;case"error":this.handleErrorEvent(t.data)}}catch(e){this.logger.error("Failed to parse WebSocket message",e)}},this.websocket.onclose=()=>{this.handleDisconnection("WebSocket closed")}}async setupFallbackPolling(e){this.connectionType="polling",this.isConnected=!0,this.fallbackPolling=setInterval(async()=>{try{const t=await fetch(`/api/progress/poll/${e}`),s=await t.json();s.events&&s.events.length>0&&s.events.forEach(e=>{switch(e.type){case"progress":this.handleProgressEvent(e.data);break;case"completion":this.handleCompletionEvent(e.data);break;case"error":this.handleErrorEvent(e.data)}})}catch(e){this.logger.error("Polling request failed",e)}},2e3),this.logger.info("Fallback polling established"),this.uiManager.showInfo("Using polling for updates (limited real-time capability)")}handleProgressEvent(e){this.logger.info("Progress event received",e),this.triggerEvent("progress",e)}handleCompletionEvent(e){this.logger.info("Completion event received",e),this.triggerEvent("completion",e),this.disconnect()}handleErrorEvent(e){this.logger.error("Error event received",e),this.triggerEvent("error",e)}handleDisconnection(e){this.isConnected=!1,this.logger.warn("Connection lost",{reason:e,type:this.connectionType}),this.uiManager.showWarning("Real-time connection lost"),this.attemptReconnection()}handleReconnection(){this.isConnected=!0,this.reconnectAttempts=0,this.logger.info("Connection restored"),this.uiManager.showSuccess("Real-time connection restored")}async attemptReconnection(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return this.logger.error("Max reconnection attempts reached"),void this.uiManager.showError("Connection Lost","Unable to restore real-time connection");this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);this.logger.info("Attempting reconnection",{attempt:this.reconnectAttempts,delay:e}),setTimeout(async()=>{try{"socketio"===this.connectionType&&this.socket&&this.socket.connect()}catch(e){this.logger.error("Reconnection failed",e),this.attemptReconnection()}},e)}setupConnectionMonitoring(){setInterval(()=>{this.isConnected&&this.checkConnectionHealth()},3e4)}checkConnectionHealth(){"socketio"===this.connectionType&&this.socket?this.socket.connected||this.handleDisconnection("Health check failed"):"sse"===this.connectionType&&this.eventSource?this.eventSource.readyState===EventSource.CLOSED&&this.handleDisconnection("SSE connection closed"):"websocket"===this.connectionType&&this.websocket&&this.websocket.readyState===WebSocket.CLOSED&&this.handleDisconnection("WebSocket connection closed")}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const s=this.eventHandlers.get(e),i=s.indexOf(t);i>-1&&s.splice(i,1)}}triggerEvent(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(s=>{try{s(t)}catch(t){this.logger.error("Event handler error",{event:e,error:t.message})}})}disconnect(){this.isConnected=!1,this.socket&&(this.socket.disconnect(),this.socket=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.websocket&&(this.websocket.close(),this.websocket=null),this.fallbackPolling&&(clearInterval(this.fallbackPolling),this.fallbackPolling=null),this.connectionType=null,this.logger.info("All real-time connections closed")}getConnectionStatus(){return{isConnected:this.isConnected,connectionType:this.connectionType,reconnectAttempts:this.reconnectAttempts}}}},{"socket.io-client":62}],95:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=class SettingsSubsystem{constructor(e,t,s,i,n,a){this.logger=e,this.uiManager=t,this.localClient=s,this.settingsManager=i,this.eventBus=n,this.credentialsManager=a,this.isSaving=!1,this.currentSettings=null,this.logger.info("Settings Subsystem initialized"),this.setupCrossSubsystemEvents()}async init(){try{this.setupEventListeners(),await this.loadCurrentSettings(),this.logger.info("Settings Subsystem initialized successfully")}catch(e){this.logger.error("Failed to initialize Settings Subsystem",e),this.uiManager.showSettingsActionStatus("Failed to initialize Settings Subsystem: "+e.message,"error")}}setupEventListeners(){this.logger.info("Setting up Settings Subsystem event listeners");const e=document.getElementById("save-settings");e?(this.logger.info("Found save settings button, attaching event listener"),e.addEventListener("click",async e=>{e.preventDefault(),this.logger.info("Save settings button clicked"),await this.saveSettings()})):this.logger.warn("Save settings button not found in DOM");const t=document.getElementById("test-connection-btn");t&&t.addEventListener("click",async e=>{e.preventDefault(),await this.testConnection()});const s=document.getElementById("get-token-btn");s&&s.addEventListener("click",async e=>{e.preventDefault(),await this.getToken()});const i=document.getElementById("toggle-api-secret-visibility");i&&i.addEventListener("click",e=>{e.preventDefault(),this.toggleSecretVisibility()}),this.logger.info("Settings Subsystem event listeners setup complete")}async loadCurrentSettings(){try{this.currentSettings=this.settingsManager.getSettings(),this.populateSettingsForm(this.currentSettings),this.logger.info("Current settings loaded successfully")}catch(e){throw this.logger.error("Failed to load current settings",e),e}}async saveSettings(){if(this.isSaving)this.logger.warn("Settings save already in progress");else try{let e;this.isSaving=!0,this.logger.info("Starting settings save process"),this.logger.debug("Checking saveSettings dependencies:",{hasUIManager:!!this.uiManager,hasLocalClient:!!this.localClient,hasSettingsManager:!!this.settingsManager,hasCredentialsManager:!!this.credentialsManager,hasEventBus:!!this.eventBus}),this.uiManager&&"function"==typeof this.uiManager.showSettingsActionStatus?(this.uiManager.showSettingsActionStatus("Saving settings...","info"),this.logger.debug("UI feedback shown successfully")):this.logger.warn("UIManager or showSettingsActionStatus method not available");try{e=this.getFormData(),this.logger.info("Form data extracted successfully:",e)}catch(e){throw this.logger.error("Failed to get form data:",e),new Error(`Form data extraction failed: ${e.message}`)}try{if(!this.validateSettings(e))return void this.logger.error("Settings validation failed");this.logger.debug("Settings validation passed")}catch(e){throw this.logger.error("Settings validation error:",e),new Error(`Settings validation error: ${e.message}`)}if(this.credentialsManager)try{const t={environmentId:e.environmentId||"",apiClientId:e.apiClientId||"",apiSecret:e.apiSecret||"",populationId:e.populationId||"",region:e.region||"NorthAmerica"},s=this.credentialsManager.validateCredentials(t);if(!s.isValid)throw new Error(`Invalid credentials: ${s.errors.join(", ")}`);this.credentialsManager.saveCredentials(t),this.logger.info("Credentials saved to localStorage successfully")}catch(e){throw this.logger.error("Credentials manager error:",e),new Error(`Credentials save failed: ${e.message}`)}else this.logger.debug("No credentials manager available, skipping credentials save");if(!this.localClient||"function"!=typeof this.localClient.post)throw this.logger.error("LocalClient not available or post method missing"),new Error("LocalClient not available for server communication");try{this.logger.debug("Attempting server save with localClient.post");const t=await this.localClient.post("/api/settings",e);this.logger.info("Server save successful:",t)}catch(e){this.logger.error("Failed to save to server:",e);const t=e.message||"Unknown server error";throw this.uiManager&&"function"==typeof this.uiManager.showSettingsActionStatus&&this.uiManager.showSettingsActionStatus("Failed to save settings: "+t,"error",{autoHide:!1}),new Error(`Server save failed: ${t}`)}if(this.settingsManager&&"function"==typeof this.settingsManager.updateSettings)try{this.settingsManager.updateSettings(e),this.currentSettings=e,this.logger.debug("Settings manager updated successfully")}catch(e){throw this.logger.error("Settings manager update error:",e),new Error(`Settings manager update failed: ${e.message}`)}else this.logger.warn("Settings manager not available or updateSettings method missing");this.uiManager&&"function"==typeof this.uiManager.showSettingsActionStatus&&this.uiManager.showSettingsActionStatus("Settings saved successfully","success",{autoHideDelay:3e3});try{"function"==typeof this.updateConnectionStatus&&this.updateConnectionStatus(" Settings saved! Please - Get token","success")}catch(e){this.logger.warn("Connection status update failed:",e)}if(this.eventBus&&"function"==typeof this.eventBus.emit)try{this.eventBus.emit("settingsSaved",{settings:e}),this.logger.debug("Settings saved event emitted successfully")}catch(e){this.logger.warn("Event emission failed:",e)}this.logger.info("Settings save process completed successfully")}catch(e){throw this.logger.error("Failed to save settings - detailed error:",{message:e.message,stack:e.stack,name:e.name}),this.uiManager&&"function"==typeof this.uiManager.showSettingsActionStatus&&this.uiManager.showSettingsActionStatus("Failed to save settings: "+e.message,"error",{autoHide:!1}),e}finally{this.isSaving=!1,this.logger.debug("Settings save process finished, isSaving flag reset")}}getFormData(){const e=document.getElementById("settings-form");if(!e)throw new Error("Settings form not found");const t=new FormData(e);return{environmentId:t.get("environment-id")||"",apiClientId:t.get("api-client-id")||"",apiSecret:t.get("api-secret")||"",region:t.get("region")||"NorthAmerica",rateLimit:parseInt(t.get("rate-limit"))||50,populationId:t.get("population-id")||""}}validateSettings(e){const t=[];if(e.environmentId?.trim()||t.push("Environment ID is required"),e.apiClientId?.trim()||t.push("API Client ID is required"),e.apiSecret?.trim()||t.push("API Secret is required"),e.region?.trim()||t.push("Region is required"),e.rateLimit&&(e.rateLimit<1||e.rateLimit>1e3)&&t.push("Rate limit must be between 1 and 1000"),t.length>0){const e="Validation failed: "+t.join(", ");return this.logger.error("Settings validation failed",{errors:t}),this.uiManager.showSettingsActionStatus(e,"error",{autoHide:!1}),!1}return!0}populateSettingsForm(e){if(!e)return;const t={"environment-id":e.environmentId,"api-client-id":e.apiClientId,"api-secret":e.apiSecret,region:e.region,"rate-limit":e.rateLimit,"population-id":e.populationId};Object.entries(t).forEach(e=>{let[t,s]=e;const i=document.getElementById(t);i&&null!=s&&(i.value=s)}),this.logger.info("Settings form populated with current values")}async testConnection(){try{this.logger.info("Testing connection..."),this.uiManager.showSettingsActionStatus("Testing connection...","info");const e=this.getFormData();if(!(e.environmentId&&e.apiClientId&&e.apiSecret&&e.region))return this.uiManager.showSettingsActionStatus("Please fill in all required fields","error"),void this.updateConnectionStatus(" Missing credentials","error");const t=await this.localClient.post("/api/pingone/test-connection",{environmentId:e.environmentId,clientId:e.apiClientId,clientSecret:e.apiSecret,region:e.region});t.success?(this.uiManager.showSettingsActionStatus("Connection test successful","success",{autoHideDelay:3e3}),this.updateConnectionStatus(" Connection successful","success")):(this.uiManager.showSettingsActionStatus("Connection test failed: "+(t.error||t.message),"error"),this.updateConnectionStatus(" Connection failed","error"))}catch(e){this.logger.error("Connection test failed",e),this.uiManager.showSettingsActionStatus("Connection test failed: "+e.message,"error"),this.updateConnectionStatus(" Connection failed","error")}}async getToken(){try{this.logger.info("Getting token..."),this.uiManager.showSettingsActionStatus("Getting token...","info");const e=this.getFormData(),t=await this.localClient.post("/api/v1/auth/token",e);if(t.success){this.uiManager.showSettingsActionStatus("Token obtained successfully","success",{autoHideDelay:3e3}),this.updateConnectionStatus(" Token obtained","success"),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] SettingsSubsystem: About to call updateGlobalTokenStatusDirect");try{if(window.app&&"function"==typeof window.app.updateGlobalTokenStatusDirect){const e=t.timeLeft||t.timeRemaining||"";window.app.updateGlobalTokenStatusDirect(e),(this.logger?.debug||window.logger?.debug||console.log)(" [DEBUG] SettingsSubsystem: updateGlobalTokenStatusDirect called successfully with timeLeft:",e)}else(this.logger?.warn||window.logger?.warn||console.warn)(" [DEBUG] SettingsSubsystem: window.app.updateGlobalTokenStatusDirect not available")}catch(e){(this.logger?.error||window.logger?.error||console.error)(" [DEBUG] SettingsSubsystem: Error calling updateGlobalTokenStatusDirect:",e)}this.eventBus&&this.eventBus.emit("tokenObtained",{token:t.token})}else this.uiManager.showSettingsActionStatus("Failed to get token: "+t.message,"error"),this.updateConnectionStatus(" Token failed","error")}catch(e){this.logger.error("Failed to get token",e),this.uiManager.showSettingsActionStatus("Failed to get token: "+e.message,"error"),this.updateConnectionStatus(" Token failed","error")}}toggleSecretVisibility(){const e=document.getElementById("api-secret"),t=document.getElementById("toggle-api-secret-visibility"),s=t?.querySelector("i");e&&t&&s&&("password"===e.type?(e.type="text",s.className="fas fa-eye-slash",t.setAttribute("aria-label","Hide password")):(e.type="password",s.className="fas fa-eye",t.setAttribute("aria-label","Show password")))}updateConnectionStatus(e,t){const s=document.getElementById("settings-connection-status");s&&(s.textContent=e,s.className=`connection-status status-${t}`)}setupCrossSubsystemEvents(){this.eventBus?(this.eventBus.on("tokenExpired",e=>{this.logger.warn("Token expired"),this.updateConnectionStatus(" Token expired","warning")}),this.eventBus.on("tokenError",e=>{this.logger.error("Token error detected",e),this.updateConnectionStatus(" Token error","error")}),this.eventBus.on("tokenRefreshed",e=>{this.logger.info("Token refreshed successfully"),this.updateConnectionStatus(" Token refreshed","success")}),this.logger.debug("Cross-subsystem event listeners set up for SettingsSubsystem")):this.logger.warn("EventBus not available for cross-subsystem events")}getAllSettings(){return this.settingsManager&&this.settingsManager.getAllSettings?this.settingsManager.getAllSettings():this.settingsManager&&this.settingsManager.getSettings?this.settingsManager.getSettings():this.currentSettings?this.currentSettings:(this.logger.warn("No settings available, returning empty object"),{})}}},{}],96:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ViewManagementSubsystem=void 0;s.ViewManagementSubsystem=class ViewManagementSubsystem{constructor(e,t){this.logger=e,this.uiManager=t,this.currentView="home",this.previousView=null,this.viewHistory=[],this.viewInitializers=new Map,this.logger.info("View Management Subsystem initialized with default home view")}async init(){try{this.setupNavigationListeners(),this.registerViewInitializers(),await this.showInitialView(),this.logger.info("View Management Subsystem initialized successfully")}catch(e){throw this.logger.error("Failed to initialize View Management Subsystem",e),e}}setupNavigationListeners(){document.querySelectorAll("[data-view]").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const s=e.getAttribute("data-view");await this.showView(s)})}),window.addEventListener("popstate",e=>{e.state&&e.state.view&&this.showView(e.state.view,!1)}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&this.handleKeyboardNavigation(e)})}registerViewInitializers(){this.viewInitializers.set("import",async()=>{await this.initializeImportView()}),this.viewInitializers.set("export",async()=>{await this.initializeExportView()}),this.viewInitializers.set("modify",async()=>{await this.initializeModifyView()}),this.viewInitializers.set("delete-csv",async()=>{await this.initializeDeleteView()}),this.viewInitializers.set("settings",async()=>{await this.initializeSettingsView()}),this.viewInitializers.set("logs",async()=>{await this.initializeLogsView()}),this.viewInitializers.set("history",async()=>{await this.initializeHistoryView()}),this.viewInitializers.set("analytics",async()=>{await this.initializeAnalyticsView()})}async showView(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&e!==this.currentView)try{if(this.logger.info("Switching to view",{from:this.currentView,to:e}),!this.isValidView(e))return void(this.uiManager&&"function"==typeof this.uiManager.showError&&this.uiManager.showError("Navigation Error",`Invalid view: ${e}`));this.previousView=this.currentView,this.hideCurrentView(),await this.displayView(e),this.updateNavigationState(e),t&&this.updateBrowserHistory(e),await this.initializeView(e),this.currentView=e,this.viewHistory.push(e),this.updatePageTitle(e),this.triggerViewChangeEvent(e,this.previousView)}catch(t){this.logger.error("Failed to switch view",{view:e,error:t.message}),this.uiManager&&"function"==typeof this.uiManager.showError&&this.uiManager.showError("Navigation Error",`Failed to switch to ${e} view: ${t.message}`)}}hideCurrentView(){const e=document.getElementById(`${this.currentView}-view`);e&&(e.style.display="none",e.classList.remove("active"))}async displayView(e){const t=document.getElementById(`${e}-view`);if(!t)throw new Error(`View element not found: ${e}-view`);t.style.display="block",t.classList.add("active"),t.style.opacity="0",t.style.transition="opacity 0.3s ease-in-out",requestAnimationFrame(()=>{t.style.opacity="1"})}updateNavigationState(e){document.querySelectorAll("[data-view]").forEach(t=>{t.getAttribute("data-view")===e?t.classList.add("active"):t.classList.remove("active")}),this.updatePageTitle(e)}updateBrowserHistory(e){const t={view:e,timestamp:Date.now()},s=this.getViewTitle(e),i=`#${e}`;history.pushState(t,s,i)}async initializeView(e){const t=this.viewInitializers.get(e);if(t)try{await t()}catch(t){this.logger.error("View initialization failed",{view:e,error:t.message})}}async initializeImportView(){window.app&&"function"==typeof window.app.loadPopulations&&await window.app.loadPopulations("import-population-select");const e=document.getElementById("csv-file");e&&(e.value=""),this.resetProgressDisplay()}async initializeExportView(){this.logger.debug(" VIEW: Initializing export view..."),window.app&&window.app.subsystems&&window.app.subsystems.exportManager?(this.logger.debug(" VIEW: Found export manager, loading populations..."),"function"==typeof window.app.subsystems.exportManager.loadPopulations?(await window.app.subsystems.exportManager.loadPopulations(),this.logger.info(" VIEW: Export populations loaded successfully")):this.logger.error(" VIEW: Export manager loadPopulations method not found")):this.logger.error(" VIEW: Export manager not found in app subsystems",{hasApp:!!window.app,hasSubsystems:!(!window.app||!window.app.subsystems),availableSubsystems:window.app&&window.app.subsystems?Object.keys(window.app.subsystems):[]})}async initializeModifyView(){window.app&&"function"==typeof window.app.loadPopulations&&await window.app.loadPopulations("modify-population-select");const e=document.getElementById("modify-csv-file");e&&(e.value="")}async initializeDeleteView(){window.deleteManager&&"function"==typeof window.deleteManager.loadPopulations&&await window.deleteManager.loadPopulations()}async initializeSettingsView(){window.app&&"function"==typeof window.app.loadSettings&&await window.app.loadSettings()}async initializeLogsView(){window.logManager&&"function"==typeof window.logManager.loadLogs&&await window.logManager.loadLogs()}async initializeHistoryView(){try{if(this.app&&this.app.subsystems&&this.app.subsystems.history){this.logger.debug("Initializing history view with HistorySubsystem");document.getElementById("history-view")||this.logger.warn("History view container not found")}else this.logger.warn("HistorySubsystem not available for history view initialization")}catch(e){this.logger.error("Failed to initialize history view:",e)}}async initializeAnalyticsView(){try{if(this.logger.debug("Initializing analytics view"),window.app&&window.app.analyticsDashboardUI){this.logger.debug("Analytics dashboard UI available, ensuring visibility");const e=document.getElementById("analytics-dashboard");e?(e.style.display="block",this.logger.debug("Analytics dashboard container made visible")):this.logger.warn("Analytics dashboard container not found")}else this.logger.warn("Analytics dashboard UI not available for analytics view initialization")}catch(e){this.logger.error("Failed to initialize analytics view:",e)}}async showInitialView(){let e="home";const t=window.location.hash.substring(1);t&&this.isValidView(t)&&(e=t),await this.showView(e,!1)}isValidView(e){return["home","import","export","modify","delete-csv","settings","logs","history","analytics"].includes(e)}getViewTitle(e){return{import:"Import Users",export:"Export Users",modify:"Modify Users","delete-csv":"Delete Users",settings:"Settings",logs:"Logs",history:"History",analytics:"Analytics Dashboard"}[e]||"PingOne Import Tool"}updatePageTitle(e){const t=this.getViewTitle(e);document.title=`${t} - PingOne Import Tool`}handleKeyboardNavigation(e){const t={1:"import",2:"export",3:"modify",4:"delete-csv",5:"settings",6:"logs",7:"history"}[e.key];t&&(e.preventDefault(),this.showView(t))}resetProgressDisplay(){this.uiManager&&"function"==typeof this.uiManager.hideProgress&&this.uiManager.hideProgress(),this.uiManager&&"function"==typeof this.uiManager.updateProgress&&this.uiManager.updateProgress(0,1,"")}triggerViewChangeEvent(e,t){const s=new CustomEvent("viewChanged",{detail:{newView:e,oldView:t,timestamp:Date.now()}});document.dispatchEvent(s)}async goBack(){this.previousView&&await this.showView(this.previousView)}getCurrentView(){return this.currentView}getViewHistory(){return[...this.viewHistory]}clearViewHistory(){this.viewHistory=[]}}},{}],97:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BrowserLoggingService=void 0,s.createLogger=createLogger,s.logger=s.default=void 0;class BrowserLoggingService{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.serviceName=e.serviceName||"pingone-import-client",this.environment=e.environment||"development",this.logLevel=e.logLevel||this.getDefaultLogLevel(),this.enableConsole=!1!==e.enableConsole,this.enableServer=!1!==e.enableServer,this.levels={error:0,warn:1,info:2,debug:3},this.correlationId=this.generateCorrelationId(),this.performanceMarks=new Map,this.initializeTransports()}getDefaultLogLevel(){switch(this.environment){case"production":return"info";case"test":return"warn";default:return"debug"}}generateCorrelationId(){return`${this.serviceName}-${Date.now()}-${Math.random().toString(36).substr(2,8)}`}initializeTransports(){this.transports=[],this.enableConsole&&this.transports.push({name:"console",log:this.logToConsole.bind(this)}),this.enableServer&&this.transports.push({name:"server",log:this.logToServer.bind(this)})}shouldLog(e){return this.levels[e]<=this.levels[this.logLevel]}formatLogEntry(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),level:e.toUpperCase(),message:t,service:this.serviceName,environment:this.environment,correlationId:this.correlationId,source:"client",url:window.location.href,userAgent:navigator.userAgent,...s}}logToConsole(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.shouldLog(e))return;const i=this.formatLogEntry(e,t,s);let n=`[${i.timestamp}] [${i.correlationId.slice(-8)}] [${i.service}] ${e.toUpperCase()}: ${t}`;switch(Object.keys(s).length>0&&(n+=`\n${JSON.stringify(s,null,2)}`),e){case"error":console.error(n);break;case"warn":console.warn(n);break;case"info":console.info(n);break;case"debug":console.debug(n);break;default:console.log(n)}}async logToServer(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const i=this.formatLogEntry(e,t,s);await fetch("/api/logs/client",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(e){this.enableConsole&&console.warn("Failed to send log to server:",e.message)}}log(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.shouldLog(e)&&this.transports.forEach(i=>{try{i.log(e,t,s)}catch(e){console.error(`Error in ${i.name} transport:`,e)}})}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("error",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("warn",e,t)}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("info",e,t)}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("debug",e,t)}startTimer(e){this.performanceMarks.set(e,performance.now()),this.debug(`Timer started: ${e}`)}endTimer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this.performanceMarks.get(e);if(!s)return this.warn(`Timer not found: ${e}`),0;const i=performance.now()-s;return this.performanceMarks.delete(e),this.info(`Timer completed: ${e}`,{duration:`${i.toFixed(2)}ms`,...t}),i}child(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new BrowserLoggingService({serviceName:this.serviceName,environment:this.environment,logLevel:this.logLevel,enableConsole:this.enableConsole,enableServer:this.enableServer}),s=t.formatLogEntry.bind(t);return t.formatLogEntry=function(t,i){return s(t,i,{...e,...arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}})},t}setCorrelationId(e){this.correlationId=e}getCorrelationId(){return this.correlationId}}function createLogger(){return new BrowserLoggingService(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}s.BrowserLoggingService=BrowserLoggingService;s.logger=createLogger({serviceName:"pingone-import-client"});s.default=BrowserLoggingService},{}],98:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CryptoUtils=void 0;s.CryptoUtils=class CryptoUtils{static encrypt(e,t){if(!e||!t)return console.warn("CryptoUtils: Encryption requires text and a secret."),e;try{return btoa(`${t}:${e}`)}catch(t){return console.error("Failed to encode data:",t),e}}static generateKey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let i=0;i<e;i++)s+=t.charAt(Math.floor(62*Math.random()));return s}static decrypt(e,t){if(!e||!t)return console.warn("CryptoUtils: Decryption requires text and a secret."),e;try{const s=atob(e),[i,...n]=s.split(":");return i===t?n.join(":"):null}catch(t){return console.error("Failed to decode data:",t),e}}}},{}],99:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.eventBus=s.default=s.EventBus=void 0;class EventBus{constructor(){this.events={}}on(e,t){(this.events[e]=this.events[e]||[]).push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){(this.events[e]||[]).forEach(e=>e(t))}}s.EventBus=EventBus;const i=s.eventBus=new EventBus;s.default=i;"undefined"!=typeof window&&(window.EventBus=EventBus,window.eventBus=i)},{}],100:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FileLogger=void 0;s.FileLogger=class FileLogger{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"client.log";this.filename=e,this.fileHandle=null,this.writableStream=null,this.initialized=!1,this.logQueue=[],this.initializationPromise=null}async _initialize(){return!!this.initialized||(this.initializationPromise||(this.initializationPromise=(async()=>{try{if(!window.isSecureContext||!window.showSaveFilePicker)throw new Error("File System Access API not available in this context");if(!window.__fileLoggerUserGesture){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline());const handleUserGesture=()=>{window.__fileLoggerUserGesture=!0,window.removeEventListener("click",handleUserGesture),window.removeEventListener("keydown",handleUserGesture),this.fileLogger&&!this.fileLogger._initialized&&null===this.fileLogger._logger&&this.fileLogger._ensureInitialized().catch(console.warn)};throw window.addEventListener("click",handleUserGesture,{once:!0,passive:!0}),window.addEventListener("keydown",handleUserGesture,{once:!0,passive:!0}),new Error("Waiting for user gesture to initialize file logger")}try{return this.fileHandle=await window.showSaveFilePicker({suggestedName:this.filename,types:[{description:"Log File",accept:{"text/plain":[".log"]}}],excludeAcceptAllOption:!0}),this.writableStream=await this.fileHandle.createWritable({keepExistingData:!0}),this.initialized=!0,await this._processQueue(),!0}catch(e){return console.warn("File System Access API not available:",e),this.initialized=!1,!1}}catch(e){return console.warn("File logger initialization deferred:",e.message),this.initialized=!1,!1}})()),this.initializationPromise)}async _processQueue(){if(0===this.logQueue.length)return;const e=[...this.logQueue];this.logQueue=[];for(const{level:t,message:s,timestamp:i}of e)await this._writeLog(t,s,i)}async _writeLog(e,t,s){this.initialized||await this._initialize();const i=`[${s}] [${e.toUpperCase()}] ${t}\n`;if(this.writableStream)try{await this.writableStream.write(i)}catch(e){console.error("Error writing to log file:",e),this.initialized=!1,await this._initialize(),await this.writableStream.write(i)}else console[e](`[FileLogger] ${i}`)}async log(e,t){const s=(new Date).toISOString();this.initialized?await this._writeLog(e,t,s):(this.logQueue.push({level:e,message:t,timestamp:s}),await this._initialize())}info(e){return this.log("info",e)}warn(e){return this.log("warn",e)}error(e){return this.log("error",e)}debug(e){return this.log("debug",e)}async close(){if(this.writableStream)try{await this.writableStream.close()}catch(e){console.error("Error closing log file:",e)}finally{this.initialized=!1,this.writableStream=null,this.fileHandle=null}}}},{}],101:[function(e,t,s){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=i(e("axios"));s.default=class LocalApiClient{constructor(e,t){if(!e)throw new Error("LocalApiClient: baseURL is required.");if(!t)throw new Error("LocalApiClient: logger is required.");this.client=n.default.create({baseURL:e,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}),this.logger=t,this.logger.info(`Local API Client initialized for base URL: ${e}`),this.client.interceptors.response.use(e=>e,e=>(this.logger.error("API request failed:",{message:e.message,url:e.config.url,method:e.config.method,response:e.response?{status:e.response.status,data:e.response.data}:"No response received"}),Promise.reject(e)))}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logger.debug(`Making GET request to: ${e}`);try{return(await this.client.get(e,t)).data}catch(t){throw this.logger.error(`GET request to ${e} failed.`),t}}async post(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.logger.debug(`Making POST request to: ${e}`);try{return(await this.client.post(e,t,s)).data}catch(t){throw this.logger.error(`POST request to ${e} failed.`),t}}async put(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.logger.debug(`Making PUT request to: ${e}`);try{return(await this.client.put(e,t,s)).data}catch(t){throw this.logger.error(`PUT request to ${e} failed.`),t}}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logger.debug(`Making DELETE request to: ${e}`);try{return(await this.client.delete(e,t)).data}catch(t){throw this.logger.error(`DELETE request to ${e} failed.`),t}}}},{"@babel/runtime/helpers/interopRequireDefault":1,axios:3}],102:[function(e,t,s){(function(t){(function(){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(s,"__esModule",{value:!0}),s.Logger=void 0;var n=e("./winston-logger.js"),a=i(e("./message-formatter.js"));function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var s=new WeakMap,i=new WeakMap;return(_interopRequireWildcard=function(e,t){if(!t&&e&&e.__esModule)return e;var n,a,l={__proto__:null,default:e};if(null===e||"object"!=typeof e&&"function"!=typeof e)return l;if(n=t?i:s){if(n.has(e))return n.get(e);n.set(e,l)}for(const t in e)"default"!==t&&{}.hasOwnProperty.call(e,t)&&((a=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,t))&&(a.get||a.set)?n(l,t,a):l[t]=e[t]);return l})(e,t)}const l=window.app&&window.app.uiManager;class Logger{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.logElement=e,this.logs=[],this.validCount=0,this.errorCount=0,this.initialized=!1,this.serverLoggingEnabled=!0,this.isLoadingLogs=!1,this.offlineLogs=[],this.childMetadata={},this.winstonLogger=(0,n.createWinstonLogger)({service:"pingone-import-frontend",environment:t.env.NODE_ENV||"development",enableServerLogging:!0,enableConsoleLogging:!0}),this.initialize()}initialize(){try{this.winstonLogger.info("Logger initialized successfully"),this.initialized=!0}catch(e){console.error("Failed to initialize logger:",e)}}disableServerLogging(){this.serverLoggingEnabled=!1,this.winstonLogger.setServerLogging(!1),this.winstonLogger.debug("Server logging disabled")}enableServerLogging(){this.serverLoggingEnabled=!0,this.winstonLogger.setServerLogging(!0),this.winstonLogger.debug("Server logging enabled")}setLoadingLogs(e){this.isLoadingLogs=e,this.winstonLogger.debug(`Loading logs flag set to: ${e}`)}_createSafeFileLogger(){return{_initialized:!1,_logger:null,_queue:[],_initializing:!1,async init(){if(!this._initialized&&!this._initializing){this._initializing=!0;try{const{FileLogger:t}=await Promise.resolve().then(()=>_interopRequireWildcard(e("./file-logger.js")));this._logger=new t("client.log"),this._initialized=!0,this._processQueue()}catch(e){console.warn("Failed to initialize file logger, falling back to console:",e.message),this._logger={log:(e,t,s)=>{console[e]||console.log(`[${e.toUpperCase()}] ${t}`,s)}},this._initialized=!0,this._processQueue()}finally{this._initializing=!1}}},_processQueue(){for(;this._queue.length>0;){const{level:e,message:t,data:s}=this._queue.shift();this._logger&&"function"==typeof this._logger.log&&this._logger.log(e,t,s)}},log(e,t,s){this._initialized&&this._logger?this._logger.log(e,t,s):(this._queue.push({level:e,message:t,data:s}),this._initializing||this.init())}}}_parseLogArgs(e){let t="Log message",s=null,i=null;return e.length>0&&("string"==typeof e[0]?(t=e[0],e.length>1&&"object"==typeof e[1]&&(s=e[1],e.length>2&&"object"==typeof e[2]&&(i=e[2]))):"object"==typeof e[0]&&(s=e[0],t="Log data",e.length>1&&"object"==typeof e[1]&&(i=e[1]))),[t,s,i]}log(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if("string"==typeof e&&"string"==typeof t)this._logToWinston(e,t,s);else{const[t,s,i]=this._parseLogArgs(arguments);this._logToWinston(e||"info",t,{...s,...i})}this._updateLogUI({level:e,message:t,data:s,timestamp:new Date})}catch(e){console.error("Error in logger.log:",e)}}_logToWinston(e,t){const s={...arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},component:"frontend-logger",timestamp:(new Date).toISOString()};this.winstonLogger.log(e,t,s)}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("info",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("warn",e,t)}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("error",e,t),l&&l.showStatusBar(e,"error",{autoDismiss:!1}),this.errorCount++,this.updateSummary()}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("debug",e,t)}success(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("info",e,{...t,type:"success"}),this.validCount++,this.updateSummary()}errorWithStack(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.winstonLogger.errorWithStack(e,t,s),this.errorCount++,this.updateSummary()}_updateLogUI(e){if(this.logElement&&this.logElement.appendChild&&"function"==typeof this.logElement.appendChild)try{const t=document.createElement("div");t.className=`log-entry ${e.level}`;const s=document.createElement("span");s.className="log-timestamp",s.textContent=new Date(e.timestamp).toLocaleTimeString(),t.appendChild(s);const i=document.createElement("span");i.className="log-level",i.textContent=e.level.toUpperCase(),t.appendChild(i);const n=document.createElement("span");n.className="log-message";let l=e.message;if(e.data&&e.data.type)switch(e.data.type){case"progress":l=a.default.formatProgressMessage(e.data.operation||"import",e.data.current||0,e.data.total||0,e.message,e.data.counts||{});break;case"error":l=a.default.formatErrorMessage(e.data.operation||"import",e.message,e.data);break;case"completion":l=a.default.formatCompletionMessage(e.data.operation||"import",e.data);break;default:l=e.message}if(n.textContent=l,t.appendChild(n),e.data&&Object.keys(e.data).length>0){const s=document.createElement("div");s.className="log-details";const i=document.createElement("h4");i.textContent="Details",s.appendChild(i);const n=document.createElement("pre");n.className="log-detail-json",n.textContent=JSON.stringify(e.data,null,2),s.appendChild(n),t.appendChild(s)}this.logElement.firstChild?this.logElement.insertBefore(t,this.logElement.firstChild):this.logElement.appendChild(t),this.logElement.scrollTop=0;const c=100;for(;this.logElement.children.length>c;)this.logElement.removeChild(this.logElement.lastChild)}catch(e){console.error("Error updating log UI:",e)}}async _sendToServer(e){if(this.serverLoggingEnabled&&!this.isLoadingLogs)try{await fetch("/api/logs/ui",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e.level,message:e.message,data:e.data})})}catch(t){this.winstonLogger.warn("Failed to send log to server",{error:t.message}),this.offlineLogs.push(e)}}renderLogs(){this.logElement&&(this.logElement.innerHTML="",this.logs.forEach(e=>this._updateLogUI(e)),this.logElement.scrollTop=this.logElement.scrollHeight)}clearLogs(){this.logs=[],this.logElement&&(this.logElement.innerHTML=""),this.winstonLogger.info("Logs cleared")}getLogs(){return[...this.logs]}updateSummary(){this.winstonLogger.debug("Summary updated",{validCount:this.validCount,errorCount:this.errorCount})}clearSummary(){this.validCount=0,this.errorCount=0,this.winstonLogger.debug("Summary cleared")}startTimer(e){this.timers||(this.timers=new Map),this.timers.set(e,Date.now()),this.debug(`Timer started: ${e}`)}endTimer(e){if(!this.timers||!this.timers.has(e))return this.warn(`Timer '${e}' not found`),0;const t=this.timers.get(e),s=Date.now()-t;return this.timers.delete(e),this.info(`Timer completed: ${e}`,{duration:`${s}ms`}),s}child(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new Logger(this.logElement);t.serverLoggingEnabled=this.serverLoggingEnabled,t.isLoadingLogs=this.isLoadingLogs,t.winstonLogger=this.winstonLogger,t.childMetadata={...this.childMetadata,...e};const s=t.log.bind(t);return t.log=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n={...this.childMetadata,...i};return s(e,t,n)},t}}s.Logger=Logger}).call(this)}).call(this,e("_process"))},{"./file-logger.js":100,"./message-formatter.js":103,"./winston-logger.js":105,"@babel/runtime/helpers/interopRequireDefault":1,_process:60}],103:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=class MessageFormatter{format(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let i=`[${(new Date).toISOString()}] [${e}] ${t}`;if(s&&Object.keys(s).length>0)try{i+=`\n${JSON.stringify(s,null,2)}`}catch(e){i+="\n[Could not stringify metadata]"}return i}}},{}],104:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=class PingOneClient{constructor(e,t){if(!e||!t)throw new Error("PingOneClient: localClient and logger are required.");this.localClient=e,this.logger=t.child({client:"PingOneClient"}),this.logger.info("PingOneClient initialized.")}async getAccessToken(){this.logger.debug("Requesting new access token...");try{const e=await this.localClient.get("/pingone/get-token");return this.logger.info("Successfully retrieved access token."),e}catch(e){throw this.logger.error("Failed to get access token.",e),e}}async testConnection(){this.logger.debug("Testing PingOne API connection...");try{const e=await this.localClient.get("/pingone/test-connection");return this.logger.info("Connection test completed."),e}catch(e){throw this.logger.error("Connection test failed.",e),e}}}},{}],105:[function(e,t,s){arguments[4][81][0].apply(s,arguments)},{_process:60,dup:81}]},{},[82]);