<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dismiss Credentials Modal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
            background: #e9ecef;
        }
        #console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Credentials Modal Dismissal Tool</h1>
        
        <div class="status">
            <strong>Purpose:</strong> This page helps dismiss the credentials modal that's blocking access to the import view.
        </div>
        
        <div>
            <h3>Modal Dismissal Options:</h3>
            <button class="btn-primary" onclick="skipCredentials()">Skip Credentials</button>
            <button class="btn-success" onclick="useCredentials()">Use Current Credentials</button>
            <button class="btn-secondary" onclick="hideModal()">Force Hide Modal</button>
            <button class="btn-warning" onclick="checkModalStatus()">Check Modal Status</button>
        </div>
        
        <div>
            <h3>Navigation Options:</h3>
            <button class="btn-primary" onclick="navigateToImport()">Navigate to Import View</button>
            <button class="btn-secondary" onclick="openMainApp()">Open Main App</button>
        </div>
        
        <div>
            <h3>Console Output:</h3>
            <div id="console-output">Modal dismissal tool initialized...\n</div>
        </div>
    </div>

    <script>
        // Console output capture
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.innerHTML += args.join(' ') + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.log('=== CREDENTIALS MODAL DISMISSAL TOOL ===');
        
        function skipCredentials() {
            console.log('üîÑ Attempting to skip credentials...');
            
            // Try multiple approaches to skip credentials
            try {
                // Method 1: Try to find and click skip button
                const skipBtn = document.querySelector('#skip-credentials-btn');
                if (skipBtn) {
                    console.log('‚úÖ Found skip button, clicking...');
                    skipBtn.click();
                    return;
                }
                
                // Method 2: Try to access parent window's modal
                if (window.parent && window.parent !== window) {
                    const parentSkipBtn = window.parent.document.querySelector('#skip-credentials-btn');
                    if (parentSkipBtn) {
                        console.log('‚úÖ Found skip button in parent window, clicking...');
                        parentSkipBtn.click();
                        return;
                    }
                }
                
                // Method 3: Try to access via opener
                if (window.opener) {
                    const openerSkipBtn = window.opener.document.querySelector('#skip-credentials-btn');
                    if (openerSkipBtn) {
                        console.log('‚úÖ Found skip button in opener window, clicking...');
                        openerSkipBtn.click();
                        return;
                    }
                }
                
                // Method 4: Try localStorage approach
                console.log('üîÑ Setting credentials modal as shown in localStorage...');
                localStorage.setItem('credentials_modal_shown', 'true');
                sessionStorage.setItem('credentials_modal_shown', 'true');
                
                console.log('‚ùå Could not find skip button, but set storage flags');
                
            } catch (error) {
                console.error('‚ùå Error skipping credentials:', error);
            }
        }
        
        function useCredentials() {
            console.log('üîÑ Attempting to use current credentials...');
            
            try {
                // Try to find and click use credentials button
                const useBtn = document.querySelector('#use-credentials-btn');
                if (useBtn) {
                    console.log('‚úÖ Found use credentials button, clicking...');
                    useBtn.click();
                    return;
                }
                
                // Try parent window
                if (window.parent && window.parent !== window) {
                    const parentUseBtn = window.parent.document.querySelector('#use-credentials-btn');
                    if (parentUseBtn) {
                        console.log('‚úÖ Found use credentials button in parent window, clicking...');
                        parentUseBtn.click();
                        return;
                    }
                }
                
                // Try opener
                if (window.opener) {
                    const openerUseBtn = window.opener.document.querySelector('#use-credentials-btn');
                    if (openerUseBtn) {
                        console.log('‚úÖ Found use credentials button in opener window, clicking...');
                        openerUseBtn.click();
                        return;
                    }
                }
                
                console.log('‚ùå Could not find use credentials button');
                
            } catch (error) {
                console.error('‚ùå Error using credentials:', error);
            }
        }
        
        function hideModal() {
            console.log('üîÑ Attempting to force hide modal...');
            
            try {
                // Try to remove modal classes from body
                document.body.classList.remove('credentials-modal-open');
                
                // Try parent window
                if (window.parent && window.parent !== window) {
                    window.parent.document.body.classList.remove('credentials-modal-open');
                    const appContainer = window.parent.document.querySelector('.app-container');
                    if (appContainer) {
                        appContainer.classList.remove('credentials-modal-active');
                    }
                }
                
                // Try opener
                if (window.opener) {
                    window.opener.document.body.classList.remove('credentials-modal-open');
                    const appContainer = window.opener.document.querySelector('.app-container');
                    if (appContainer) {
                        appContainer.classList.remove('credentials-modal-active');
                    }
                }
                
                // Set storage flags
                localStorage.setItem('credentials_modal_shown', 'true');
                sessionStorage.setItem('credentials_modal_shown', 'true');
                
                console.log('‚úÖ Attempted to force hide modal and set storage flags');
                
            } catch (error) {
                console.error('‚ùå Error hiding modal:', error);
            }
        }
        
        function checkModalStatus() {
            console.log('üîç Checking modal status...');
            
            try {
                const hasModalClass = document.body.classList.contains('credentials-modal-open');
                const modalShown = sessionStorage.getItem('credentials_modal_shown');
                const modalElement = document.querySelector('.credentials-modal-overlay');
                
                console.log('Modal status:');
                console.log('- Body has modal class:', hasModalClass);
                console.log('- Session storage shown:', modalShown);
                console.log('- Modal element exists:', !!modalElement);
                
                // Check parent window
                if (window.parent && window.parent !== window) {
                    const parentHasModalClass = window.parent.document.body.classList.contains('credentials-modal-open');
                    const parentModalElement = window.parent.document.querySelector('.credentials-modal-overlay');
                    console.log('- Parent body has modal class:', parentHasModalClass);
                    console.log('- Parent modal element exists:', !!parentModalElement);
                }
                
            } catch (error) {
                console.error('‚ùå Error checking modal status:', error);
            }
        }
        
        function navigateToImport() {
            console.log('üîÑ Attempting to navigate to import view...');
            
            try {
                // Try to navigate in current window
                window.location.href = 'http://localhost:4000/?view=import';
                
            } catch (error) {
                console.error('‚ùå Error navigating to import:', error);
            }
        }
        
        function openMainApp() {
            console.log('üîÑ Opening main app...');
            
            try {
                window.open('http://localhost:4000/', '_blank');
                
            } catch (error) {
                console.error('‚ùå Error opening main app:', error);
            }
        }
        
        // Auto-check modal status on load
        setTimeout(checkModalStatus, 1000);
    </script>
</body>
</html>
